<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html401/loose.dtd">
<html>
<!-- Copyright (C) 2004, 2005, 2006, 2007 Alain Lahellec

Copyright (C) 2004, 2005, 2006, 2007 Patrice Dumas

Copyright (C) 2004, Ste'phane Hallegatte

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1 or
any later version published by the Free Software Foundation; with no
Invariant Sections, with no Front-Cover text and with no Back-Cover Text.  
A copy of the license is included in the section entitled "GNU Free 
Documentation License."

 -->
<!-- Created on a sunny day by texi2html
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>Miniker 102 manual</title>

<meta name="description" content="Miniker 102 manual">
<meta name="keywords" content="Miniker 102 manual">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
@import "mini_ker_tex4ht_math.css";
@import "mini_ker_tex4ht_tex.css";

a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.roman {font-family:serif; font-weight:normal;}
span.sansserif {font-family:sans-serif; font-weight:normal;}
ul.toc {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="Top"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Miniker-102-manual"></a>
<h1 class="settitle">Miniker 102 manual</h1>




<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Introduction">Introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#TEF-overview">1. An overview of the <acronym>TEF</acronym> formalism</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#A-model-with-Miniker">2. Miniker model programming</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Advanced-programming">3. Advanced Miniker programming</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Dynamic-system-analysis">4. Dynamic analysis of systems in Miniker</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Advanced-use-of-Miniker-with-make">5. Advanced use of Miniker with make</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
Indices

</pre></th></tr><tr><td align="left" valign="top"><a href="#Concepts-index">Concepts index</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Variables-macros-and-functions-index">Variables, macros and functions index</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
Appendices

</pre></th></tr><tr><td align="left" valign="top"><a href="#Installation">A. Installation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Cmz-directives-reference">B. Cmz directives reference</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Copying-This-Manual">C. Copying This Manual</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">           The GNU Free Documentation License.
</td></tr>
</table>


<hr size="1">
<a name="Introduction"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Intended-audience" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Introduction-1"></a>
<h1 class="unnumbered">Introduction</h1>

<a name="index-TEF"></a>
<a name="index-cells"></a>
<a name="index-transfers"></a>
<a name="index-ZOOM"></a>
<a name="index-mortran"></a>

<p>   Miniker is a modeling tool, built especially in order to implement
models written following the <acronym title="Transfer Evolution Formalism">TEF</acronym> (Transfer Evolution Formalism) 
formalism, a mathematical framework for system analysis and
simulation. Miniker allows for timewise simulation, system analysis,
adjoint computation, Kalman filtering and more.
</p>
<p>Miniker uses a fortran preprocessor, <code>mortran</code>, designed in the 
1970&rsquo;s, to ease model writing using dedicated specific languages.
For example partial derivatives are
symbolicaly determined by <code>mortran</code> macros in Miniker. 
For the selection of 
another compile-time features, another set of preprocessor directives,
the <em>cmz directives</em>, are used. In most cases the user does not need to
know anything about that preprocessing that occurs behind the scene,
he simply writes down the equations of his model and he is done.
</p>


<p>A comprehensive description
of the <acronym title="Transfer Evolution Formalism">TEF</acronym> formalism in available on 
<a href="http://www.lmd.jussieu.fr/ZOOM/doc/tef-GB-partA5.pdf">http://www.lmd.jussieu.fr/ZOOM/doc/tef-GB-partA5.pdf</a>).
The Miniker software is a reduced version of 
<a href="http://www.lmd.jussieu.fr/zoom"><strong>ZOOM</strong></a>, 
that can only handle a hundreds of variables, but is much easier to use.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Intended-audience">Intended audience</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Reading-guide">Reading guide</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Other-Manuals-and-documentation">Other Manuals and documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Intended-audience"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Introduction" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Reading-guide" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Introduction" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Introduction" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Intended-audience-1"></a>
<h2 class="unnumberedsec">Intended audience</h2>

<p>The reader should have notions in system dynamics.
Moreover a minimal knowledge of programmation and fortran is 
required. What is required is a basic understanding of variable types, 
affectation and fortran expressions.
</p>
<hr size="6">
<a name="Reading-guide"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Intended-audience" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Other-Manuals-and-documentation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Introduction" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Introduction" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Reading-guide-1"></a>
<h2 class="unnumberedsec">Reading guide</h2>

<p>The first chapter is a brief overview of the <acronym title="Transfer Evolution Formalism">TEF</acronym>.
The following describes how to write, compile and run a model in Miniker 
in its basic and comprehensive syntax.
Reading up to the section
<em>Controlling the run</em> is required to be able to use Miniker. 
In this section it is assumed that Miniker is properly setup. The
installation instructions are in the appendix at
<a href="#Installation">Installation</a>.
</p>


<p>The next chapter describes advanced features, first a general introduction to
features settings and then a description of other model description related
features.
</p>
<p>The next chapter describes system analysis tools available with Miniker. The
sections are independant and each describes how to use a specific feature. If
you plan on using these features, you should also read 
<a href="#Selecting-features">Overview of feature setting</a>.
</p>
<p>A final chapter describes advanced features in a development environment
using make,
</p>
<p>In the appendix the instructions for the installation are described
(see section <a href="#Installation">Installation</a>). 
</p>
<hr size="6">
<a name="Other-Manuals-and-documentation"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Reading-guide" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Introduction" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Introduction" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Other-Manuals-and-documentation-1"></a>
<h2 class="unnumberedsec">Other Manuals and documentation</h2>

<p>A programmers&rsquo;Manual is available (in French), and can be asked for to 
any member of the collabration. See additional documents in 
 <a href="http://www.lmd.jussieu.fr/Zoom/doc">http://www.lmd.jussieu.fr/Zoom/doc</a> or ask for Research 
texts and articles to members.
</p>
<hr size="6">
<a name="TEF-overview"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Other-Manuals-and-documentation" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cell-and-Transfer" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Introduction" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="An-overview-of-the-TEF-formalism"></a>
<h1 class="chapter">1. An overview of the <acronym>TEF</acronym> formalism</h1>

<p>The <acronym title="Transfer Evolution Formalism">TEF</acronym> (Transfer Evolution Formalism) is based on partitionning
and recoupling of model subsystems. It allows the study of the coupling 
between subsystems by the means of linearization and time discretization.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Cell-and-Transfer">1.1 Cell and Transfer equations</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Linearization-and-discretization">1.2 Linearization and discretization in the <acronym>TEF</acronym></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Cell-and-Transfer"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#TEF-overview" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Linearization-and-discretization" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Cell-and-Transfer-equations"></a>
<h2 class="section">1.1 Cell and Transfer equations</h2>

<p>In the <acronym title="Transfer Evolution Formalism">TEF</acronym>, a model is
mathematically represented by a set of equations corresponding
to two kinds objects:
</p>
<ol>
<li> Cells which are elementary models and correspond to evolution equations
such as:

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex0x.png" alt="&#x2202; &#x03B7;(t) = g(&#x03B7;(t),&#x03C6;(t))
 t  " class="math-display" ></center>  

<p>Vector       &#x03B7; represent the state variables of cells and
the vector       &#x03C6; represent the dependent
boundary conditions, <i>i.e.</i> the
variables considered as boundary conditions by a cell, but depending upon
the complete model state. This dependent boundary conditions are
required to make the cells correspond to well-posed problems.
These variables are often called state variables, and prognostic 
variables in meteorology.
</p>

</li><li> Transfers which are determined by constraint equations such as:

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex1x.png" alt="&#x03C6;(t) = f (&#x03B7;(t),&#x03C6; (t))  " class="math-display" ></center>  
These equations are often called algebraic equations, and in meteorology
diagnostic equations.
</li></ol>

<hr size="6">
<a name="Linearization-and-discretization"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Cell-and-Transfer" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Linearization-and-discretization-in-the-TEF"></a>
<h2 class="section">1.2 Linearization and discretization in the <acronym>TEF</acronym></h2>

<p>The relations between sub-systems is excessively difficult to exhibit when
having to cope with non-linear system. In the <acronym title="Transfer Evolution Formalism">TEF</acronym>, the 
<acronym title="Tangent Linear System">TLS</acronym> (Tangent Linear System) is constructed along the trajectory.
One considers the system over a small portion along the trajectory, say
between       t and       t + &#x03B4;t. The variation       &#x03B4;&#x03B7;
of       &#x03B7; and       &#x03B4;&#x03C6; of       &#x03C6; is obtained 
through a Pad&eacute; approximation of the state-transition matrix. The final
form of the algebraic system is closed to the classical Crank-Nicolson scheme:
</p>



<p>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex2x.png" alt="(            )(    )   (  )
   A     B      &#x03B4;&#x03B7;      &#x0393;
 - C+  I - D    &#x03B4;&#x03C6;   =  &#x03A9; " class="math-display" ></center> 
</p>
<p>The blocks appearing in the Jacobian matrix are constructed with partial derivative
of       f and       g, and with       &#x03B4;t. From this system the
elimination of       &#x03B4;&#x03B7; leads to another formulation giving
the coupling between transfers, and allows for the       &#x03B4;&#x03C6;

computation. The       &#x03B4;&#x03C6; value is then substitued in 
      &#x03B4;&#x03B7; to complete the time-step solving process.
</p>
<hr size="6">
<a name="A-model-with-Miniker"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Linearization-and-discretization" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Structure-of-the-code" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#TEF-overview" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Miniker-model-programming"></a>
<h1 class="chapter">2. Miniker model programming</h1>

<a name="index-sequences"></a>

<p>Miniker works by combining the model specification code given by 
the user and other source files provided in the package. The code is
assembled, preprocessed, compiled, linked and the resulting program 
can be run to produce the model trajectory and dynamic analysis.
</p>
<p>The code provided in the package contains a principal program, some usefull
subroutines and pieces of code called <em>sequences</em> combined with the
different codes. Among these sequences some hold the code describing the model
and are to be written by the user (sequences are similar to
Fortran include files).
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Structure-of-the-code">2.1 General structure of the code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#A-model-description">2.2 Miniker programming illustrated</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Setting-and-running-a-model">2.3 Setting and running a model</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Controlling-the-run">2.4 Controlling the run</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Structure-of-the-code"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-description" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="General-structure-of-the-code"></a>
<h2 class="section">2.1 General structure of the code</h2>

<a name="index-sequence"></a>
<a name="index-zinit_002c-general"></a>

<p>The sequences used to enter model description hold the mathematical formulae for each cell and transfer component, dedicated
derived computations, and time-step 
steering. During the code generation stage, 
cmz directives are preprocessed, then the user pseudo-Fortran
instructions are translated by <code>mortran</code> using macros designed to 
generate in particular all Fortran instructions that compute the Jacobian 
matrices used in <acronym title="Transfer Evolution Formalism">TEF</acronym> modelling.
</p>
 
<p>The sequence &lsquo;<tt>zinit</tt>&rsquo; contains the mathematical formulation of the model
(see section <a href="#Model-equation-and-parameters">Entering model equation and parameters</a>). 
Another sequence, &lsquo;<tt>zsteer</tt>&rsquo;, is merged at
the end of the time step advance of the simulation, where the user can 
monitor the time step values and printing levels, and perform particular 
computations etc.
(see section <a href="#End-of-time-step">Executing code at the end of each time step</a>).
</p>
<hr size="6">
<a name="A-model-description"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Structure-of-the-code" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-note-about-mortran-and-cmz-directives" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Miniker-programming-illustrated"></a>
<h2 class="section">2.2 Miniker programming illustrated</h2>

<a name="index-TEF-1"></a>

<p>The general <acronym title="Transfer Evolution Formalism">TEF</acronym> system writes:

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex3x.png" alt="&#x2202;&#x03B7;(t) = g(&#x03B7;(t),&#x03C6;(t))
 t
 &#x03C6;(t) = f(&#x03B7;(t),&#x03C6;(t))  " class="math-display" ></center>  
</p>
<p>To illustrate the model description in Miniker a simple predator-prey
model of Lotka-Volterra is used.
This model can be written in the following <acronym title="Transfer Evolution Formalism">TEF</acronym> form:
</p>
<p>

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex4x.png" alt="{
  &#x2202;t&#x03B7;prey = a&#x03B7;prey - a&#x03C6;meet

  &#x2202;t&#x03B7;pred = - c&#x03B7;pred + c&#x03C6;meet  " class="math-display" ></center>  

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex5x.png" alt="&#x03C6;meet = &#x03B7;prey&#x03B7;pred  " class="math-display" ></center>  
</p>
<p>with two cell equations, <i>i.e</i>. state evolution of the prey and predator 
groups, and one transfer accounting for the meeting of individuals of 
different group.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#A-note-about-mortran-and-cmz-directives">2.2.1 All you need to know about mortran and cmz directives</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Model-equation-and-parameters">2.2.2 Entering model equation and parameters</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="A-note-about-mortran-and-cmz-directives"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#A-model-description" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Model-equation-and-parameters" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-description" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="All-you-need-to-know-about-mortran-and-cmz-directives"></a>
<h3 class="subsection">2.2.1 All you need to know about mortran and cmz directives</h3>

<a name="index-mortran-1"></a>

<p>The first stage of code generation consists in cmz directives preprocessing.
Cmz directives are used for conditional selection of features, and sequence 
inclusion. At that point you don&rsquo;t need to know anything about these
directives. They are only usefull if you want to take advantage of advanced 
features 
(see section <a href="#Programming-with-cmz-directives">Programming with cmz directives</a>).
</p>
<p>The code in sequences is written in Mortran and the second stage of code
generation consists in mortran macro expansion. The mortran language is 
described
in its own manual, here we only explain the very basics which is all you need
to know to use Miniker. Mortran basic instructions are almost Fortran,
the differences are the following:
</p>
<ul>
<li> The code is free-form, and each statement should end with a semi-colon 
<code>;</code>.
</li><li> Comments may be introduced by an exclamation mark <code>!</code> at the 
beginning of a line, or appear within double quotes <code>&quot;</code> in a single line.
</li><li> It is possible to use blocs, for <code>do</code> or <code>if</code> statement 
for example, and they are enclosed within brackets &lsquo;<samp>&lt;</samp>&rsquo; and &lsquo;<samp>&gt;</samp>&rsquo;.
To be in the safe side, a semi-colon <code>;</code> should be added after a 
closng bracket <code>&gt;</code>.
</li></ul>

<p>The following fictious code is legal mortran:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">real 
  param;
param = 3.; ff(1) = ff(3)**eta(1);       &quot;a comment&quot;                 
! a line comment
do inode=1,n_node &lt;eta_move(inode)=0.01; eta_speed(inode)=0.0;&gt;;
</pre></td></tr></table>

<p>Thanks to mortran the model code is very simply specified, as you&rsquo;ll 
see next.
</p>

<hr size="6">
<a name="Model-equation-and-parameters"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#A-note-about-mortran-and-cmz-directives" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Setting-and-running-a-model" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-description" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Entering-model-equation-and-parameters"></a>
<h3 class="subsection">2.2.2 Entering model equation and parameters</h3>

<a name="index-zinit"></a>
<a name="index-dt"></a>
<a name="index-time"></a>
<a name="index-nstep"></a>
<a name="index-modzprint"></a>

<p>The model equation and parameters and some Miniker parameters are entered in
the &lsquo;<tt>zinit</tt>&rsquo; sequence. The whole layout of the model is given
before detailing the keywords.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">!%%%%%%%%%%%%%%%%%%%%%%
! Parameters           
!%%%%%%%%%%%%%%%%%%%%%%
  real apar,bpar;        &quot;optional Fortran type declaration&quot;

! required parameters
     dt=.01;             &quot;initial time-step&quot;
     nstep=10 000;       &quot;number of iterations along the trajectory&quot;
     time=0.;            &quot;time initialisation &quot;

! model parameters            
     apar = 1.5;             
     cpar = 0.7;          
                                                  
! misceallaneous parameters
     modzprint = 1000;    &quot;printouts frequency&quot; 

print*,'***************************************';
print*,'Lotka-Volterra model with parameters as:';
z_pr: apar,bpar;
print*,'***************************************';

!%%%%%%%%%%%%%%%%%%%%%%
! Transfer definition
!%%%%%%%%%%%%%%%%%%%%%%
! rencontre (meeting)
set_Phi
&lt; var: ff_interact, fun: f_interact = eta_prey*eta_pred;
&gt;;

!%%%%%%%%%%%%%%%%%%%%%%
! Cell definition
!%%%%%%%%%%%%%%%%%%%%%%

set_eta
&lt; var: eta_prey, fun: deta_prey =   apar*eta_prey - apar*ff_interact;
  var: eta_pred, fun: deta_pred = - cpar*eta_pred + cpar*ff_interact;
&gt;;


!%%%%%%%%%%%%%%%%%%%%%%
! Initial states
!%%%%%%%%%%%%%%%%%%%%%%
     eta_prey = 1.;
     eta_pred = 1.;
;
    OPEN(50,FILE='title.tex',STATUS='UNKNOWN');   &quot;title file&quot;
    write(50,5000) apar,cpar;                     
5000;format('Lotka-Volterra par:',2F4.1);
</pre></td></tr></table>

<a name="Variables-and-model-parameters"></a>
<h4 class="subsubheading">Variables and model parameters</h4>

<p>The following variables are mandatory:
</p>
<dl compact="compact">
<dt> <code>dt</code></dt>
<dd><p>The time step.
</p></dd>
<dt> <code>time</code></dt>
<dd><p>Model time initialisation.
</p></dd>
<dt> <code>nstep</code></dt>
<dd><p>Number of iterations along the trajectory.
</p></dd>
</dl>

<p>There are no other mandatory variables. Some optional variables are used
to monitor the printout and ouput of results of the code.
As an example, the variable <code>modzprint</code> is used to set
the frequency of the printout of the model matrix and vectors during the
run (see section <a href="#Controlling-the-printout-and-data-output">Controlling the printout and data output</a>).
</p>
<p>User&rsquo;s defined variable and Fortran or Mortran instructions can always be
added for intermediate calculus. To avoid conflict with the variables of the
Miniker code, the rule is that a users symbol must not have characters 
&lsquo;<samp>o</samp>&rsquo; 
in the first two symbol characters.
</p>
<p>In the predator-prey example there are two model parameters. The fortran
variables are called here <code>apar</code> for       a and <code>cpar</code> for       c.
If a Fortan type definition is needed, it should be set at the very beginning
of &lsquo;<tt>zinit</tt>&rsquo;. The predator-prey code variable initializations finally reads
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">!%%%%%%%%%%%%%%%%%%%%%%
! Parameters         
!%%%%%%%%%%%%%%%%%%%%%%
  real apar,bpar;        &quot;optional Fortran type declaration&quot;

     dt=.01;           
     nstep=10 000;    
     time=0.;            

! model parameters
     apar = 1.5;           
     cpar = 0.7;                                                            

     modzprint = 1000;  
</pre></td></tr></table>

<a name="Model-equations-1"></a>
<h4 class="subsubheading">Model equations</h4>
<p><a name="Model-equations"></a>
</p>
<a name="index-set_005fPhi"></a>
<a name="index-set_005feta"></a>
<a name="index-var_003a"></a>
<a name="index-fun_003a"></a>
<a name="index-eqn_003a"></a>

<p>The model equations for cells and model equations for transferts are 
entered in two mortran blocks, one for the transferts, the other for the
cell components.  The model equations for cells are entered into a 
<code>set_eta</code> block, and the transfer equations are entered into a
<code>set_phi</code> block.
</p>
<p>In each block the couples variable-function are specified. For
transfers the function defines the transfer itself while for cells
the function describes the cell evolution. The variable is specified
with <code>var:</code>, the function is defined with <code>fun:</code>.
</p>
<p>In the case of the predator-prey model, the transfer variable
associated with       &#x03C6;meet could be called <code>ff_interact</code>
and the transfer definition would be given by:
</p><table><tr><td>&nbsp;</td><td><pre class="example">set_Phi
&lt; var: ff_interact, fun: f_interact = eta_prey*eta_pred;
&gt;;
</pre></td></tr></table>

<p>The two cell equations of the predator-prey model, with name
<code>eta_prey</code> for the prey (      &#x03B7;prey) and <code>eta_pred</code> 
for the predator (      &#x03B7;pred) are:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">set_eta
&lt; var: eta_prey, fun: deta_prey =   apar*eta_prey - apar*ff_interact;
  var: eta_pred, fun: deta_pred = - cpar*eta_pred + cpar*ff_interact;
&gt;;
</pre></td></tr></table>

<p>The &lsquo;<samp>;</samp>&rsquo; at the end of the mortran block is important.
</p>

<p>The whole model equations are setup with:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">!%%%%%%%%%%%%%%%%%%%%%%
! Transfer definition
!%%%%%%%%%%%%%%%%%%%%%%
! rencontre (meeting)
set_Phi
&lt; var: ff_interact, fun: f_interact = eta_prey*eta_pred;
&gt;;

!%%%%%%%%%%%%%%%%%%%%%%
! Cell definition
!%%%%%%%%%%%%%%%%%%%%%%

set_eta
&lt; var: eta_prey, fun: deta_prey =   apar*eta_prey - apar*ff_interact;
  var: eta_pred, fun: deta_pred = - cpar*eta_pred + cpar*ff_interact;
&gt;;
</pre></td></tr></table>

<p>Whenever the user is not concerned with giving a specific name to a
function, it is possible to specify the equation only with
<code>eqn:</code>. Therefore the user may replace an instruction as:
</p><table><tr><td>&nbsp;</td><td><pre class="example">  var: ff_dump,
  fun: f_dump  = - rd*(eta_speed - eta_speed_limiting);
</pre></td></tr></table>
<p>with:
</p><table><tr><td>&nbsp;</td><td><pre class="example">   eqn: ff_dump = - rd*(eta_speed - eta_speed_limiting);
</pre></td></tr></table>

<p>In that case, the unnamed function will take the name of the defined
variable preceded by the &lsquo;<samp>$</samp>&rsquo; sign: <code>$ff_dump</code>.
</p>
<a name="Starting-points"></a>
<h4 class="subsubheading">Starting points</h4>

<a name="index-starting-point"></a>

<p>The cells equations require state initial conditions. In some case, the 
transfers may also need starting points although they are determined from 
the cell values.
</p>
<p>In the predator-prey model the starting points for cells are:
</p><table><tr><td>&nbsp;</td><td><pre class="example">!     initial state
!     -------------
     eta_prey = 1.;
     eta_pred = 1.;
</pre></td></tr></table>

<p>When there is a non trivial implicit relationship between the transfers
in the model, it may be usefull or even necessary to set some
transfers to non-zero values. This difficulty is only relevant for the very
first step of the simulation and will be used as a 
first guess of       &#x03C6;. The uninitialized transfers having 
a default compiler-dependant (often zero) value, an initialization
to another value may help avoiding singular functions or matrix and
ensure convergence in the Newton algorithm used to solve the transfer implicit
equation. 
</p>

<a name="The-cell-and-transfer-arrays"></a>
<h4 class="subsubheading">The cell and transfer arrays</h4>

<a name="index-eta_0028_002e_0029"></a>
<a name="index-ff_0028_002e_0029"></a>
<a name="index-mp"></a>
<a name="index-np"></a>

<p>Sometime it is easier to iterate over an array than to use the 
cell or transfer variable name. This is possible because there is a
correspondence between the variable names 
and the fortran array <code>eta(.)</code> for the cell variables and
the fortran array <code>ff(.)</code> for the transfer variables<a name="DOCF1" href="#FOOT1">(1)</a>.
</p>
<p>The index of the variable is determined by the order of appearance in 
the variable definition blocks. It is reminded in the output, as
explained later (see section <a href="#Simulation-and-output">Running a simulation and using the output</a>). 
</p>
<p>The number of cells is in the integer <code>np</code> variable, and the
number of transfer is in the integer <code>mp</code> variable.
</p>
<a name="title-file"></a>
<h4 class="subsubheading">title file</h4>

<p><a name="Title-file"></a>
<a name="index-title-file"></a>
<a name="index-title_002etex"></a>
</p>
<p>For some graphics generation, a file with name &lsquo;<tt>title.tex</tt>&rsquo; is required
which sets the title. The following instructions take care of that:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">    OPEN(50,FILE='title.tex',STATUS='UNKNOWN');
    write(50,5000) apar,cpar;                 
5000;format('Lotka-Volterra par:',2F4.1);

    close(50);
</pre></td></tr></table>

<p>In that case the parameter values are written down, to differenciate between
different runs. This step is in general not needed.
</p>

<hr size="6">
<a name="Setting-and-running-a-model"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Model-equation-and-parameters" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Setting-up-a-model-with-cmz" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Setting-and-running-a-model-1"></a>
<h2 class="section">2.3 Setting and running a model</h2>

<p>In this section it is assumed that a programming environment has been
properly setup. This environment may use either cmz or make to drive
the preprocessing and compilation. 
You can skip the part related with the environment you don&rsquo;t intend to use.
</p>
<p>For instructions regarding the 
installation, see <a href="#Installation">Installation</a>. 
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Setting-up-a-model-with-cmz">2.3.1 Setup a model and compile with cmz</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Setting-up-a-model-with-make">2.3.2 Setup a model and compile with make</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Graphics">2.3.4 Doing graphics</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Setting-up-a-model-with-cmz"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Setting-and-running-a-model" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Setting-up-a-model-with-make" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Setting-and-running-a-model" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Setup-a-model-and-compile-with-cmz"></a>
<h3 class="subsection">2.3.1 Setup a model and compile with cmz</h3>

<a name="index-mod"></a>
<a name="index-_0024zinit"></a>
<a name="index-_0024dimetaphi"></a>

<p>The user defined sequences are &lsquo;<samp>KEEP</samp>&rsquo; in the
cmz world. The most common organization is to have a cmz file in a
subdirectory of the directory containing the &lsquo;<tt>mini_ker.cmz</tt>&rsquo; 
cmz file. In this
cmz file there should be a &lsquo;<samp>PATCH</samp>&rsquo; called &lsquo;<samp>zinproc</samp>&rsquo;
with the KEEPs within the patch. The KEEP must be called &lsquo;<tt>$zinit</tt>&rsquo;.
</p>
<p>From within cmz in the directory of your model the source extraction, 
compilation and linking will be triggered by a <code>mod</code> command. This macro 
uses the &lsquo;<tt>selseq.kumac</tt>&rsquo; information to find the &lsquo;<tt>mini_ker.cmz</tt>&rsquo; 
cmz file.
<code>mod</code> 
shall create a directory with the same name than the cmz file, 
&lsquo;<tt>mymodel/</tt>&rsquo; in our example. In this directory there is another 
directory &lsquo;<tt>cfs/</tt>&rsquo; containing the sources extracted from the cmz file.
</p>
<p>The file &lsquo;<tt>mymodel_o.tmp</tt>&rsquo; contains all the mortran code generated 
by cmz with the sequences substituted, including the &lsquo;<tt>$zinit</tt>&rsquo;. The fortran produced by the preprocessing and
splitting of this file is in files with the traditional &lsquo;<samp>.f</samp>&rsquo; suffix.
The principal program is in &lsquo;<tt>principal.f</tt>&rsquo;. An efficient way of getting 
familiar with mini_ker methods is looking at the &lsquo;<tt>mymodel_o.tmp</tt>&rsquo; where 
all sequences and main Mortran instructions are gathered. Symbolic derivation 
is noted as <code>F_D(expression)(/variable)</code>, and the resulting Fortran code 
is in &lsquo;<tt>principal.f</tt>&rsquo;.
</p>
<p><code>mod</code> also triggers compilation and linking. The object files are in
the same &lsquo;<tt>cfs/</tt>&rsquo; directory and the executable is in the &lsquo;<tt>mymodel/</tt>&rsquo;
directory, with name &lsquo;<tt>mymodel.exe</tt>&rsquo;.
</p>
<hr size="6">
<a name="Setting-up-a-model-with-make"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Setting-up-a-model-with-cmz" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Simulation-and-output" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Setting-and-running-a-model" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Setup-a-model-and-compile-with-make"></a>
<h3 class="subsection">2.3.2 Setup a model and compile with make</h3>

<a name="index-compilation"></a>
<a name="index-zinit_002emti"></a>
<a name="index-model_005ffile_005fname"></a>

<p>With make, the sequences are files ending with &lsquo;<samp>.mti</samp>&rsquo; (for
mortran include files),
called, for example, &lsquo;<tt>zinit.mti</tt>&rsquo;.
They are included by 
<code>mortran</code> in other source files. You also need a &lsquo;<tt>Makefile</tt>&rsquo;
to drive the compilation of the model.
</p>
<p>If you don&rsquo;t need additional code or libraries to be linked with your 
model you have two alternatives. 
</p>
<ol>
<li>
The simplest alternative is to run
the <code>start_miniker</code> script with the model file name as argument.
It should copy a &lsquo;<tt>zinit.mti</tt>&rsquo; file
ready to be edited and a Makefile ready to compile the model. For
the predator prey model, for example, you could run

<table><tr><td>&nbsp;</td><td><pre class="example">$ start_miniker predator
</pre></td></tr></table>

</li><li>
Otherwise you can copy the Makefile from &lsquo;<tt>template/Makefile</tt>&rsquo;
in the directory containing the sequences. You should then change the compiled
model file name, by changing  the value of the
<code>model_file_name</code> variable to the name of your choice
in the Makefile. It is set to &lsquo;<tt>mymodel</tt>&rsquo; in the template. For the 
predator-prey model, it could be set like

<table><tr><td>&nbsp;</td><td><pre class="example">model_file_name = predator
</pre></td></tr></table>

<p>If you want the executable model file to be built in another directory, you could
set
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">model_file_name = some_dir/predator
</pre></td></tr></table>

<p>The other items set in the default Makefile should be right. 
</p></li></ol>

<p>The preprocessing and the compilation are launched with
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">make all
</pre></td></tr></table>

<p>The mortran files are generated by the cmz directive preprocessor 
from files found in the package source directories. The mortran files 
end with &lsquo;<samp>.mtn</samp>&rsquo; for the main files and  &lsquo;<samp>.mti</samp>&rsquo; for 
include files. They are output in the current directory.
The mortran preprocessor then preprocess these mortran files and includes
the sequences. The resulting fortran code is also in the current directory, 
in files with a &lsquo;<samp>.f</samp>&rsquo; suffix.
Some fortran files ending with &lsquo;<samp>.F</samp>&rsquo; may also be
created by the cmz directive preprocessor.
The object files resulting from the compilation of all the
fortran files (generated from mortran or directly from fortran files) are
there too. 
</p>
<p>In case you want to override the default sequences or a subroutine file 
you just have to create it in your working directory along with the
&lsquo;<tt>zinit.mti</tt>&rsquo;. For example you could want to 
create or modify a &lsquo;<tt>zsteer.mti</tt>&rsquo; file (see section <a href="#End-of-time-step">Executing code at the end of each time step</a>), a &lsquo;<tt>zcmd_law.mti</tt>&rsquo; file 
(see section <a href="#Control-laws">Control laws</a>), a &lsquo;<tt>monitor.f</tt>&rsquo; file 
(see section <a href="#Turning-the-model-into-a-subroutine">Turning the model into a subroutine</a>) to take advantage of 
features presented later in this manual.
</p>
<p>More in-depth discussion of using make to run Miniker is covered in 
<a href="#Advanced-use-of-Miniker-with-make">Advanced use of Miniker with make</a>.
For example it is also possible to create files that are to be 
preprocessed by the cmz directive
preprocessor and separate source files and generated files.
This advanced use is more precisely covered in 
<a href="#Programming-with-cmz-directives">Programming with cmz directives</a>.
</p>

<hr size="6">
<a name="Simulation-and-output"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Setting-up-a-model-with-make" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Graphics" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Setting-and-running-a-model" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Running-a-simulation-and-using-the-output"></a>
<h3 class="subsection">2.3.3 Running a simulation and using the output</h3>

<a name="index-running-model"></a>

<p>Once compiled the model is ready to run, it only has to be executed. On 
standard output informations about the states, transfers, tangent linear
system and other jacobian matrices are printed. 
For example the predator-prey model could be executed with:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">./predator &gt; result.lis
</pre></td></tr></table>

<a name="index-output-file"></a>
<a name="index-dEta_0028_002e_0029"></a>
<a name="index-res_002edata"></a>
<a name="index-dres_002edata"></a>
<a name="index-tr_002edata"></a>
<a name="index-aspha_002edata"></a>
<a name="index-Model_002ehlp"></a>

<p>The  correspondance
between the symbolic variables and the basic vectors and functions
are printed at run time:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">  ---------------- Informing on Phi definition -----------------
    Var-name,           Function-name,       index in ff vector
             ff_interact              f_interact  1
  ----------------------------------------------------

  --------------- Informing on Eta definition ------------------
   Var-name,           Function-name,       index in eta vector
                eta_prey               deta_prey  1
                eta_pred               deta_pred  2
</pre></td></tr></table>

<p>A summary of the model equations are in &lsquo;<tt>Model.hlp</tt>&rsquo; file.  For
the same example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">======================= set_Phi                                                                
                                                                                         
    1 ff_interact f_interact           eta_pray*eta_pred
======================= set_Eta                                                                
                                                                                         
    1 eta_pray    deta_pray            apar*eta_pray-apar*ff_interact
    2 eta_pred    deta_pred            -cpar*eta_pred+cpar*ff_interact
</pre></td></tr></table>
<p>when other general functions are specified with <code>f_set</code>, it can appear
also in the same help file when replaced by <code>fun_set</code>.
</p>
<p>As far as possible, all data printed in the listing are associated
with a name related to a variable. Here is an extract:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example"> Gamma :-8.19100E-02-1.42151E-01 3.87150E-02
         eta_courant eta_T_czcx  eta_T_sz   
       ------------------------------------------------
 Omega : 0.00000E+00 0.00000E+00 0.00000E+00 0.00000E+00
         courant_L   T_czcx      Psi_Tczc    Psi_Tsz 
       ------------------------------------------------
</pre></td></tr></table>
<p>for the two known vectors of the system, and:
</p><table><tr><td>&nbsp;</td><td><pre class="example"> &gt;ker : Matrice de couplage       4 4 4 4
courant_L Raw(1,j=1,4):   1.000     -9.9010E-03  0.000       0.000    
T_czcx    Raw(2,j=1,4): -2.7972E-02   1.000      0.000      9.9900E-04
Psi_Tczcx Raw(3,j=1,4):  0.1605      9.7359E-02  1.000     -5.7321E-03
Psi_Tsz   Raw(4,j=1,4):   0.000     -0.1376     5.7225E-03   1.000    
          Var-Name      courant_L   T_czcx      Psi_Tczc    Psi_Tsz 
          ----------------------------------------------------------
</pre></td></tr></table>

<p>where the <code>couplage</code> (coupling matrix) is given that corresponds 
to the matrix coupling the four transfer components after       &#x03B4;&#x03B7; 
has been eliminated from system. It is computed in the subprogram 
&lsquo;<tt>oker</tt>&rsquo; (for kernel) which solves the system.
</p>
<p>Basic results are output in a set of &lsquo;<samp>.data</samp>&rsquo; files. 
The first line (or two lines) describes the column with a &lsquo;<samp>#</samp>&rsquo;
character used to mark the lines as comments (for <code>gnuplot</code> 
for example).
In the &lsquo;<samp>.data</samp>&rsquo; files, the data are simply separated with spaces.
Each data file has the <code>time</code> variable values as first column.
<a name="DOCF2" href="#FOOT2">(2)</a>.
Following columns give the values of <code>eta(.)</code> in &lsquo;<tt>res.data</tt>&rsquo;, 
<code>dEta(.)</code> in &lsquo;<tt>dres.data</tt>&rsquo; &ndash; the step by step variation of 
<code>eta(.)</code> &ndash; and <code>ff(.)</code> in &lsquo;<tt>tr.data</tt>&rsquo;.
</p>
<p>Along the simulation the <acronym title="Transfer Evolution Formalism">TEF</acronym> Jacobian matrices are computed. 
A transfer variables elimination process also leads to the definition 
of the classical state advance matrix of the system 
(the corresponding array is <code>aspha(.,.)</code> in the code).
This matrix is output in the file &lsquo;<tt>aspha.data</tt>&rsquo; that is used to
post-run dynamics analyses. The matrix columns are written column wise on each
record.
See section <a href="#Stability-of-fastest-modes">Stability analysis of fastest modes</a>. 
See section <a href="#Generalized-TLS">Generalized tangent linear system analysis</a>. It is not used in the solving process.
</p>
<p>Other &lsquo;<samp>.data</samp>&rsquo; files will be described later.
</p>



<hr size="6">
<a name="Graphics"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Simulation-and-output" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Controlling-the-run" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Setting-and-running-a-model" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Doing-graphics"></a>
<h3 class="subsection">2.3.4 Doing graphics</h3>

<a name="index-graphics"></a>
<a name="index-graphics-with-gnuplot"></a>
<a name="index-graphics-with-PAW"></a>

<p>Since the data are simply separated with spaces, and comment lines 
begin with &lsquo;<samp>#</samp>&rsquo;, the 
files can be vizualised with many programs. 
With <code>gnuplot</code>, for example, to plot <code>eta(<var>n</var>)</code>, 
the <code>gnuplot</code> statement could be:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">plot &quot;res.data&quot; using 1:(<var>n</var>+1)
</pre></td></tr></table>

<p>The similar one for <code>ff(<var>n</var>)</code>:
</p><table><tr><td>&nbsp;</td><td><pre class="example">plot &quot;tr.data&quot; using 1:(<var>n</var>+1)
</pre></td></tr></table>

<p>For people using <code>PAW</code>, the CERN graphical computer code, 
Miniker prepares
kumacs that allow to read process the &lsquo;<samp>.data</samp>&rsquo; files in the form of 
<em>n-tuples</em> (see the <cite>PAW manual</cite> for more information). 
In that cas, the flag <code>sel paw</code> has to be gievn in the &lsquo;<tt>selsequ.kumac</tt>&rsquo;.
The generated  n-tuples are ready to use only
for vector dimension of at most 10 (including the variable <code>time</code>).
These kumacs are overwritten each time the model is run. Usaually, gnuplot has
to be preferred, but when using surfaces and histograms, PAW is better.
The &lsquo;<tt>gains.f</tt>&rsquo; (and &lsquo;<tt>go.xqt</tt>&rsquo;  is provided as an example in the 
Miniker files.
</p>
<hr size="6">
<a name="Controlling-the-run"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Graphics" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#End-of-time-step" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Controlling-the-run-1"></a>
<h2 class="section">2.4 Controlling the run</h2>

<a name="index-controlling-the-run"></a>

<p>It is possible to add code that will be executed at the end of each time
step. It is also possible to specify which time step leads to a printout on
standard output. For maximal control, the code running te model may be 
turned into a subroutine to be called from another fortran (or C) 
program, this possibility is covered in <a href="#Calling-the-model-code">Calling the model code</a>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Controlling-the-printout-and-data-output">2.4.2 Controlling the printout and data output</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="End-of-time-step"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Controlling-the-run" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Controlling-the-printout-and-data-output" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Controlling-the-run" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Executing-code-at-the-end-of-each-time-step"></a>
<h3 class="subsection">2.4.1 Executing code at the end of each time step</h3>

<a name="index-zsteer"></a>
<a name="index-zsteer_002einc"></a>

<p>The code in the sequence &lsquo;<tt>zsteer</tt>&rsquo; is executed at the end of each time
step. It is possible to change the time step length (variable <code>dt</code>)
verify that the non linearity are not too big, or perform 
discontinuous modifications of the states. One available variable <code>res</code>
might be usefull for time step monitoring. At the end of the time step,
as soon as       &#x03C6; has been computed, a numerical test is applied
on a pseudo relative quadratic residual between 
      &#x03C6; = f(&#x03B7;(t - dt) + d&#x03C6; (<code> ffl</code>), where       d&#x03C6;
is given by the system resolution in <code>ker</code>,and
      &#x03C6; = f(&#x03B7;),&#x03C6;)
,  Fortran variable (<code>ff</code>):
</p>
<pre class="verbatim">! ========================================================
! test linearite ffl - ff
! ========================================================
if (istep.gt.1)
&lt; res=0.; &lt;io=1,m; res = res +(ffl(io)-ff(io))**2/max(one,ff(io)*ff(io)); &gt;;
  if (res .gt. TOL_FFL)
  &lt; print*,'*** pb linearite : res &gt; TOL_FFL a istep',istep,res,' &gt; ',TOL_FFL;
    do io=1,m &lt; z_pr: io,ff(io),ff(io)-ffl(io); &gt;;
  &gt;;
&gt;;
</pre>
<p>This test hence applies only for non linearities in tranfer models. Nevertheless,
<code>res</code> might be usefull to monitor the time step <code>dt</code> in <code>ZSTEER</code>
and eventually go backward one step (<code>goto :ReDoStep:</code>).
This can more appropriatly be coded in the (empty in default case) 
sequence <code>zstep</code>, inserted just before time-advancing
states and <code>time</code> variables in &lsquo;<tt>principal</tt>&rsquo;.
<a name="index-ffl_0028_002e_0029"></a>
<a name="index-ffl-_0028linearity-test_0029"></a>
<a name="index-linearity-test"></a>
</p>
<p>It is also possible to fix the value of the criterium <code>TOL_FFL</code> in
&lsquo;<tt>zinit</tt>&rsquo; different from its default value of       10-3 &ndash;
independent of the Fortran precision.
</p>

<p>Many other variables are available, including
</p><dl compact="compact">
<dt> <code>istep</code>
<a name="index-istep"></a>
</dt>
<dd><p>The step number;
</p></dd>
<dt> <code>couplage(.)</code>
<a name="index-couplage_0028_002e_0029"></a>
</dt>
<dd><p>The <acronym title="Transfer Evolution Formalism">TEF</acronym> coupling matrix between transfers;
</p></dd>
<dt> <code>H</code>
<a name="index-H"></a>
</dt>
<dd><p>The Jacobian matrix corresponding with:

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex6x.png" alt="&#x2202;&#x03B7;g(&#x03B7;(t),&#x03C6;(t));  " class="math-display" ></center>  
</p></dd>
<dt> <code>Bb</code>
<a name="index-Bb"></a>
</dt>
<dd><p>The Jacobian matrix corresponding with:

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex7x.png" alt="&#x2202;&#x03C6;g(&#x03B7;(t),&#x03C6;(t));  " class="math-display" ></center>  
</p></dd>
<dt> <code>Bt</code>
<a name="index-Bt"></a>
</dt>
<dd><p>The Jacobian matrix corresponding with:

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex8x.png" alt="&#x2202;&#x03B7;f(&#x03B7;(t),&#x03C6;(t));  " class="math-display" ></center>  
</p></dd>
<dt> <code>D</code>
<a name="index-D"></a>
</dt>
<dd><p>The Jacobian matrix corresponding with:


    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex9x.png" alt="&#x2202;&#x03C6;f(&#x03B7;(t),&#x03C6;(t));  " class="math-display" ></center>  
</p>
</dd>
<dt> <code>aspha</code>
<a name="index-aspha"></a>
</dt>
<dd><p>The state advance matrix;
</p></dd>
<dt> <code>dneta</code>
<a name="index-dneta"></a>
</dt>
<dt> <code>dphi</code>
<a name="index-dphi"></a>
</dt>
<dd><p>the variable increments;
</p></dd>
</dl>
<p>One should be aware of that the linearity test concerns the preceding step. 
We have yet no example of managing the time-step.
</p>

<hr size="6">
<a name="Controlling-the-printout-and-data-output"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#End-of-time-step" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Controlling-the-run" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Controlling-the-printout-and-data-output-1"></a>
<h3 class="subsection">2.4.2 Controlling the printout and data output</h3>

<a name="index-printing"></a>
<a name="index-zprint"></a>
<a name="index-modzprint-1"></a>

<p>The printout on standard output is performed if the variable <code>zprint</code> 
of type <code>logical</code> is true. Therefore it is possible to control this
printout by setting <code>zprint</code> false or true. For example the following 
code, in sequence &lsquo;<tt>zsteer</tt>&rsquo;, triggers printing for every 
<code>modzprint</code> time step and the two following time steps:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">ZPRINT = mod(istep+1,modzprint).eq.0;
Zprint = zprint .or. mod(istep+1,modzprint).eq.1;
Zprint = zprint .or. mod(istep+1,modzprint).eq.2;
</pre></td></tr></table>

<p>The data output to &lsquo;<tt>.data</tt>&rsquo; files described in <a href="#Simulation-and-output">Running a simulation and using the output</a> is performed if the
<code>logical</code> variable <code>zout</code> is true. For example the following
code, in &lsquo;<tt>zsteer</tt>&rsquo;, triggers output to &lsquo;<tt>.data</tt>&rsquo; files every 
<code>modzout</code> step.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">Zout = mod(istep,modzout).eq.0;
</pre></td></tr></table>

<hr size="6">
<a name="Advanced-programming"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Controlling-the-printout-and-data-output" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Selecting-features" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#A-model-with-Miniker" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Advanced-Miniker-programming"></a>
<h1 class="chapter">3. Advanced Miniker programming</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Selecting-features">3.1 Overview of additional features setting</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Calling-the-model-code">3.2 Calling the model code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#g_t1D-gridded-model">3.3 Describing 1D gridded model</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Double-precision">3.4 Double precision</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Partial-Derivatives">3.5 Partial Derivatives</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Rule-of-programming-non-continuous-models">3.6 Rule of programming non continuous models</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Parameters">3.7 Parameters</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Observations-and-data">3.8 Observations and data</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Explicit-model-size">3.9 Entering model size explicitely</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Programming-with-cmz-directives">3.10 Programming with cmz directives</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Selecting-features"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Advanced-programming" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Calling-the-model-code" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Overview-of-additional-features-setting"></a>
<h2 class="section">3.1 Overview of additional features setting</h2>

<a name="index-feature-setting"></a>
<a name="index-select-flag"></a>
<a name="index-logical-flags"></a>
<a name="index-selseq_002ekumac"></a>

<p>It is possible to enable some features by selecting which code should 
be part of the principal program. Each of these optionnal features are 
associated with a <em>select flag</em>. 
For example 
double precision is used instead of simple precision with 
the &lsquo;<samp>double</samp>&rsquo; select flag,
the model is a subroutine with the select flag &lsquo;<samp>monitor</samp>&rsquo;,
the Kalman filter code is set with &lsquo;<samp>kalman</samp>&rsquo; and the 1D gridded
model capabilities are associated with &lsquo;<samp>grid1d</samp>&rsquo;. 
To select a given feature the cmz statement <code>sel <var>select_flag</var></code> should
be written down in the &lsquo;<tt>selseq.kumac</tt>&rsquo; found in the model directory.
With make either the corresponding variable should be set to 1 or it
should be added to the <code>SEL</code> make variable, depending on the feature.
</p>
<p>Other features don&rsquo;t need different or additional code to be used. 
Most of the features are enabled by setting specific logical variables to
&lsquo;<samp>.true.</samp>&rsquo;. This is the case for
<code>zback</code> for the adjoint model, <code>zcommand</code> if the command is in a file
and <code>zlaw</code> if it is a function and <code>zkalman</code> for the Kalman filter.
These select and logical flags are described in the corresponding sections.
</p>
<p>In cmz an alternative of writing select flags to &lsquo;<tt>selseq.kumac</tt>&rsquo; is to
drive the compilation with <code>smod <var>sel_flag</var></code>. In that case the
<var>sel_flag</var> is selected and the files and executable goes to a directory
named &lsquo;<tt>sel_flag</tt>&rsquo;. 
</p>
<p>The select flags are taken into account during cmz directives preprocessing.
Therefore you have the possibility to use these flags to conditionnaly 
include pieces of code. In most cases you don&rsquo;t need to include code conditionally 
yourself though, but if you want to, this is covered in 
<a href="#Programming-with-cmz-directives">Programming with cmz directives</a>.
</p>
<hr size="6">
<a name="Calling-the-model-code"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Selecting-features" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Turning-the-model-into-a-subroutine" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Calling-the-model-code-1"></a>
<h2 class="section">3.2 Calling the model code</h2>

<p>When the model code is a subroutine, it can be called from another fortran
program unit (or another program), and the model will be 
run each time the subroutine is called.
This technique could be used, for example to perform optimization 
(see section <a href="#Adjoint-model-and-optimisation">Adjoint model and optimisation with Miniker</a>), or to run the model with different parameters.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Turning-the-model-into-a-subroutine">3.2.1 Turning the model into a subroutine</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#The-model-subroutine">3.2.2 Calling the model subroutine</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Turning-the-model-into-a-subroutine"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Calling-the-model-code" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#The-model-subroutine" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Calling-the-model-code" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Turning-the-model-into-a-subroutine-1"></a>
<h3 class="subsection">3.2.1 Turning the model into a subroutine</h3>


<p>With cmz, one has to do a 
</p><table><tr><td>&nbsp;</td><td><pre class="example">sel monitor
</pre></td></tr></table>
<p>in the &lsquo;<tt>selseq.kumac</tt>&rsquo; file and create the KEEP that call the 
model code. See section <a href="#Selecting-features">Overview of additional features setting</a>.
</p>
<p>With make &lsquo;<samp>monitor</samp>&rsquo; should be added to the <code>SEL</code> variable in
the &lsquo;<tt>Makefile</tt>&rsquo;, for example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">SEL = monitor
</pre></td></tr></table>

<p>A file that call the principal subroutine should also be written, using
the prefered language of the user. The additional object files should
then be linked with the Miniker objects. To that aim they may be added
to the <code>miniker_user_objects</code> variable.
</p>
<hr size="6">
<a name="The-model-subroutine"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Turning-the-model-into-a-subroutine" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#g_t1D-gridded-model" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Calling-the-model-code" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Calling-the-model-subroutine"></a>
<h3 class="subsection">3.2.2 Calling the model subroutine</h3>

<p>The model subroutine is called &lsquo;<samp>principal</samp>&rsquo; and is called with the 
following arguments:
</p>
<dl>
<dt><a name="index-principal"></a><u>Subroutine:</u> <b>principal</b><i> (Cost, ncall, integer_flag, file_suffix, info, idxerror)</i></dt>
<dd><p>Where <var>Cost</var> is a real number, <code>real</code> or <code>double precision</code>, 
and is set by the <code>principal</code>
subroutine. It holds the value of the cost function if such function has been
defined (the use and setting of a cost function is covered later, 
see <a href="#Cost-function-coding-and-adjoint-modeling">Cost function coding and adjoint modeling</a>). 
<var>ncall</var> is an integer which corresponds with the number of 
call to <code>principal</code> done so far, it should be initialized to 0 and 
its value should not be changed, as it is changed in the <code>principal</code>
subroutine.
<var>integer_flag</var> is an integer that can be set by the user to be accessed 
in the <code>principal</code> subroutine. For example its value could be used to
set some flags in the &lsquo;<tt>zinit</tt>&rsquo; sequence.
<var>file_suffix</var> is a character string, that is suffixed to the output files
names instead of &lsquo;<samp>.data</samp>&rsquo;. If the first character is the null character 
&lsquo;<samp>char(0)</samp>&rsquo;, the default suffix, &lsquo;<samp>.data</samp>&rsquo; is appended.
<var>info</var> and <var>idxerror</var> are integer used for error reporting.
<var>idxerror</var> value is 0 if there was no error. It is negative for
an alert, positive for a very serious error. The precise value determines
where the error occured.
<var>info</var> is an integer holding more precise information about the
error. It is usually the information value from lapack.
The precise meaning of these error codes is in <a href="#tab_003aerror_005fcodes">tab:error_codes</a>.
</p></dd></dl>

<div class="float"><a name="tab_003aerror_005fcodes"></a>
<table>
<thead><tr><th>Source of error or warning</th><th><code>info</code></th><th><code>idxerror</code></th></tr></thead>
<tr><td>state matrix inversion in ker</td><td>inversion</td><td>1</td></tr>
<tr><td>time advance system resolution in ker</td><td>system</td><td>2</td></tr>
<tr><td>transfer propagator,       (I - D) inversion</td><td>inversion</td><td>3</td></tr>
<tr><td>kalman analysis state matrix advance in phase space,       (I - D) inversion</td><td>inversion</td><td>21</td></tr>
<tr><td>kalman analysis variance covariance matrix non positive</td><td>Choleski</td><td>22</td></tr>
<tr><td>kalman analysis error matrix inversion</td><td>inversion</td><td>23</td></tr>
<tr><td>kalman error matrix advance</td><td>system</td><td>24</td></tr>
<tr><td>transfers determination linearity problem for transfers</td><td></td><td>-1</td></tr>
<tr><td>transerts determination Newton D_loop does not converge</td><td></td><td>-2</td></tr>
</table>

</div><p><strong>table 3.1: Meaning of error codes returned by principal.
</strong>
</p>
<p>In general more information than the provided arguments has to be passed 
to the <code>principal</code> subroutine, in that case a <code>common</code> block,
to be written in the &lsquo;<tt>zinit</tt>&rsquo; sequence can be used.
</p>

<hr size="6">
<a name="g_t1D-gridded-model"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#The-model-subroutine" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#g_t1D-gridded-Model-size" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Describing-1D-gridded-model"></a>
<h2 class="section">3.3 Describing 1D gridded model</h2>

<p>Specific macros have been built that allow generic description of 1D gridded models.
Because of the necessity of defining left and right limiting conditions, the models
are partitionned in three groups for cell and transfer components. In the following example,
a chain of masselottes linked by springs and dumps is bounded to a wall on the left,
and open at right. The <acronym title="Transfer Evolution Formalism">TEF</acronym> formulation of the problem is written in the phase space (position-shift, velocity)
for node       k, with bounding conditions:

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex10x.png" alt="{    pos    vel
  &#x2202;t&#x03B7;k  = &#x03B7;k
  &#x2202;t&#x03B7;vkel= (&#x03C6;spkr- &#x03C6;spk+r1 + &#x03C6;dkmp- &#x03C6;dmk+p1 )&#x2215;mk
" class="math-display" ></center>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex11x.png" alt="{  spr       pos   pos
  &#x03C6;k  = - kk(&#x03B7;k  - &#x03B7;k-1)
  &#x03C6;skpr= - dk(&#x03B7;vkel- &#x03B7;vek-l1)
" class="math-display" ></center>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex12x.png" alt="(   pos
||||  &#x03B7;0  = 0
{   &#x03B7;v0el= 0
|| &#x03C6;sNp+r1 = 0
||(  dmp
  &#x03C6;N+1 = 0  " class="math-display" ></center>  
</p>
<a name="index-down-node"></a>
<a name="index-up-node"></a>

<p>where       mk is the mass of node       k,       rk and       dk 
the rigidity of springs and dumping coefficients. There are       N nodes
in the grid, from 1 to       N, and two nodes outside of the grid,
a limiting node 0, and a limiting node       N + 1. The limiting node
corresponding with node 0 is called the <em>down</em> node, while the limiting 
node corresponding with node       N + 1
 is called the <em>up</em> node.
Other models not part of the 1D grid may be added if any.
</p>
<p>To enable 1D gridded models, one should set the select flag &lsquo;<samp>grid1d</samp>&rsquo;.
In cmz it is achieved setting the select flag in
&lsquo;<tt>selseq.kumac</tt>&rsquo;, like
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">sel grid1d
</pre></td></tr></table>

<p>With make, the <code>SEL</code> variable should contain <code>grid1d</code>. For example
to select <code>grid1d</code> and <code>monitor</code>, it could be
</p><table><tr><td>&nbsp;</td><td><pre class="example">SEL = grid1d,monitor
</pre></td></tr></table>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#g_t1D-gridded-model-code">3.3.2 1D gridded Model coding</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="g_t1D-gridded-Model-size"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#g_t1D-gridded-model" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#g_t1D-gridded-model-code" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#g_t1D-gridded-model" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Setting-dimensions-for-1D-gridded-model"></a>
<h3 class="subsection">3.3.1 Setting dimensions for 1D gridded model</h3>

<p>In that case the number of nodes, the number of states and tranferts 
per node, and the number of limiting transfers and states are required.
These dimensions has to be entered in the
&lsquo;<tt>DimEtaPhi</tt>&rsquo; sequence. The parameters for cells are
</p><dl compact="compact">
<dt> <code>n_node</code>
<a name="index-n_005fnode"></a>
</dt>
<dd><p>Number of cell nodes in the 1D grid.
</p></dd>
<dt> <code>n_dwn</code>
<a name="index-n_005fdwn"></a>
</dt>
<dd><p>Number of limiting cells with index -1, <i>i.e.</i> number of cells in the
limiting down node.
</p></dd>
<dt> <code>n_up</code>
<a name="index-n_005fup"></a>
</dt>
<dd><p>Number of limiting cells with index +1, <i>i.e.</i> number of cells in the
limiting up node.
</p></dd>
<dt> <code>n_mult</code>
<a name="index-n_005fmult"></a>
</dt>
<dd><p>Number of cells in each node (multiplicity).
</p></dd>
</dl>

<a name="index-m_005fnode"></a>
<a name="index-m_005fdwn"></a>
<a name="index-m_005fup"></a>
<a name="index-m_005fmult"></a>
<p>The parameters for transfers, are similarly 
<code>m_node</code>, <code>m_dwn</code>, <code>m_up</code>, <code>m_mult</code>.
The layout of their declaration should be respected as 
the precompiler matches the line. Also this procedure is tedious, it
should be selected for debuging processes (use the flag <code>sel dimetaphi</code>
in &ldquo;selsequ.kumac&rdquo;. Otherwise, the dimensioning sequence will be automaticaly
generated, which is smart but can lead to diffculty in interpreting syntax errors.
Once a model is correctly entred, turn off the sel flag and further modifications
will automatically generate the proper dimensions. The correctness of dimensionning
should nevertheless always be checked in <code>principal.f</code>, where you can also
check that null valued parameters as <code>lp, mobs, nxp</code> will suppress parts
of the code - this is signaled as Fortran comment cards.
</p>
<p>In our example, there are three grids of cell and
transfer variables (<code>n_node=m_node=3</code>). 
There are two cells and two transfers in each node 
(<code>n_mult=2</code> and <code>m_mult=2</code>). There is no limiting condition 
for the states in the down node therefore <code>n_up=0</code>. 
There is no transfer for the first limiting node, and 
therefore <code>m_dwn=0</code>.
There are two states in the limiting node 0, the down node, 
<code>n_dwn=2</code>, and two transfers in the limiting last node the node up, 
and <code>m_up=2</code>:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">! ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
! nodes parameters, and Limiting Conditions (Low and High)
! ++++++++++++++++++++++++++++++++++++++++++++++++++++++++
      parameter (n_node=3,n_dwn=2,n_up=0,n_mult=2);
      parameter (m_node=3,m_dwn=0,m_up=2,m_mult=2);
! ________________________________________________________
</pre></td></tr></table>


<hr size="6">
<a name="g_t1D-gridded-model-code"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#g_t1D-gridded-Model-size" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Double-precision" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#g_t1D-gridded-model" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="g_t1D-gridded-Model-coding"></a>
<h3 class="subsection">3.3.2 1D gridded Model coding</h3>

<p>The model code and parameters go in the &lsquo;<tt>zinit</tt>&rsquo; sequence.
</p>
<a name="Parameters-2"></a>
<h4 class="subsubheading">Parameters</h4>

<p>A value for the Miniker parameters and the model parameters should be given in
&lsquo;<tt>zinit</tt>&rsquo;, in our example we have
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">!%%%%%%%%%%%%%%%%%%%%%%
! Parameters
!%%%%%%%%%%%%%%%%%%%%%%
real rk(n_node),rd(n_node),rmassm1(n_node);

data rk/n_node*1./;
data rd/n_node*0.1/;
data rmassm1/n_node*1./;
     dt=.01;
     nstep=5 000;
     modzprint = 1000;
     time=0.;
</pre></td></tr></table>

<a name="Limiting-conditions"></a>
<h4 class="subsubheading">Limiting conditions</h4>

<a name="index-limiting-conditions"></a>

<p>There are four mortran blocks for <code>node</code> and <code>up</code> and <code>down</code>, both
for states and transfers:
</p>
<a name="index-set_005fdwn_005feta"></a>
<a name="index-set_005fdwn_005fphi"></a>
<a name="index-set_005fup_005feta"></a>
<a name="index-set_005fup_005fphi"></a>

<dl compact="compact">
<dt> <code>set_dwn_eta</code></dt>
<dd><p>down node cells
</p></dd>
<dt> <code>set_up_eta</code></dt>
<dd><p>up node cells
</p></dd>
<dt> <code>set_dwn_phi</code></dt>
<dd><p>down node transfers
</p></dd>
<dt> <code>set_up_phi</code></dt>
<dd><p>up node transfers
</p></dd>
</dl>

<p>The following scheme illustrates the example:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample">!%%%%%%%%%%%%%%%%%%%%%%%%%%================================================
! Maillage convention inode
!%%%%%%%%%%%%%%%%%%%%%%%%%%                                 Open ended
!(2 Down    Phi    Eta                         (n_node)
! Eta)  \|       .-----.       .-----.          .-----.        /
! wall  \|-\/\/\-|     |-\/\/\-|     |  . . .  -|     |-\/\/\- |dummy
!  pos  \|--***--|  1  |--***--|  2  |  . . .  -|  n  |--***-- |Phis
! speed \|   1   |_____|   2   |_____|      n   |_____|  n+1   \(2 Up Phi)
!
</pre></td></tr></table>

<p>Two states are associated with the down node, they correspond to the position
and speed of the wall. As the wall don&rsquo;t move these states are initialized to
be 0, and the cells are stationnary cells, therefore these values remain 0.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">! Down cells (wall)
! -----------------
eta_pos_wall = 0; eta_speed_wall = 0.;

set_dwn_eta
&lt; var: eta_pos_wall,  fun: deta_pos_wall  = 0.;
  var: eta_speed_wall, fun: deta_speed_wall= 0.;
&gt;;
</pre></td></tr></table>

<p>There are 2 limiting transfers in the up node. They correspond with an open
end and are therefore set to 0.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">! limiting Transfers : dummy ones
! -------------------------------
set_Up_Phi
&lt; var:ff_dummy_1, fun: f_dummy_1=0.;
  var:ff_dummy_2, fun: f_dummy_2=0.;
&gt;;
</pre></td></tr></table>

<a name="Starting-points-1"></a>
<h4 class="subsubheading">Starting points</h4>

<p>The cell node state values are initialized. They are in an array 
indexed by the <code>inode</code> variable. In the example the variable 
corresponding with position is <code>eta_move</code> and the variable corresponding
with speed is <code>eta_speed</code>. Their initial values are set with the 
following mortran code
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">!---------------
! Initialisation
!---------------
;
do inode=1,n_node &lt;eta_move(inode)=0.01; eta_speed(inode)=0.0;&gt;;
</pre></td></tr></table>

<p>If any transfer needs to be given a first-guess value, this is also done 
using <code>inode</code> as the node index.
</p>
<a name="Grid-node-equations"></a>
<h4 class="subsubheading">Grid node equations</h4>

<a name="index-set_005fnode_005fPhi"></a>
<a name="index-set_005fnode_005feta"></a>
<a name="index-equations_002c-grid"></a>

<p>Each node is associated with an index <code>inode</code>. It allows to refer to the 
preceding node, with <code>inode-1</code> and the following node <code>inode+1</code>.
The node states are declared in <code>set_node_Eta</code> block and the transfers are
in <code>set_node_Phi</code> blocks.
</p>
<p>In the example, the cells are declared with
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">! node cells
! ----------
;
set_node_Eta
&lt; var: eta_move(inode),  fun: deta_move(inode) = eta_speed(inode);
  var: eta_speed(inode),
  fun: deta_speed(inode) = rmassm1(inode)
                             *( - ff_spring(inode+1) + ff_spring(inode)
                               - ff_dump(inode+1)  + ff_dump(inode)
                              );
&gt;;
</pre></td></tr></table>
<p>Note that the <code>inode</code> is dummy in the <code>var:</code> definition and can as
well be written as: <code>var: eta_move(.)</code>.
</p>

<p>The transfers are (<code>ff_spring</code> corresponds with springs and 
<code>ff_dump</code> with dumps):
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">!%%%%%%%%%%%%%%%%%%%%%%
! Transfer definition
!%%%%%%%%%%%%%%%%%%%%%%
! node transfers
! --------------
! convention de signe spring : comprime:= +
set_node_Phi
&lt; var: ff_spring(.),
  fun:
   f_spring(inode)= -rk(inode)*(eta_move(inode) - eta_move(inode-1));
  var: ff_dump(.),
  fun:
   f_dump(inode)  = -rd(inode)*(eta_speed(inode) - eta_speed(inode-1));
&gt;;
</pre></td></tr></table>

<p>The limiting states and transfers are associated with the states or transfers
with index <code>inode+1</code> or <code>inode-1</code> appearing in node cell and 
transfer equations (<code>inode-1</code> for down limiting conditions and 
<code>inode+1</code> for up limiting conditions) in their order of appearance.
In our example, in the <code>eta_speed</code> state node equation
<code>ff_spring(inode+1)</code> appears before <code>ff_dump(inode+1)</code> and is
therefore associated with <code>ff_dummy_1</code> while <code>ff_dump(inode+1)</code> is
associated with the <code>ff_dummy_2</code> limiting transfer, as <code>ff_dummy_1</code>
appears before <code>ff_dummy_2</code> in the limiting up transfers definitions.
Verification of the grid index coherence should be eased with the following
help printed in the listing header:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">



  --------------- Informing on Dwn Eta definition ---------------
 Var-name,            Function-name, index in eta vector
         eta_pos_wall        deta_pos_wall  1 [
       eta_speed_wall      deta_speed_wall  2 [

  -------------- Informing on Eta Nodes definition --------------
 Var-name,     Function, k2index of (inode: 0 [ 1,...n_node ] n_node+1)
            eta_move           deta_move    1 [   3 ...   7 ]   9
           eta_speed          deta_speed    2 [   4 ...   8 ]  10

  ---------------- Informing on Up  Phi  definition -------------
 Var-name,             Function-name, index in ff vector
          ff_dummy_1           f_dummy_1 ]    7
          ff_dummy_2           f_dummy_2 ]    8
         ff_move_sum          f_move_sum ]    9
        ff_speed_sum         f_speed_sum ]   10
  ----------------------------------------------------

 -------------- Informing on Phi Nodes definition ---------------
 Var-name,     Function, k2index of (inode: 0 [ 1,...m_node ] m_node+1)
           ff_spring            f_spring   -1 [   1 ...   5 ]   7
             ff_dump              f_dump    0 [   2 ...   6 ]   8
  ----------------------------------------------------
</pre></td></tr></table>

<p>All variable names and functions are free but has to be
different.
Any particular node-attached variable       k is referred to as: &lsquo;<samp>(inode:k)</samp>&rsquo;,
where       k has to be a Fortran expression allowed in arguments. The symbol 
&lsquo;<samp>inode</samp>&rsquo; is
reserved. As usual other Fortran instructions can be written within the
Mortran block &lsquo;<samp>&lt; &gt;</samp>&rsquo; of each <code>set_</code> block.
</p>
<hr size="6">
<a name="Double-precision"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#g_t1D-gridded-model-code" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Partial-Derivatives" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Double-precision-1"></a>
<h2 class="section">3.4 Double precision</h2>

<p>The default for real variables is the <code>real</code> Fortran type. It is possible to
use double precision instead. In that case all the occurences of &lsquo;<samp>real&nbsp;</samp>&rsquo;
in mortran code is substituted with &lsquo;<samp>double precision&nbsp;</samp>&rsquo; at 
precompilation stage,
and the Lapack subroutine names are replaced by the double precision names.
Eventual users&rsquo;declaration of <code>complex&nbsp;</code> Fortran variables is also 
changed to <code>double complex&nbsp;</code>.
</p>
<p>This feature is turned on by <code>sel double</code> in &lsquo;<tt>selseq.kumac</tt>&rsquo; with cmz
and <code>double = 1</code> in the &lsquo;<tt>Makefile</tt>&rsquo; with make.
</p>
<p>In order for the model to run as well in double as in simple precision, 
some care should be taken to use the generic intrinsic functions, like 
<code>sin</code> and not <code>dsin</code>. No numerical constant should be passed directly 
to subroutines or functions, but instead a variable with the right type should
be used to hold the constant value, taking advantage of the implicit casts 
to the variable type.
</p>
<hr size="6">
<a name="Partial-Derivatives"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Double-precision" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Derivating-a-power-function" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Partial-Derivatives-1"></a>
<h2 class="section">3.5 Partial Derivatives</h2>

<p>The partial derivative rules are included in a <code>Mortran</code> macro series
in &lsquo;<tt>Derive_mac</tt>&rsquo; of Miniker files. When using an anusual function,
one should verify that the corersponding rules are in that file.
It is easy to understand and add new rules in analogy with the already existing ones.
</p>
<p>For instance, suppose one wants to use the intrinsic Fortran function <code> abs()</code>.
Its derivatives uses the other function <code>sign()</code> this way:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example"> &amp;'(ABS(#))(/#)' = '((#1)(/#2)*SIGN(1.,#1))'
</pre></td></tr></table>

<p>In such cases when one is adding a new rule, it is important to use the generic function names
only (i.e. <code>sin</code> not <code>dsin</code>), because when compilating Miniker in the double precision
version, or complex version, the generic names will correctly handle the different variable
types - which is not the case when coding with specific function names.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Derivating-a-power-function">3.5.1 Derivating a power function</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Derivating-a-power-function"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Partial-Derivatives" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Rule-of-programming-non-continuous-models" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Partial-Derivatives" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Derivating-a-power-function-1"></a>
<h3 class="subsection">3.5.1 Derivating a power function</h3>

<p>Partial derivative of a function in exponent is not secure in its Fortran form
<code>g(x,y)**(f(y))</code>. It should be replaced by <code>power(g,f)</code> of 
the Miniker &lsquo;<tt>mathlib</tt>&rsquo;,
or by the explicit form <code>exp(f(y)*log(g(x,y)))</code>.
</p>
<p>Its derivative will have the following form:
</p>

<p>

    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex13x.png" alt="&#x2202;xf g = gfg-1&#x2202;xf + f glogf &#x2202;xg
        g-1
     = f   (g&#x2202;xf + f&#x2202;xg)  " class="math-display" ></center>  
</p>
<p>and is in the macros list already defined in: &lsquo;<tt>DERIVE_MAC</tt>&rsquo;.
</p>
<hr size="6">
<a name="Rule-of-programming-non-continuous-models"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Derivating-a-power-function" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Parameters" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Rule-of-programming-non-continuous-models-1"></a>
<h2 class="section">3.6 Rule of programming non continuous models</h2>

<p>Some models may originally be non continuous, as the ones using a Fortran instruction <code>IF</code>.
Some may use implicitly a step function on a variable. In such cases, the model has to be
set in a derivable form, and use a &ldquo;smooth step&rdquo; instead.
 One should be aware of that this apparently mathematical treatment currently
indeed leads to a physical question about the macroscopic form of a physical law.
At a macroscipic level, a step function is usually a nonsense.
<a name="index-Heaviside-function"></a>
Taking
the example of phase-change, a fluid volume does not change phase at once, and a &ldquo;smooth
change of state&rdquo; is a correct macroscopic model.
</p>
<p>Miniker provides with the smooth step function 
<em>Heavyside</em><a name="DOCF3" href="#FOOT3">(3)</a> in the Miniker &lsquo;<tt>mathlib</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">        Delta = -1.&quot;K&quot;;
        A_Ice =  heavyside(&quot;in:&quot; (T_K-Tf), Delta, &quot;out:&quot; dAIce_dT);
</pre></td></tr></table>

<p>in this example, <code>Tf</code> is the ice fusion-temperature, <code>A_ice</code> 
gives the ice-fraction
of the mesh-volume of water at temperature <code>T_k</code>. 
The smooth-step function is a quasi
hyperbolic tangent function of       x&#x2215;&#x0394;, 
normalised from 0 to 1, with a maximum slope
of 2.5, see figure <a href="#heavy">heavy</a>.
</p>
<div class="float"><a name="heavy"></a>
<img src="heavyside.jpg" alt="heavyside">

</div><p><strong>Figure 3.1: Heaviside function and derivative
</strong>
</p>
<p>For <code>Mortran</code> to be able to symbolicaly compute the partial derivarives, the rule
is in the table of macros as:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">&amp;'(HEAVYSIDE(#,#,#))(/#)' = '((#1)(/#4)*HEAVYDELTA(#1,#2,#3))'
</pre></td></tr></table>

<p>which uses the Foratn entry point <code>HeavyDelta</code> in the Fortrsan function <code>heavyside</code>.
</p>
<p>Another type of problem arises when coding a  
<code>var=min(f(x),g(x))</code> Fortran instruction.
In such a case one does not want a derivative and one will code:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">var = HeavySide(f(x)-g(x),Delta,dum)*g(x) + (1.-HeavySide(f(x)-g(x),Delta,dum)*f(x);
</pre></td></tr></table>

<p>or equivalently:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">var = HeavySide(f(x)-g(x),Delta,dum)*g(x) + HeavySide(g(x)-f(x),-Delta,dum)*f(x);
</pre></td></tr></table>

<p><strong>Warning</strong>: the value of the argument <var>Delta</var> is important because 
it will fix the maximum
slope of the function that will appear as a coefficient in the 
Jacbian matrices.
</p>
<hr size="6">
<a name="Parameters"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Rule-of-programming-non-continuous-models" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Observations-and-data" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Parameters-1"></a>
<h2 class="section">3.7 Parameters</h2>

<p>It is possible to specify some Fortran variables as specific model parameters.
Model parameters
may be used in sensitivity studies (see section <a href="#Sensitivity-to-a-parameter">Sensitivity to a parameter</a>)
and in the adjoint model (see section <a href="#Sensitivity-of-cost-function-to-parameters">Sensitivity of cost function to parameters</a>). 
Nothing special is done with parameters with Kalman filtering.
</p>

<a name="index-Free_005fparameter"></a>

<p>The parameters are fortran variables that should be initialized somewhere 
in &lsquo;<tt>zinit</tt>&rsquo;. For a variable to be considered as a parameter, it should 
be passed as an
argument to the <code>Free_parameters</code> macro. For example if 
<code>apar</code> and <code>cpar</code> (from the predator example) are to be considered
as parameters, <code>Free_parameters</code> should be called with:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">Free_parameter: apar, cpar;
</pre></td></tr></table>



<p>When used with grid1d models (see section <a href="#g_t1D-gridded-model">Describing 1D gridded model</a>) the <code>inode</code> number may appear in 
parenthesis:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">Free_parameter: rd(1), rk(2);
</pre></td></tr></table>

<hr size="6">
<a name="Observations-and-data"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Parameters" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Observations" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Observations-and-data-1"></a>
<h2 class="section">3.8 Observations and data</h2>

<p>Some support for observations and interactions with data is available.
The observations are functions of the model variables. They don&rsquo;t have 
any action on the model result, but they may (in theory) be observed 
and measured. The natural use of these observations is to be compared
with data that correspond with the values from real measurements.
They are used in the Kalman filter (see section <a href="#Kalman-filter">Kalman filter</a>).
</p>
<p>The (model) observation vector is noted       &#x03C9;
and the observation function is noted       h:
</p>
<p>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex14x.png" alt="&#x03C9; = h(&#x03B7;,&#x03C6; )  " class="math-display" ></center>  
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Observations">3.8.1 Observations</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Data">3.8.2 Data</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Observations"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Observations-and-data" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Data" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Observations-and-data" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Observations-1"></a>
<h3 class="subsection">3.8.1 Observations</h3>

<a name="index-mobs"></a>

<p>The observation functions are set in a <code>set_probe</code> block in 
the &lsquo;<tt>zinit</tt>&rsquo; sequence.
</p>
<a name="index-observation-function"></a>


<p>For example suppose that, in the predator-prey model, we only 
have access to the total population of preys and predators, we would have:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">set_probe
&lt; eqn: pop = eta_pred + eta_pray;
&gt;;
</pre></td></tr></table>


<a name="index-obs_002edata"></a>

<p>The number of observations is put in the integer variable <code>mobs</code>.
The observation vector corresponds with the part of the <code>ff(.)</code> 
array situated past the regular transferts, <code>ff(mp+.)</code>, and is output
in the file &lsquo;<tt>obs.data</tt>&rsquo;.
</p>

<hr size="6">
<a name="Data"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Observations" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Explicit-model-size" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Observations-and-data" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Data-1"></a>
<h3 class="subsection">3.8.2 Data</h3>

<a name="index-zgetobs"></a>
<a name="index-vobs_0028_002e_0029"></a>
<a name="index-data_002edata"></a>

<p>Currently this code is only used if the Kalman code is activated. This
may be changed in the future.
</p>
<p>The convention for data is that whenever some data are available, the 
logical variable <code>zgetobs</code> should be set to &lsquo;<samp>.true.</samp>&rsquo;. And the
<code>vobs(.)</code> vector should be filled with the data values. This 
vector has the same dimension than the observation
vector and each coordinate is meant to correspond with one
coordinate of the observation vector.
</p>
<p>This feature is turned on by setting the logical variable <code>zdata</code>
to &lsquo;<samp>.true.</samp>&rsquo;, and the <code>zgetobs</code> flag is typically set in the
&lsquo;<tt>zsteer</tt>&rsquo; sequence (see section <a href="#End-of-time-step">Executing code at the end of each time step</a>).
Every instant data are available (<code>zgetobs</code> is true) the observations
are written to the file &lsquo;<tt>data.data</tt>&rsquo;. With the Kalman filter more 
informations are output to the &lsquo;<tt>data.data</tt>&rsquo; file, 
see <a href="#Kalman-filter-results">Kalman filter results</a>.
</p>

<hr size="6">
<a name="Explicit-model-size"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Data" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Size-sequence" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Entering-model-size-explicitely"></a>
<h2 class="section">3.9 Entering model size explicitely</h2>

<p>It is possible to enter the model dimensions explicitely, instead of 
generating them automatically, as it was done previously.
This feature is turned on by <code>sel dimetaphi</code> 
in &lsquo;<tt>selseq.kumac</tt>&rsquo; with cmz
and <code>dimetaphi</code> added to the <code>SEL</code> variable in 
the &lsquo;<tt>Makefile</tt>&rsquo; with make.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Size-sequence">3.9.1 The explicit size sequence</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Size-sequence"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Explicit-model-size" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Model-with-explicit-size" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Explicit-model-size" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="The-explicit-size-sequence"></a>
<h3 class="subsection">3.9.1 The explicit size sequence</h3>

<a name="index-dimetaphi"></a>
<a name="index-model-size"></a>
<a name="index-np-1"></a>
<a name="index-mp-1"></a>
<a name="index-maxstep"></a>
<a name="index-dimetaphi-1"></a>

<p>The dimension of the model is entered in the sequence &lsquo;<tt>dimetaphi</tt>&rsquo;,
using the fortran <code>parameter np</code> for <code>eta(.)</code> and
<code>mp</code> for <code>ff(.)</code>.
For the Lotka-Volterra model, we have two cell components and only one transfer.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">parameter (np=2,mp=1);
</pre></td></tr></table>

<p>You should not change the layout of the parameter statement as the 
mortran preprocessor matches the line.
</p>
<p>You also have to provide other parameters even if you don&rsquo;t have any 
use for them. If you don&rsquo;t it will trigger fortran errors.
It includes the <code>maxstep</code> parameter that can have any value but 0,
<code>lp</code> and <code>mobs</code> that should be 0 in the example, and  <code>nxp</code>,
<code>nyp</code> and <code>nzp</code> that should also be 0.
The layout is the following:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">parameter (np=2,mp=1);
parameter (mobs=0);

parameter (nxp=0,nyp=0,nzp=0);
parameter (lp=0);
parameter (maxstep=1);
</pre></td></tr></table>

<p>If there are observations, (see section <a href="#Observations">Observations</a>), the
size of the observation vector is set in the &lsquo;<tt>dimetaphi</tt>&rsquo; sequence
by the <code>mobs</code> parameter. For example if there is one observation:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">parameter (mobs=1);
</pre></td></tr></table>

<p>To specify parameters (see section <a href="#Parameters">Parameters</a>), the number of such parameters 
has to be declared in &lsquo;<tt>dimetaphi</tt>&rsquo; with the parameter <code>lp</code>. 
Then, if there are two parameters, they are first declared with
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">parameter (lp=2);
</pre></td></tr></table>

<hr size="6">
<a name="Model-with-explicit-size"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Size-sequence" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Programming-with-cmz-directives" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Explicit-model-size" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Entering-the-model-equations_002c-with-explicit-sizes"></a>
<h3 class="subsection">3.9.2 Entering the model equations, with explicit sizes</h3>

<a name="index-model-equations"></a>
<a name="index-Phi_005ftef_0028_002e_0029"></a>
<a name="index-deta_005ftef_0028_002e_0029"></a>
<a name="index-eta_0028_002e_0029_002c-explicit-sizes"></a>
<a name="index-ff_0028_002e_0029_002c-explicit-sizes"></a>

<p>When sizes are explicit, another possibility exists for entering
the model equations. The use of symbolic names, as described in
<a href="#Model-equations">Model equations</a> is still possible, and it also becomes possible to
set directly the equations associated with the <code>eta(.)</code>
and <code>ff(.)</code> vectors.
</p>
<p>In case the symbolic names are not used, 
the model equations for cells and transfers are entered using a mortran macro,
<code>f_set</code><a name="DOCF4" href="#FOOT4">(4)</a>, setting the <code>eta(.)</code> evolution with 
<code>deta_tef(.)</code>
and the transfer definitions <code>ff(.)</code> with <code>Phi_tef(.)</code>.
</p>
<dl>
<dt><a name="index-f_005fset"></a><u>Macro:</u> <b>f_set</b><i> Phi_tef(<var>i</var>) = f(eta(.),ff(.))</i></dt>
<dd><p>This macro defines the transfer <var>i</var> static equation.
<code>f</code> is a fortran 
expression which may be function of cell state variables, 
&lsquo;<samp>eta(1)</samp>&rsquo;&hellip;&lsquo;<samp>eta(np)</samp>&rsquo; and transfers 
&lsquo;<samp>ff(1)</samp>&rsquo;&hellip;&lsquo;<samp>ff(mp)</samp>&rsquo;.
</p></dd></dl>

<p>In the case of the predator-prey model, the transfer definition for 
      &#x03C6;meet is:
</p><table><tr><td>&nbsp;</td><td><pre class="example">f_set Phi_tef(1) = eta(1)*eta(2);  
</pre></td></tr></table>

<dl>
<dt><a name="index-f_005fset-1"></a><u>Macro:</u> <b>f_set</b><i> deta_tef(<var>i</var>) = g(eta(<var>i</var>),ff(.))</i></dt>
<dd><p>This macro defines the cell state component <var>i</var> time evolution model. 
<code>g</code> is a expression which may be function of cell state variables, 
&lsquo;<samp>eta(1)</samp>&rsquo;&hellip;&lsquo;<samp>eta(np)</samp>&rsquo; and transfers 
&lsquo;<samp>ff(1)</samp>&rsquo;&hellip;&lsquo;<samp>ff(mp)</samp>&rsquo;.
</p></dd></dl>

<p>The two cell equations of the predator-prey model are, with index 1 for the
prey (      &#x03B7;prey) and index 2 for the predator (      &#x03B7;pred):
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">f_set  deta_tef(1) = apar*eta(1)-apar*ff(1);
f_set  deta_tef(2) = - cpar*eta(2) + cpar*ff(1);
</pre></td></tr></table>

<p>The whole model is:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">!%%%%%%%%%%%%%%%%%%%%%%
! Transfer definition
!%%%%%%%%%%%%%%%%%%%%%%
! rencontres (meeting)
    f_set Phi_tef(1) = eta(1)*eta(2); 

!%%%%%%%%%%%%%%%%%%%%%%
! Cell definition
!%%%%%%%%%%%%%%%%%%%%%%
! eta(1) : prey
! eta(2) : predator      

    f_set  deta_tef(1) = apar*eta(1)-apar*ff(1);
    f_set  deta_tef(2) = - cpar*eta(2) + cpar*ff(1);
</pre></td></tr></table>

<p>The starting points for cells are entered like:
</p><table><tr><td>&nbsp;</td><td><pre class="example">!     initial state
!     -------------
     eta(1) = 1.;
     eta(2) = 1.;
</pre></td></tr></table>

<p>If there are observations, they are entered as special transferts with
index above <code>mp</code>, for example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">f_set Phi_tef(mp+1) = ff(1) ;
</pre></td></tr></table>

<hr size="6">
<a name="Programming-with-cmz-directives"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Model-with-explicit-size" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-used-with-Miniker" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Programming-with-cmz-directives-1"></a>
<h2 class="section">3.10 Programming with cmz directives</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Cmz-directives-used-with-Miniker">3.10.1 Cmz directives used with Miniker</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Using-cmz-directives-in-Miniker">3.10.2 Using cmz directives in Miniker</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Cmz-directives-used-with-Miniker"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Programming-with-cmz-directives" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Using-cmz-directives-in-Miniker" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Programming-with-cmz-directives" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Cmz-directives-used-with-Miniker-1"></a>
<h3 class="subsection">3.10.1 Cmz directives used with Miniker</h3>

<p>The main feature of cmz directive is to use code conditionnaly for a given
select flag. For example when the double precision is selected
(see section <a href="#Double-precision">Double precision</a>) the use of the conditionnal 
<code>double</code> flag may be required in case there is a different subroutine 
name for different types. If, for example, the user use the subroutine
<code>smysub</code> for simple precision and <code>dmysub</code> for double
precision the following code is an example of what could appear in the
user code:
</p>
<pre class="verbatim">+IF,double
 call dmysub(eta);
+ELSE
 call smysub(eta);
+ENDIF
</pre>
<p>For a complete reference on cmz directives see the appendix
<a href="#Cmz-directives-reference">Cmz directives reference</a>.
</p>
<hr size="6">
<a name="Using-cmz-directives-in-Miniker"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Cmz-directives-used-with-Miniker" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Programming-with-cmz-directives" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Using-cmz-directives-in-Miniker-1"></a>
<h3 class="subsection">3.10.2 Using cmz directives in Miniker</h3>

<p>In cmz the KEEP and DECK have their cmz directives preprocessed as part
of the source files extraction. And the +KEEP and +DECK 
directives are automatically
set when creating the KEEP or DECK. With make, files with these directives 
has to be created within the files that are to be preprocessed by the
cmz directives preprocessor.
</p>
<p>To be processed by make, a file that contains cmz directives 
should have a file suffix corresponding
with the language of the resulting file and with the normal file suffix of
that language. More precisely &lsquo;<samp>cm</samp>&rsquo; should be added before the normal
file suffix and after the &lsquo;<samp>.</samp>&rsquo;. Therefore if the resulting file language
is associated with a suffix &lsquo;<samp>.<var>suf</var></samp>&rsquo;, the file with cmz directives
should have a &lsquo;<samp>.cm<var>suf</var></samp>&rsquo; suffix. The tradition is to have
a different suffix for main files and include files. 
To add directories searched for <em>cmfiles</em> (files with cmz directives) 
they should be added to the <code>CMFDIRS</code> makefile variable, separated 
by &lsquo;<samp>:</samp>&rsquo;.
</p>
<p>Rules for preprocessing of the files are defined in the file 
&lsquo;<tt>Makefile.miniker</tt>&rsquo; for the file types described in 
<a href="#tab_003acmfile_005fsuffix">tab:cmfile_suffix</a>:
</p>
<div class="float"><a name="tab_003acmfile_005fsuffix"></a>
<table>
<thead><tr><th>language</th><th>file type</th><th>cmfile suffix</th><th>suffix</th><th>language</th></tr></thead>
<tr><td>fortran</td><td>main/deck</td><td>.cmf</td><td>.f</td><td>ftn</td></tr>
<tr><td>fortran preprocessed</td><td>main/deck</td><td>.cmF</td><td>.F</td><td>f77</td></tr>
<tr><td>fortran preprocessed</td><td>include/keep</td><td>.cminc</td><td>.inc</td><td>f77</td></tr>
<tr><td>mortran</td><td>main/deck</td><td>.cmmtn</td><td>.mtn</td><td>mtn</td></tr>
<tr><td>mortran</td><td>include/keep</td><td>.cmmti</td><td>.mti</td><td>mtn</td></tr>
</table>

</div><p><strong>table 3.2: Association between file language, file type, file suffixes and 
language identifier in cmz directives. A main file is called a <em>deck</em>
in cmz and an include file is called a <em>keep</em>.
</strong>
</p>
<hr size="6">
<a name="Dynamic-system-analysis"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Using-cmz-directives-in-Miniker" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Sensitivities" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-programming" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Dynamic-analysis-of-systems-in-Miniker"></a>
<h1 class="chapter">4. Dynamic analysis of systems in Miniker</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Sensitivities">4.1 Automatic sensitivity computation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Adjoint-model-and-optimisation">4.2 Adjoint model and optimisation with Miniker</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Kalman-filter">4.3 Kalman filter</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Feedback-gain">4.4 Feedback gain</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Stability-of-fastest-modes">4.5 Stability analysis of fastest modes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Generalized-TLS">4.6 Generalized linear tangent system analysis</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Sensitivities"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Sensitivity-to-a-parameter" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Automatic-sensitivity-computation"></a>
<h2 class="section">4.1 Automatic sensitivity computation</h2>

<a name="index-sensitivities"></a>

<p>An obvious advantage of having acces to the Jacobian matrices along the
system trajectory concerns automatic sensitivity analyses, as either:
</p><ul>
<li> the sensitivity of all variables to perturbation in the initial condition
      of one state variable;
</li><li> the same sensitivities to an initial pulse (or step) on a transfer;
</li><li> the same sensitivities to a series of pulses (or steps) on a transfer;
</li><li> the same for a change in a parameter, eventually during the run;
</li><li> the sensitivity of the matrix of advance in state space to a change
 in a parameter.
</li></ul>

<p>This is declared in Zinit as:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">! -------------
! Sensitivities
! -------------
Sensy_to_var
&lt; var: eta_pray, pert: INIT;
  var: eta_pred, pert: INIT;
&gt;;
</pre></td></tr></table>

<p>Each variable at origin of a perturbation is declared as <code>var:</code>,
and the type of perturbation in <code>pert:</code>. Here, INIT conditions are
only allowed because the two variables are states variables. For transfers,
<code>pert: pulse</code> corresponds to an initial pulse, <code>pert: step_resp</code>
and  <code>pert: step_eff</code> to initial steps, the difference between 
<code>_resp</code> (response form)
and <code>_eff</code> (effect form) concerns the 
diagonal only of the sensitivity matrix
(see Feedback gains in non-linear models).
</p>
<p>Non initial perturbation can also be asked for:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">  Sensy_to_var
  &lt;
!*     var: eta_courant_L, pert: init at 100;
!*     var: ff_T_czcx,     pert: pulse at 100 every 20;
!*     var: ff_Psi_Tczcx,  pert: step_eff;
!*     var: ff_Psi_Tczcx,  pert: step_Resp at 10 every 100;
! *** premiers tests identiques a lorhcl.ref
    var: ff_courant_L , pert: step_eff;
    var: ff_T_czcx    , pert: step_eff;
    var: ff_Psi_Tczcx , pert: step_eff;
    var: ff_Psi_Tsz   , pert: pulse at 100 every 50;
  &gt;;
</pre></td></tr></table>

<p>In this example taken from &lsquo;<tt>lorhcl</tt>&rsquo;, a sensitivity can increase so as to
trespass the Fortran capacity, so that each  sensitivity vector (matrix column)
can be reset at some time-increment <code>at III every JJJ;</code>
</p>
<p>It is noteworthy that these sensitivity analyses are not based
on difference between two runs with different initial states or
parameter values, but on the formal derivatives of the model. This method 
is not only numerically robust, but is also rigorously funded as based on 
the TLS of the model<a name="DOCF5" href="#FOOT5">(5)</a>.
</p>
<p>If the <code>dimetaphi</code> sequence is built by the users, he should declare
the number of perturbing variables as <code>nxp=</code>:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">      parameter (nxp=np,nyp=0,nzp=0);
</pre></td></tr></table>
<p>here, all state variables are considered as perturbing variables.
</p>
<a name="index-sensitivity_002c-output"></a>
<a name="index-output_002c-sensitivity"></a>
<a name="index-sens_002edata"></a>
<a name="index-sigma_002edata"></a>

<p>The sensitivity vectors are output in the result files &lsquo;<tt>sens.data</tt>&rsquo; for 
cells and &lsquo;<tt>sigma.data</tt>&rsquo; for transfers. In those files the first column
corresponds again with time, and the other columns are relative sensitivities of the cell
states (in &lsquo;<tt>sens.data</tt>&rsquo;) and transfers (in &lsquo;<tt>sigma.data</tt>&rsquo;)
with respect to the initial value of the perturbed state. 
</p>
<p>In our predator-prey example, the second column of  &lsquo;<tt>sens.data</tt>&rsquo; will contain
the derivative of       &#x03B7;1(t) with respect to       &#x03B7;1(t = 0).
Drawing the
second column of &lsquo;<tt>sens.data</tt>&rsquo; against the first one
gives the time evolution of the sensitivity of <code>eta-pred</code>
to a change in the initial value of <code>eta-pray</code>. One can check
in that it is set to 1 at       t = 0:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">#    Sensy_to: eta_pray         3        eta_pred         5       
# time \\  of: eta_pray     eta_pred     eta_pray     eta_pred    
  0.00000E+00  1.00000E+00  0.00000E+00  0.00000E+00  1.00000E+00
  1.00000E-02  9.90868E-01  1.11905E-02 -1.26414E-02  9.98859E-01
</pre></td></tr></table>
<p>The two last columns are the state sensitivity to a change in initial conditions
of the number of predators.
</p>
<p>In the same way, the <var>j+1</var>th column of &lsquo;<tt>sigma.data</tt>&rsquo; will be the
derivative of       &#x03D5;j(t) with respect to       &#x03B7;i(t = 0)
. Here:
</p><table><tr><td>&nbsp;</td><td><pre class="example">#    Sensy_to: eta_pray     eta_pred    
# time \\  of: ff_interact  ff_interact 
  0.00000E+00  1.60683E+00  8.47076E-01
  1.00000E-02  1.59980E+00  8.18164E-01
</pre></td></tr></table>

<p>the unique transfer variable gives rise to two sensitivity columns. 
</p>
<p>Sensitivity studies are usefull to assess the
predictability properties of the corresponding system.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Sensitivity-to-a-parameter">4.1.1 Sensitivity to a parameter</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Advance-matrix-sensitivity">4.1.2 Advance matrix sensitivity</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>



<hr size="6">
<a name="Sensitivity-to-a-parameter"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Sensitivities" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advance-matrix-sensitivity" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Sensitivities" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Sensitivity-to-a-parameter-1"></a>
<h3 class="subsection">4.1.1 Sensitivity to a parameter</h3>

<p>A forward sensitivity to a parameter will be computed when specified as
described in <a href="#Parameters">Parameters</a>. For example, suppose that
the sensitivity to an initial change in the <code>apar</code> parameter of
the predator model is of interest. 
</p>
<p>The sensitivity calculs is turned on as a forward
parameter specified on the <code>Free_parameter</code> list:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">Free_parameter: [fwd: apar, cpar];
</pre></td></tr></table>

<p>The result are in &lsquo;<tt>sensp.data</tt>&rsquo; for cells and &lsquo;<tt>sigmap.data</tt>&rsquo;
for transfers.
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">#    Sensy_to: pi_prandtl       3            4        pi_rayleigh_     6
# time \\  of: eta_courant_ eta_T_czcx   eta_T_sz     eta_courant_ eta_T
  0.00000E+00  0.00000E+00  0.00000E+00  0.00000E+00  0.00000E+00  0.000
  2.00000E-03 -4.77172E-03 -3.99170E-05  3.55971E-05 -9.94770E-05 -1.004
</pre></td></tr></table>
<p>In the above example from &lsquo;<tt>lorhcl</tt>&rsquo; sensitivity of the three states with respect
to an initial change in two parameters are independantly given (first line also numbers
the column to easy gnuplot using).
</p>
<hr size="6">
<a name="Advance-matrix-sensitivity"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Sensitivity-to-a-parameter" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Adjoint-model-and-optimisation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Sensitivities" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Advance-matrix-sensitivity-1"></a>
<h3 class="subsection">4.1.2 Advance matrix sensitivity</h3>


<p>It is possible to look at the sensitivity of the matrix of advance in 
states space (the matrix <code>aspha</code>) with regard to a parameter. 
The parameter must be accounted for in the parameter number and be in the 
parameter list, flagged as the matrix <code>mx</code> parameter, like in
</p><table><tr><td>&nbsp;</td><td><pre class="example">Free_parameter: [mx: apar], cpar;
</pre></td></tr></table>

<a name="index-d_005fpi_005faspha_0028_002e_002c_002e_0029"></a>

<p>This feature is associated with a selecting flag, &lsquo;<samp>dPi_aspha</samp>&rsquo;. One gets
the result in the matrix <code>d_pi_aspha(.,.)</code> of dimension 
(<code>np</code>,<code>np</code>).
</p>
<p>This matrix may be used to compute other quantities, for example
it may be used to compute the sensitivity of the eigenvalues of
the state-advance matrix with regard to the <code>[fwd]</code> parameter.
These additional computations have to be programmed by the user in 
&lsquo;<tt>zsteer</tt>&rsquo; with matrices declared and initialized in 
&lsquo;<tt>zinit</tt>&rsquo;. An example is given in the example &lsquo;<tt>lorhcl</tt>&rsquo;
provided with the Miniker installation files, following a method proposed
by Stephane Blanco.
</p>
<hr size="6">
<a name="Adjoint-model-and-optimisation"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Advance-matrix-sensitivity" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Overview-of-optimisation-with-Miniker" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Adjoint-model-and-optimisation-with-Miniker"></a>
<h2 class="section">4.2 Adjoint model and optimisation with Miniker</h2>

<p>In the following a possible use of Miniker for optimisation is discussed.
More precisely the use of adjoint and control laws in Miniker are presented.
Optimisation isn&rsquo;t the only application of these tools, but it is the most
common one. In that case the adjoint may be used to determine the gradient of a
functional to perturbations in the control laws, and an optimisation process
can use this
information to search for the optimum.
Another application of the adjoint is to compute the sensitivity of a
cost function to parameters (the ones declared in the <code>free_parameters:</code>&rsquo; list.
Note that the cost function can be sensitive to probe&rsquo;s variables, even if these are
uncoupled with standard variables in the forward calculations; this is the case
when minimizing a quadratic distance function between probes (from the  model)
and the corresponding measurements.
</p>
<p>The code is close transcription of the mathematical calculus described
in<br> <a href="http://www.lmd.jussieu.fr/ZOOM/doc/Adjoint.pdf">http://www.lmd.jussieu.fr/ZOOM/doc/Adjoint.pdf</a> . It essentialy reverse time and
transpose the four Jacobian matrices: states and transfers are saved in array dimensionned
with <code>maxstep</code> Fortran parameter.
</p><table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Overview-of-optimisation-with-Miniker">4.2.1 Overview of optimisation with Miniker</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Cost-function-coding-and-adjoint-modeling">4.2.3 Cost function coding and adjoint modeling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Sensitivity-of-cost-function-to-parameters">4.2.4 Sensitivity of cost function to parameters</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Overview-of-optimisation-with-Miniker"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Adjoint-model-and-optimisation" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Control-laws" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Adjoint-model-and-optimisation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Overview-of-optimisation-with-Miniker-1"></a>
<h3 class="subsection">4.2.1 Overview of optimisation with Miniker</h3>

<a name="index-adjoint"></a>
<a name="index-optimisation"></a>

<p>In the proposed method, Miniker is run twice, one time forward and then
backward to determine the trajectory and the adjoint model. After that the 
control laws are modified by a program external to Miniker. The same steps
are repeated until convergence. More pecisely,
</p>
<dl compact="compact">
<dt> <strong>forward</strong></dt>
<dd><p>The command law       h(t) is given (by an explicit law or taken from a file).
The trajectory is computed in a classical way, with the additionnal computation
of the functional to be optimised,       J, prescribed with specific 
<code>f_set</code> macros. The states, transfers and control laws are stored.  
</p></dd>
<dt> <strong>backward</strong></dt>
<dd><p>The adjoint variable is computed from the last time       T backward. The
time increment is re-read as it could have changed during the forward 
simulation. The system is solved by using the same technics as in the forward 
simulation, but with a negative time step.
</p></dd>
<dt> <strong>external phase</strong></dt>
<dd><p>Now the command should be corrected. This step isn&rsquo;t covered here, but, for
example, minuit the optimisation tool from the CERN could be used. 
In order to ease such a use of Miniker, the principal program has to be 
compiled as a subroutine to be driven by an external program 
(see section <a href="#Calling-the-model-code">Calling the model code</a>).
</p></dd>
</dl>

<p>The functionnal       J to be optimised is defined as
</p>
<p>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex15x.png" alt="                       &#x222B; T
J = &#x03C8; [&#x03B7;(T),&#x03C6;(T),h(T)]+    l[&#x03B7;(&#x03C4;),&#x03C6; (&#x03C4; ),h(&#x03C4;)]d&#x03C4;
                        0  " class="math-display" ></center>  
</p>
<a name="index-final-cost"></a>
<a name="index-integrand-cost"></a>

<p>Where       &#x03C8; is the final cost function,       l is the integrand
cost function and       h represents the control laws variations.
</p>
<p>The general use of the adjoint model of a system is the determination of the 
gradient of this       J functional to be optimised, with respect to perturbations
of the original conditions of the reference trajectory, that is, along its 
GTLS<a name="DOCF6" href="#FOOT6">(6)</a>.
</p>
<hr size="6">
<a name="Control-laws"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Overview-of-optimisation-with-Miniker" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cost-function-coding-and-adjoint-modeling" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Adjoint-model-and-optimisation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Control-laws-1"></a>
<h3 class="subsection">4.2.2 Control laws</h3>

<a name="index-zcommand"></a>
<a name="index-command-law"></a>

<p>Each control law is associated with one cell or transfer equation, meaning that a command
associated with an equation does not appear in any other equation.
It is still possible
to add commands acting anywhere by defining a transfer equal to that command.
</p>

<p>The control laws associated with states are in the <code>ux_com(.)</code> array, 
control laws associated with transfers are in the <code>uy_com(.)</code> array.
The control laws may be prescribed even when there is no adjoint computed, 
nor any optimisation, and they are used during simulation, in which case they will
act as external sources. To enable
the use of commands, the logical flag <code>Zcommand</code> should be <code>.true.</code>.
</p>
<a name="index-uxcom_002edata"></a>
<a name="index-uycom_002edata"></a>

<p>The command can be given either as: 
</p><ol>
<li> a table of numerical
values in the files &lsquo;<tt>uxcom.data</tt>&rsquo; and &lsquo;<tt>uycom.data</tt>&rsquo;.
</li><li> a function
<a name="index-zlaw"></a>
<a name="index-zcmd_005flaw"></a>
<a name="index-zcmd_005flaw_002einc"></a>
of the problem variables. To turn that feature on the logical flag 
<code>Zlaw</code> should be set to <code>.true.</code> in &lsquo;<tt>zinit</tt>&rsquo;. The sequence 
&lsquo;<tt>zcmd_law</tt>&rsquo; should hold
the code filling the <code>ux_com(.)</code> and <code>uy_com(.)</code> arrays, as the code
from that sequence is used whenever the control laws are needed.
In that case the files  &lsquo;<tt>uxcom.data</tt>&rsquo; and &lsquo;<tt>uycom.data</tt>&rsquo; will 
be filled by the command values generated by the function along the trajectory.
</li></ol>

<p>For example in the Lotka-Volterra model, the parameter <code>apar</code> could 
be a control variable.
In that case, <code>apar</code> would be defined as the variable <code>ux_com(1)</code>, 
and either entered as a law
in the sequence &lsquo;<tt>zcmd_law</tt>&rsquo; , either written in the file &lsquo;<tt>uxcom.data</tt>&rsquo; 
step by step. In that case, there must be a perfect corresponodence between time
of the commands and time of the run.
</p>
<hr size="6">
<a name="Cost-function-coding-and-adjoint-modeling"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Control-laws" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Sensitivity-of-cost-function-to-parameters" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Adjoint-model-and-optimisation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Cost-function-coding-and-adjoint-modeling-1"></a>
<h3 class="subsection">4.2.3 Cost function coding and adjoint modeling</h3>

<a name="index-zback"></a>
<a name="index-cout_005fPsi"></a>
<a name="index-cout_005fl"></a>

<p>First of all the flag <code>zback</code> should be set to <code>.true.</code> in order to
allow adjoint model computation:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">Zback=.true.;
</pre></td></tr></table>

<p>The two functions <code>cout_Psi</code> corresponding with the final cost and 
<code>cout_l</code> corresponding with the integrand cost are set up with the
<code>f_set</code> macros.
</p>
<dl>
<dt><a name="index-f_005fset-2"></a><u>Macro:</u> <b>f_set</b><i> cout_Psi = f(eta(.),ff(.),ux_com(.),uy_com(.))</i></dt>
<dd><p>This macro defines the final cost function.
<code>f</code> is a fortran 
expression which may be function of cell state variables, 
&lsquo;<samp>eta(1)</samp>&rsquo;&hellip;&lsquo;<samp>eta(np)</samp>&rsquo;, transfers 
&lsquo;<samp>ff(1)</samp>&rsquo;&hellip;&lsquo;<samp>ff(mp)</samp>&rsquo;, 
state control laws
&lsquo;<samp>ux_com(1)</samp>&rsquo;&hellip;&lsquo;<samp>ux_com(np)</samp>&rsquo;, and transfer control laws
&lsquo;<samp>uy_com(1)</samp>&rsquo;&hellip;&lsquo;<samp>uy_com(mp)</samp>&rsquo;.
</p></dd></dl>

<dl>
<dt><a name="index-f_005fset-3"></a><u>Macro:</u> <b>f_set</b><i> cout_l = f(eta(.),ff(.),ux_com(.),uy_com(.))</i></dt>
<dd><p>This macro defines the integrand cost function.
<code>f</code> is a fortran 
expression which may be function of cell state variables, 
&lsquo;<samp>eta(1)</samp>&rsquo;&hellip;&lsquo;<samp>eta(np)</samp>&rsquo;, transfers 
&lsquo;<samp>ff(1)</samp>&rsquo;&hellip;&lsquo;<samp>ff(mp)</samp>&rsquo;,
state control laws
&lsquo;<samp>ux_com(1)</samp>&rsquo;&hellip;&lsquo;<samp>ux_com(np)</samp>&rsquo;, and transfer control laws
&lsquo;<samp>uy_com(1)</samp>&rsquo;&hellip;&lsquo;<samp>uy_com(mp)</samp>&rsquo;.
</p></dd></dl>

<p>For example, the following code sets a cost function for the masselottes
model:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">! Initialisation 
  F_set cout_Psi = eta_move(inode:1);
!and f_set cout_l integrand in the functionnal    
  F_set cout_l = 0.;
</pre></td></tr></table>

<p>In that example the functional is reduced to the final value
of the first state component.
Here, the adjoint vector will correspond to the final sensitivity 
(at       t = 0) of 
that component (here the first masselotte position) to a perturbation in 
all initial conditions<a name="DOCF7" href="#FOOT7">(7)</a>. 
</p>
<p>The following variables are set during the backward phase, and output
in the associated files:
</p>

<table>
<thead><tr><th>var</th><th>file</th><th>explanation</th></tr></thead>
<tr><td><code>v_adj(.)</code></td><td>&lsquo;<tt>vadj.data</tt>&rsquo;</td><td>adjoint to <code>eta(.)</code></td></tr>
<tr><td><code>w_adj(.)</code></td><td>&lsquo;<tt>wadj.data</tt>&rsquo;</td><td>adjoint to <code>ff(.)</code></td></tr>
<tr><td><code>wadj(mp+.)</code></td><td>&lsquo;<tt>gradmuj.data</tt>&rsquo;</td><td>adjoint to <code>ff(mp+.)</code></td></tr>
<tr><td><code>graduej(.)</code></td><td>&lsquo;<tt>gradxj.data</tt>&rsquo;</td><td>adjoint to <code>ux_com(.)</code></td></tr>
<tr><td><code>gradufj(.)</code></td><td>&lsquo;<tt>gradyj.data</tt>&rsquo;</td><td>adjoint to <code>uy_com(.)</code></td></tr>
<tr><td><code>hamilton</code></td><td>&lsquo;<tt>hamilton.data</tt>&rsquo;</td><td>time increment, hamiltonian, cost function increment</td></tr>
</table>

<hr size="6">
<a name="Sensitivity-of-cost-function-to-parameters"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Cost-function-coding-and-adjoint-modeling" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Adjoint-model-and-optimisation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Sensitivity-of-cost-function-to-parameters-1"></a>
<h3 class="subsection">4.2.4 Sensitivity of cost function to parameters</h3>

<a name="index-gradpj_002edata"></a>

<p>The sensitivity of the cost function to all the parameters given as
arguments of <code>Free_parameters</code> is computed. For the
predator model the sensitivity of a cost function consisting in 
the integral of the predator population with respect with
<code>apar</code> an <code>cpar</code> is obtained with a number of parameters
set to 2 in &lsquo;<tt>dimetaphi</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">parameter (lp=2);
</pre></td></tr></table>

<p>And the cost function and <code>Free_parameters</code> list in &lsquo;<tt>zinit</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">f_set cout_Psi = eta(2);
f_set cout_l = eta(2);
Free_parameters: apar,cpar;
</pre></td></tr></table>

<p><code>apar</code> and <code>cpar</code> also have to be given a value.
The result is output in &lsquo;<tt>gradpj.data</tt>&rsquo;.
</p>
<hr size="6">
<a name="Kalman-filter"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Sensitivity-of-cost-function-to-parameters" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Coding-the-Kalman-filter" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Kalman-filter-1"></a>
<h2 class="section">4.3 Kalman filter</h2>

<a name="index-Kalman-filter"></a>
<a name="index-variance_002dcovariance-matrices_002c-general"></a>
<a name="index-observations_002c-general"></a>

<p>The Kalman filter allows for data assimilation along the model run. In 
that case it is assumed that there is a real-world model with stochastic
perturbations on the states, and that noisy observations are available. 
The situation implemented in Miniker corresponds to a continuous 
stochastic perturbation on the state, and discrete noisy observations.
In the <acronym title="Transfer Evolution Formalism">TEF</acronym> this leads to:
</p>
<p>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex16x.png" alt="&#x2202;t&#x03B7;(t) = g(&#x03B7;(t),&#x03C6;(t))+ W (t)&#x03BC;
 &#x03C6; (t) = f (&#x03B7;(t),&#x03C6; (t))

 &#x03C9; (t) = h (&#x03B7;(t),&#x03C6; (t))+ &#x03BD;  " class="math-display" ></center>  
</p>

<p>The observations       &#x03C9; are available at discrete time steps       t = si. The
stochastic perturbation on state,       &#x03BC; is characterized by a 
variance-covariance matrix       Q
 and the noise on the observation,
      &#x03BD; has a variance-covariance matrix       R.       W relates states
with stochastic perturbations. At each time step the Kalman filter recomputes 
an estimation of the state and the variance-covariance matrix of the state.
</p>
<p>In the following we use the example of a linear model with perturbation 
on state and observation of state. The model has 3 states and 3 corresponding
transfers (equal to the states), but the error on the state is of dimension 
2. The 3 states are observed. The corresponding equations read:
</p>
<p>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex17x.png" alt="(
|{ &#x2202;t&#x03B7;1 = a11&#x03B7;1 + a12&#x03C6;2 + a13&#x03C6;3 + W11 &#x03BC;1 + W12&#x03BC;2
| &#x2202;t&#x03B7;2 = a21&#x03C6;1 + a22&#x03B7;2 + a23&#x03C6;3 + W21 &#x03BC;1 + W22&#x03BC;2
( &#x2202;t&#x03B7;3 = a31&#x03C6;1 + a32&#x03C6;2 + a33&#x03B7;3 + W31 &#x03BC;1 + W32&#x03BC;2
" class="math-display" ></center>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex18x.png" alt="(
|{ &#x03C6;1 = &#x03B7;1
  &#x03C6;2 = &#x03B7;2
|( &#x03C6;  = &#x03B7;
   3    3
" class="math-display" ></center>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex19x.png" alt="(
|{ &#x03C9;1 = &#x03C6;1 + &#x03BD;1
  &#x03C9; = &#x03B7;  + &#x03BD;
|(  2   2   2
  &#x03C9;3 = &#x03B7;3 + &#x03BD;3  " class="math-display" ></center>  
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Coding-the-Kalman-filter">4.3.1 Coding the Kalman filter</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Kalman-filter-run-and-output">4.3.2 Kalman filter run and output</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Executing-code-after-the-analysis">4.3.3 Executing code after the analysis</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Coding-the-Kalman-filter"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Kalman-filter" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter-vectors-dimensions" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Coding-the-Kalman-filter-1"></a>
<h3 class="subsection">4.3.1 Coding the Kalman filter</h3>

<a name="index-zkalman"></a>

<p>First of all the Kalman filter code should be activated. The observations
code is also required (see section <a href="#Observations">Observations</a>).
If cmz is used the code
should be selected with the select flag kalman 
in the &lsquo;<tt>selseq.kumac</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">sel kalman
</pre></td></tr></table>

<p>With make the <code>kalman</code> variable should be set to 1:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">kalman = 1
</pre></td></tr></table>

<p>The kalman code is actually used by setting the flag
<code>zkalman</code> to <code>.true.</code>, for example in the &lsquo;<tt>zinit</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">zkalman = .True.;
</pre></td></tr></table>


<p>With the Kalman filter the dimension of estimated states, of the error 
on the state and of the
observation, the       W matrix, the observation function,
the initial
variance-covariance matrices on the state and the variance-covariance matrices 
of errors have to be given.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Kalman-filter-vectors-dimensions">4.3.1.1 Kalman filter vectors dimensions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Error-and-observation-matrices">4.3.1.2 Error and observation matrices</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Kalman-filter-vectors-dimensions"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Coding-the-Kalman-filter" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Error-and-observation-matrices" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Coding-the-Kalman-filter" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Kalman-filter-vectors-dimensions-1"></a>
<h4 class="subsubsection">4.3.1.1 Kalman filter vectors dimensions</h4>

<a name="index-error-vector-dimension"></a>
<a name="index-dimetaphi_002c-Kalman-filter"></a>

<p>These dimensions should be set in the &lsquo;<tt>zinit</tt>&rsquo; sequence.
The size of the estimated states is given by the parameter <code>nkp</code>. 
You can set this to <code>np</code> if all the states are estimated, but in case
there are some deterministic state variables, <code>nkp</code> may be less than
<code>np</code>. In that case the first <code>nkp</code> elements of <code>eta(.)</code>
will be estimated using the Kalman filter.
</p>
<p>The error on state dimension is associated with the parameter <code>nerrp</code>
and the size of the observations vector is <code>mobs</code> 
(see section <a href="#Observations">Observations</a>). In our example the dimensions are set with:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">parameter (nkp=np);
parameter (mobs=3);
parameter (nerrp=2);
</pre></td></tr></table>

<p>All the states are estimated,
there are 3 observation functions and the error on the state vector is of
dimension 2.
</p>
<p>If the sizes are set explicitely, the parameters should be set in
&lsquo;<tt>dimetaphi</tt>&rsquo;.
</p>
<hr size="6">
<a name="Error-and-observation-matrices"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Kalman-filter-vectors-dimensions" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter-run-and-output" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Coding-the-Kalman-filter" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Error-and-observation-matrices-1"></a>
<h4 class="subsubsection">4.3.1.2 Error and observation matrices</h4>

<a name="index-variance_002dcovariance-matrices"></a>
<a name="index-observations"></a>
<a name="index-zinit_002c-Kalman-filter"></a>

<a name="Initial-variance_002dcovariance-matrix-on-the-state"></a>
<h4 class="subsubheading">Initial variance-covariance matrix on the state</h4>

<a name="index-initial-variance_002dcovariance-on-states"></a>
<a name="index-covfor_0028_002e_002c_002e_0029"></a>

<p>The variance-covariance on the state matrix is <code>covfor(.,.)</code>. The initial
values have to be given for this matrix, as in our example:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">covfor(1,1) = 1000.; covfor(1,2) = 10.; covfor(1,3) = 10.;
covfor(2,1) = 10.; covfor(2,2) = 5000.; covfor(2,3) = 5.;
covfor(3,1) = 10.; covfor(3,2) = 5.; covfor(3,3) = 2000.;
</pre></td></tr></table>

<p>This matrix is updated by the filter at each time step because the states
are pertubated by some noise, and when assimilation takes place as new
information reduce the error.
</p>
<a name="Observations-and-error-on-state-matrix"></a>
<h4 class="subsubheading">Observations and error on state matrix</h4>

<a name="index-variance_002dcovariance-matrix-on-state"></a>
<a name="index-mereta_0028_002e_002c_002e_0029"></a>

<p>The matrix that relates errors on states vector components to states,
corresponding with       W is <code>mereta(.,.)</code>. In our example it is 
set by:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">mereta(1,1) = 1.;  mereta(1,2) = 0.;
mereta(2,1) = 0.;  mereta(2,2) = 1.;
mereta(3,1) = 0.5;  mereta(3,2) = 0.5;
</pre></td></tr></table>

<p>The observation functions are set by a <code>f_set</code> macro with 
<code>Obs_tef(.)</code> as described in <a href="#Observations">Observations</a>.
In our example the observation functions are set by:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">f_set Obs_tef(1) = ff(1) ;
f_set Obs_tef(2) = eta(2);
f_set Obs_tef(3) = eta(3);
</pre></td></tr></table>

<a name="Error-variance_002dcovariance-matrices"></a>
<h4 class="subsubheading">Error variance-covariance matrices</h4>

<a name="index-variance_002dcovariance-error"></a>
<a name="index-covobs_0028_002e_002c_002e_0029"></a>

<p>The variance-covariance matrix on observation noise is <code>covobs(.,.)</code>
set, in our example, by:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">covobs(1,1) = 0.3; covobs(1,2) = 0.; covobs(1,3) = 0.;
covobs(2,1) = 0.; covobs(2,2) = 0.1; covobs(2,3) = 0.;
covobs(3,1) = 0.; covobs(3,2) = 0.; covobs(3,3) = 0.2;
</pre></td></tr></table>

<a name="index-coveta_0028_002e_002c_002e_0029"></a>
<p>The variance-covariance matrix on state noise is <code>coveta(.,.)</code>
set, in our example, by:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">coveta(1,1) = 0.2; coveta(1,2) = 0.001;
coveta(2,1) = 0.001; coveta(2,2) = 0.1;
</pre></td></tr></table>

<p>These matrices are not changed during the run of the model as part
of the filtering process. They may be changed by the user in &lsquo;<tt>zsteer</tt>&rsquo;.
</p>
<hr size="6">
<a name="Kalman-filter-run-and-output"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Error-and-observation-matrices" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Feeding-the-observations" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Kalman-filter-run-and-output-1"></a>
<h3 class="subsection">4.3.2 Kalman filter run and output</h3>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Feeding-the-observations">4.3.2.1 Feeding the observations to the model</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Kalman-filter-results">4.3.2.2 Kalman filter results</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Feeding-the-observations"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Kalman-filter-run-and-output" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter-results" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter-run-and-output" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Feeding-the-observations-to-the-model"></a>
<h4 class="subsubsection">4.3.2.1 Feeding the observations to the model</h4>

<a name="index-vobs_0028_002e_0029-1"></a>
<a name="index-zgetobs-1"></a>
<a name="index-zsteer_002c-Kalman-filter"></a>

<p>The observations must be made available to the model during the run. These
observations are set in the <code>vobs(.)</code> array, and the assimilation 
(also called the analysis step of the filter) takes
place if the logical variable <code>zgetobs</code> is <code>.true.</code> 
(see section <a href="#Data">Data</a>). 
</p>
<p>These steps are
typically performed in the &lsquo;<tt>zsteer</tt>&rsquo; sequence. In this sequence there should
be some code such that when there are data ready to
be assimilated, <code>zgetobs</code> is set to <code>.true.</code> and the data is
stored in <code>vobs(.)</code>, ready for the next step processing.
</p>
<hr size="6">
<a name="Kalman-filter-results"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Feeding-the-observations" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Executing-code-after-the-analysis" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter-run-and-output" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Kalman-filter-results-1"></a>
<h4 class="subsubsection">4.3.2.2 Kalman filter results</h4>

<a name="index-results_002c-Kalman-filter"></a>
<a name="index-Kalman-filter-results"></a>
<a name="index-output_002c-Kalman-filter"></a>
<a name="index-Kalman-filter-output"></a>
<a name="index-data_002edata-1"></a>

<p>The estimated states and transfers are still in the same &lsquo;<samp>.data</samp>&rsquo; files, 
&lsquo;<tt>res.data</tt>&rsquo; and &lsquo;<tt>tr.data</tt>&rsquo; and there is the additional file with
observations, called &lsquo;<tt>obs.data</tt>&rsquo; (see section <a href="#Observations">Observations</a>). 
Each time <code>zgetobs</code> is <code>.true.</code> the data, and the optimally 
weighted innovations are output 
in the file associated with data, &lsquo;<tt>data.data</tt>&rsquo; (see section <a href="#Data">Data</a>).
</p>
<hr size="6">
<a name="Executing-code-after-the-analysis"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Kalman-filter-results" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Feedback-gain" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Kalman-filter" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Executing-code-after-the-analysis-1"></a>
<h3 class="subsection">4.3.3 Executing code after the analysis</h3>

<p>The analysis takes place before the time step advance when <code>zgetobs</code>
is <code>.true.</code>. It may be usefull to add some code after the analysis
and before the time step advance. For example the analysis may lead to 
absurd values for some states or parameters, it could be usefull to correct
them in that case. The sequence included after the analysis is called
&lsquo;<tt>kalsteer</tt>&rsquo;. At this point, in addition to the usual variables 
the following variables could be usefull:
</p>
<dl compact="compact">
<dt> <code>etafor(.)</code>
<a name="index-etafor_0028_002e_0029"></a>
</dt>
<dd><p>The state before the analysis.
</p></dd>
<dt> <code>kgain(.)</code>
<a name="index-kgain_0028_002e_0029"></a>
</dt>
<dd><p>The Kalman gain.
</p></dd>
<dt> <code>innobs(.)</code>
<a name="index-innobs_0028_002e_0029"></a>
</dt>
<dd><p>The innovation vector (observations coherent with the states minus data
values).
</p></dd>
<dt> <code>covana(.,.)</code>
<a name="index-covana_0028_002e_002c_002e_0029"></a>
</dt>
<dd><p>The variance-covariance error matrix after the analysis.
</p></dd>
</dl>

<p>At each time step the derivative of the observation function with respect
to transfer and cells variables are recomputed. The elimination of
transfers is also performed to get the partial derivative of the observation
function of the equivalent model, with states only, with respect to the 
states. In other words, the Kalman filter does not follow the TEF formalism, because
the advance of the var-covar matrix could not yet be set in the TEF form.
</p>
<dl compact="compact">
<dt> <code>obspha(.,.)</code>
<a name="index-obspha_0028_002e_002c_002e_0029"></a>
</dt>
<dd><p>derivative of observation function in state space with respect to
cell variables.
</p></dd>
</dl>


<hr size="6">
<a name="Feedback-gain"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Executing-code-after-the-analysis" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Specifying-the-Borel-sweep" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Feedback-gain-1"></a>
<h2 class="section">4.4 Feedback gain</h2>


<a name="index-Borel-sweep"></a>
<a name="index-Feedback-gain"></a>

<p>The feedback dynamic gain associated with a feedback loop
can be expressed as the inverse Borel 
transform of the coefficient of the reduced scalar 
coupling matrix,       g(&#x03C4;),
associated with a transfer. 
A Borel sweep provides this       g(&#x03C4;). Therefore it is
an interesting tool for the characterization of the feedback loop<a name="DOCF8" href="#FOOT8">(8)</a>. 
</p>
<p>As explained in the 
ZOOM web page document 
<a href="http://www.lmd.jussieu.fr/ZOOM/doc/Feedback_Gain.pdf">http://www.lmd.jussieu.fr/ZOOM/doc/Feedback_Gain.pdf</a>,
this allows for the calculation of the
dynamic gain and factor of any feedback that goes through a unique
transfer variable. An example of the conclusions that can be drawn from such
an analysis is provided in the same document.
</p>


<p>For linear systems &ndash; whose GTLS are autonomous along the whole trajectory &ndash; 
the       &#x03C4; function of the
feedback gain is independent of the position on the system trajectory. 
But in general it is dependant, and one can analyse the function 
      g(&#x03C4;;t) defined on a segment       t of the trajectory.
</p>
<p>The document introducing the TEF-ZOOM technique explains how a Crank-Nicolson
scheme for the time discretisation
symbolically gives the solution of the Borel transform of the system. One can
identify the <code>dt</code> variable with the Borel       &#x03C4; within a 
factor       2
. Hence, to numerically study the       &#x03C4; dependency of 
the transform of various coefficients in the system coupling  matrix at one 
point in time, one can calculate the Borel transform of the TLS solutions 
by making a time-step sweep.
</p>
<p>The function       g(&#x03C4;;t) is simply output for the feedback gain 
attached to a unique <code>ff(k)</code> transfer variable. 
All the relevant informations should be entered in the &lsquo;<tt>zinit</tt>&rsquo; sequence.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Borel-sweep-results">4.4.2 Borel sweep results</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Specifying-the-Borel-sweep"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Feedback-gain" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Borel-sweep-results" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Feedback-gain" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Specifying-the-Borel-sweep-1"></a>
<h3 class="subsection">4.4.1 Specifying the Borel sweep</h3>

<a name="index-ZBorel"></a>

<p>First of all the logical flag <code>ZBorel</code> should be raised:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">ZBorel=.true.;
</pre></td></tr></table>

<a name="index-index_005fff_005fgain"></a>
<p>The index of the studied transfer is given in the <code>index_ff_gain</code>
variable
</p><table><tr><td>&nbsp;</td><td><pre class="example">index_ff_gain=7;
</pre></td></tr></table>

<p>At each time step a Borel sweep may be performed. The time steps of interest 
are
specified with three variables, one for the first step, one for the last step
and one for the number of steps between two Borel sweeps:
</p>
<dl compact="compact">
<dt> <code>istep_B_deb</code>
<a name="index-istep_005fB_005fdeb"></a>
</dt>
<dd><p>First time step for the Borel sweep.
</p></dd>
<dt>  <code>istep_B_fin</code>
<a name="index-istep_005fB_005ffin"></a>
</dt>
<dd><p>Last time step for the Borel sweep.
</p></dd>
<dt> <code>istep_B_inc</code>
<a name="index-istep_005fB_005finc"></a>
</dt>
<dd><p>Number of time steps between Borel sweeps.
</p></dd>
</dl>

<p>In the following examples Borel sweeps are performed from the 
time step 1000 up to the time step 1200, with a sweep at each time step:
</p><table><tr><td>&nbsp;</td><td><pre class="example">istep_B_deb=1000;   
istep_B_fin=1200;  
istep_B_inc=1;      
</pre></td></tr></table>


<p>For each Borel sweep, the range of the       &#x03C4; variable should be 
set. As this is a multiplicative variable the initial value, a multiplicative
factor and the number of values are to be given.
</p>
<dl compact="compact">
<dt> <code>tau_B_ini</code>
<a name="index-tau_005fB_005fini"></a>
</dt>
<dd><p>Initial value for       &#x03C4;.
</p></dd>
<dt> <code>tau_B_mult</code>
<a name="index-tau_005fB_005fmult"></a>
</dt>
<dd><p>Multiplicative factor for sweep in       tau.
</p></dd>
<dt> <code>itau_max</code>
<a name="index-itau_005fmax"></a>
</dt>
<dd><p>Number of       &#x03C4; values.
</p></dd>
</dl>

<p>For example, in the following, at each time step, the Borel
transform will be computed for       &#x03C4; values
starting at       0.2 and then multiplied a hundred times by       &#x2218;
        __&#x221A;
 _2
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">tau_B_ini=0.2;    
tau_B_mult=sqrt(sqrt(2.)); 
itau_max=100;             
</pre></td></tr></table>

<p>When the initial value of       &#x03C4; is set to a negative value 
(<i>i.e.</i> <code>tau_B_ini=-0.2;</code>),
the Borel sweep will first be applied with <code>itau_max</code> negative values 
for <code>-0.2</code>, <code>tau_B_mult*(-0.2)</code>,..., then for the zero value, 
and finally for the symetric positive values, resulting in <code>2*itau_max+1</code> 
values for       &#x03C4;.
</p>
<p>The whole example reads
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">! -------------------
! Feedback gain
! Borel
! -------------------
ZBorel=.true.;
if ZBorel           
&lt;  istep_B_deb=1000; 
   istep_B_fin=1200;
   istep_B_inc=1;  
;
   index_ff_gain=7; 
   tau_B_ini=0.2;    
   tau_B_mult=sqrt(sqrt(2.)); 
   itau_max=100;             
   z_pr/Borel/:tau_B_mult,tau_B_ini*(tau_B_mult)**itau_max;
&gt;;
</pre></td></tr></table>

<a name="index-zborel-for"></a>

<p>Instead of using the index of the transfer in <code>index_ff_gain</code> it is 
possible to specify the name of the transfer.In that case the transfer is specified
by the <code>zborel for</code> macro. For example if the transfer selected for the
feedback gain computation is <var>b_transfer</var>, it can be selected
with:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">zborel for: <var>b_transfer</var>;
</pre></td></tr></table>

<hr size="6">
<a name="Borel-sweep-results"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Specifying-the-Borel-sweep" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Stability-of-fastest-modes" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Feedback-gain" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Borel-sweep-results-1"></a>
<h3 class="subsection">4.4.2 Borel sweep results</h3>

<a name="index-Borel-sweep-results"></a>
<a name="index-results_002c-Borel-sweep"></a>
<a name="index-Borel-sweep-graphics"></a>
<a name="index-graphics_002c-Borel-sweep"></a>

<p>The file &lsquo;<tt>tau_Borel.data</tt>&rsquo; gives the       &#x03C4; values of the <var>tau</var> sweep, 
and the file &lsquo;<tt>gains.data</tt>&rsquo; records the feedback gain function values of 
      g(&#x03C4;), with 
one line for each sweep along the trajectory. In the 1.01 version, a new
feature is also provided giving the poles and residuals of the Borel
transform in the file &lsquo;<tt>vpgains.data</tt>&rsquo;. Consult the subroutine 
<code>Boreleig</code>
for (not definitive) output description.
</p>
<p>One can easily obtain the surface contours of       g(t,&#x03C4;) using
the Fortran program provided as &lsquo;<tt>gains.f</tt>&rsquo; and its compilation shell 
&lsquo;<tt>gains.xqt</tt>&rsquo;,
that builds 2D histograms for PAW, in which one uses the
&lsquo;<tt>borels.kumac</tt>&rsquo; provided kumac.
</p>
<hr size="6">
<a name="Stability-of-fastest-modes"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Borel-sweep-results" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SVD-with-cmz" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Stability-analysis-of-fastest-modes"></a>
<h2 class="section">4.5 Stability analysis of fastest modes</h2>

<a name="index-SVD"></a>
<a name="index-Singular-Value-Decomposition"></a>
<a name="index-state-matrix"></a>
<a name="index-sltc_002eexe"></a>

<p>The preceding analyses are done along with a simulation. One has also the
possibility of using in a more classical fashion the state advance matrix
      Ast, after the end of the simulation. Code to perform the 
<acronym title="Singular Value Decomposition">SVD</acronym> (Singular Value Decomposition) of the state matrix       Ast
and also of       Ast + A&#8224;
st is provided with Miniker.
The singular elements of these two matrices correspond to the most
rapid modes of instability of the perturbed system.
</p>
<p>The Singular value decomposition of a matrix is noted
</p>
<p>
    <center class="math-display" >
<img 
src="mini_ker_tex4ht_tex20x.png" alt="    &#8224;
UwV " class="math-display" ></center>
 
</p>
<p>An executable file, &lsquo;<tt>sltc.exe</tt>&rsquo; is generated and running this file will
produce the corresponding results.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#SVD-with-cmz">4.5.1 Singular Value Decomposition with cmz</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#SVD-with-make">4.5.2 Singular Value Decomposition with make</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="SVD-with-cmz"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Stability-of-fastest-modes" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SVD-with-make" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Stability-of-fastest-modes" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Singular-Value-Decomposition-with-cmz"></a>
<h3 class="subsection">4.5.1 Singular Value Decomposition with cmz</h3>

<a name="index-smod"></a>

<p>The cmz macro <code>smod SLTC</code> prepares a main program
(&lsquo;<tt>circul</tt>&rsquo; of +PATCH SLTC), provided as a base for user&rsquo;s own analysis,
in the directory &lsquo;<tt>sltc/</tt>&rsquo;.
</p>
<hr size="6">
<a name="SVD-with-make"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SVD-with-cmz" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#SVD-run-and-output" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Stability-of-fastest-modes" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Singular-Value-Decomposition-with-make"></a>
<h3 class="subsection">4.5.2 Singular Value Decomposition with make</h3>

<a name="index-Makefile_002esltc"></a>

<p>To compile the singular value decomposition executable with <code>make</code> you 
can do
</p><table><tr><td>&nbsp;</td><td><pre class="example">make sltc.exe
</pre></td></tr></table>

<p>If you want to have a separate directory for the SVD, you should copy 
the sequence &lsquo;<tt>dimetaphi.inc</tt>&rsquo; (or make a link to that file) to the
directory. You should also copy the file &lsquo;<tt>Makefile.sltc</tt>&rsquo; from the 
&lsquo;<tt>template/</tt>&rsquo; directory in this directory, rename it &lsquo;<tt>Makefile</tt>&rsquo;
and set the Miniker directory path in the 
<code>miniker_dir</code> variable. For
example, if the Miniker directory is in &lsquo;<tt>/u/src/mini_ker</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">miniker_dir = /u/src/mini_ker
</pre></td></tr></table>

<hr size="6">
<a name="SVD-run-and-output"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SVD-with-make" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Generalized-TLS" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Stability-of-fastest-modes" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Singular-Value-Decomposition-run-and-output"></a>
<h3 class="subsection">4.5.3 Singular Value Decomposition run and output</h3>

<a name="index-SVD-run"></a>
<a name="index-run_002c-SVD"></a>
<a name="index-SVD-output"></a>
<a name="index-output_002c-SVD"></a>
<a name="index-sltc_002eexe-1"></a>
<a name="index-title_002etex_002c-SVD"></a>
<a name="index-aspha_002edata_002c-SVD"></a>

<p>As it is, the &lsquo;<tt>sltc.exe</tt>&rsquo; executable generated by the compilation 
determines the SVD. This program requires &lsquo;<tt>title.tex</tt>&rsquo; (see <a href="#Title-file">Title file</a>) to
transmit a title for output and graphics, and &lsquo;<tt>aspha.data</tt>&rsquo; 
(see section <a href="#Simulation-and-output">Running a simulation and using the output</a>)
to access the
state matrix. To get access to these files (in case they are not in the current
directory) it is possible to make a link to 
the corresponding files in the model directory. Once it is done 
the program may be run:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">./sltc.exe
</pre></td></tr></table>

<p>The files &lsquo;<tt>u.data</tt>&rsquo;, &lsquo;<tt>w.data</tt>&rsquo;, and &lsquo;<tt>v.data</tt>&rsquo; holds the singular elements 
for       Ast (      U,       w and       V), 
and &lsquo;<tt>us.data</tt>&rsquo;, &lsquo;<tt>ws.data</tt>&rsquo;, and &lsquo;<tt>vs.data</tt>&rsquo;
holds the singular elements of       Ast + A&#8224;
st.
The corresponding macros &lsquo;<samp>.kumac</samp>&rsquo; for PAW<a name="DOCF9" href="#FOOT9">(9)</a> 
are also generated.
</p>
<hr size="6">
<a name="Generalized-TLS"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#SVD-run-and-output" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#GTLS-with-cmz" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Generalized-linear-tangent-system-analysis"></a>
<h2 class="section">4.6 Generalized linear tangent system analysis</h2>

<a name="index-Generalized-linear-tangent-system"></a>
<a name="index-GTLS"></a>
<a name="index-propagator"></a>
<a name="index-Lyapunov-exponents"></a>
<a name="index-sltcirc_002eexe"></a>

<p>The state matrix       Ast may also be used to compute the
GTLS propagator (or state transition matrix applied to perturbation), after the simulation.
The algorithm is a finite product of 
5th order development of
      &#x03A6;(t + &#x03B4;t,t) = expAst&#x03B4;t.
Numerous element of analysis are given, in particular the determination
of the Lyapunov exponents of the system.
</p>
<p>An executable file, &lsquo;<tt>sltcirc.exe</tt>&rsquo; is generated and running this file will
produce the corresponding results.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#GTLS-with-cmz">4.6.1 Generalized tangent linear system with cmz</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#GTLS-with-make">4.6.2 Generalized tangent linear system with make</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="GTLS-with-cmz"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Generalized-TLS" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#GTLS-with-make" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Generalized-TLS" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Generalized-tangent-linear-system-with-cmz"></a>
<h3 class="subsection">4.6.1 Generalized tangent linear system with cmz</h3>

<a name="index-smod-1"></a>

<p>The cmz macro <code>smod SLTCIRC</code> prepares a main program
(&lsquo;<tt>circule</tt>&rsquo; of +PATCH SLTCIRC), in the directory &lsquo;<tt>sltcirc/</tt>&rsquo;.
</p>
<hr size="6">
<a name="GTLS-with-make"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#GTLS-with-cmz" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#GTLS-run-and-output" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Generalized-TLS" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Generalized-tangent-linear-system-with-make"></a>
<h3 class="subsection">4.6.2 Generalized tangent linear system with make</h3>

<a name="index-Makefile_002esltcirc"></a>

<p>To compile the GTLS analysis executable with <code>make</code> you 
can do
</p><table><tr><td>&nbsp;</td><td><pre class="example">make sltcirc.exe
</pre></td></tr></table>

<p>If you want to have a separate directory for the GTLS analysis, you should copy 
the sequence &lsquo;<tt>dimetaphi.inc</tt>&rsquo; (or make a link to that file) to the
directory. You should also copy the file &lsquo;<tt>Makefile.sltcirc</tt>&rsquo; from the 
&lsquo;<tt>template/</tt>&rsquo; directory in this directory and  rename it &lsquo;<tt>Makefile</tt>&rsquo;
and set the Miniker directory path in the <code>miniker_dir</code> variable.
</p>
<hr size="6">
<a name="GTLS-run-and-output"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#GTLS-with-make" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Generalized-TLS" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Generalized-tangent-linear-system-analysis-run-and-output"></a>
<h3 class="subsection">4.6.3 Generalized tangent linear system analysis run and output</h3>

<a name="index-GTLS-run"></a>
<a name="index-run_002c-GTLS"></a>
<a name="index-GTLS-output"></a>
<a name="index-output_002c-GTLS"></a>
<a name="index-sltcirc_002eexe-1"></a>
<a name="index-title_002etex_002c-GTLS"></a>
<a name="index-dres_002edata_002c-GTLS"></a>
<a name="index-aspha_002edata_002c-GTLS"></a>

<p>The &lsquo;<tt>sltcirc.exe</tt>&rsquo; executable generated by the compilation 
computes the elements of analysis of the system. This program requires 
&lsquo;<tt>title.tex</tt>&rsquo; to
transmit a title for output and graphics (see <a href="#Title-file">Title file</a>), 
&lsquo;<tt>aspha.data</tt>&rsquo; to access the
state matrix and &lsquo;<tt>dres.data</tt>&rsquo;, because time-step can be changed along the 
simulation 
(see section <a href="#Simulation-and-output">Running a simulation and using the output</a>)
<a name="DOCF10" href="#FOOT10">(10)</a>. To get access to these files 
(in case they are not in the current
directory) it is possible to make a link to 
the corresponding files in the model directory. Once it is done 
the program may be run:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">./sltcirc.exe
</pre></td></tr></table>

<p>The following table gives the correspondence between variable name, 
result file and ntuple number, with a short explanation:
</p>
<table>
<thead><tr><th>var</th><th>file</th><th>ntuple</th><th>explanation</th></tr></thead>
<tr><td><code>p(.,.)</code></td><td>&lsquo;<tt>phit.data</tt>&rsquo;</td><td>55</td><td>propagator from 0 to       t,       &#x03A6;(t,0)</td></tr>
<tr><td><code>up(.,.)</code></td><td>&lsquo;<tt>uphit.data</tt>&rsquo;</td><td>50</td><td>Left singular vectors       U in the SVD of       &#x03A6;</td></tr>
<tr><td><code>wp(.)</code></td><td>&lsquo;<tt>wphit.data</tt>&rsquo;</td><td>51</td><td>singulat values       w in the SVD of       &#x03A6;</td></tr>
<tr><td><code>vp(.,.)</code></td><td>&lsquo;<tt>vphit.data</tt>&rsquo;</td><td>52</td><td>Right Singular Vectors       V in the SVD of       &#x03A6;</td></tr>
<tr><td><code>wr(.)</code></td><td>&lsquo;<tt>wr.data</tt>&rsquo;</td><td>53</td><td>real part of eigen values of       &#x03A6;(t,0)</td></tr>
<tr><td><code>wi(.)</code></td><td>&lsquo;<tt>wi.data</tt>&rsquo;</td><td>54</td><td>imaginary part of eigen values of       &#x03A6;(t,0)</td></tr>
<tr><td><code>lwp(.)</code></td><td>&lsquo;<tt>lwphit.data</tt>&rsquo;</td><td>67</td><td>Lyapunov exponents</td></tr>
</table>


<hr size="6">
<a name="Advanced-use-of-Miniker-with-make"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#GTLS-run-and-output" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Make-variables" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Dynamic-system-analysis" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Advanced-use-of-Miniker-with-make-1"></a>
<h1 class="chapter">5. Advanced use of Miniker with make</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Make-variables">5.1 Make variables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Rules">5.2 Rules</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Linking-rule">5.3 Linking rule</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Make-variables"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Rules" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Make-variables-1"></a>
<h2 class="section">5.1 Make variables</h2>

<a name="index-Makefile_002eminiker"></a>

<p>The &lsquo;<tt>Makefile.miniker</tt>&rsquo; Makefile provided in the
distribution should be included as it defines a lot of important 
variables and rules. 
</p>
<p>The following make variables can be set by the user:
</p>
<dl compact="compact">
<dt> <code>miniker_dir</code></dt>
<dd><p>that variable should hold the Miniker sources directory. If you installed
Miniker that variable should be set to &lsquo;<tt>$(includedir)/mini_ker</tt>&rsquo;. 
If you use the sources right from the sources directory it should be set to 
the sources package directory.
</p></dd>
<dt> <code>MTNDIRS</code></dt>
<dd><p>This variable can hold a &lsquo;<samp>:</samp>&rsquo; delimited list of directories that will
be searched for mortran include files.
</p></dd>
<dt> <code>CMFDIRS</code></dt>
<dd><p>This variable can hold a &lsquo;<samp>:</samp>&rsquo; delimited list of directories that will
be searched for cmz directive include files.
</p></dd>
<dt> <code>SEL</code></dt>
<dd><p>This variable holds a &lsquo;<samp>,</samp>&rsquo; delimited list of select flags, for example
<code>monitor</code>, <code>grid1d</code>, <code>debug</code>.
</p></dd>
<dt> <code>LDADD</code></dt>
<dd><p>This variable can be used to add libraries flags and files. It is used in 
the default linking command/rule.
</p></dd>
<dt> <code>miniker_user_objects</code></dt>
<dd><p>This variable should hold a space separated list of additional object files
to be linked with the model and helper object files.
</p></dd>
<dt> <code>CAR2TXTFLAGS</code></dt>
<dd><p>cmz directives preprocessor flag.
</p></dd>
<dt> <code>kalman</code></dt>
<dd><p>This variable should be set to 1 if you want to use the kalman filter
(see section <a href="#Kalman-filter">Kalman filter</a>).
</p></dd>
<dt> <code>double</code></dt>
<dd><p>This variable should be set to 1 if you want to have a double precision
code (see section <a href="#Double-precision">Double precision</a>).
</p></dd>
</dl>

<p>The following variables are allready set and may be used
(some are set by ./configure see <a href="#Configuration">Configuration</a>):
</p>
<dl compact="compact">
<dt> <code>miniker_principal_objects</code></dt>
<dd><p>The list of object files needed for the model build, together with some 
helper object files often used but not strictly required for the linking.
</p></dd>
<dt> <code>DEPDIR</code></dt>
<dd><p>The name of a hidden directory containing the dependencies computed
for the main mortran files.
</p></dd>
<dt> <code>F77</code></dt>
<dt> <code>FC</code></dt>
<dt> <code>FFLAGS</code></dt>
<dt> <code>LDFLAGS</code></dt>
<dd><p>Compiler and linker related variables set by ./configure.
</p></dd>
<dt> <code>LIBS</code></dt>
<dd><p>This variable should hold the link flags and files required to build 
Miniker, set by ./configure.
</p></dd>
<dt> <code>CAR2TXT</code></dt>
<dt> <code>MORTRAN</code></dt>
<dt> <code>MTNFLAGS</code></dt>
<dt> <code>MTNDEPEND</code></dt>
<dd><p>Preprocessor and preprocessor flags, set by ./configure.
</p></dd>
</dl>

<hr size="6">
<a name="Rules"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Make-variables" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Linking-rule" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Rules-1"></a>
<h2 class="section">5.2 Rules</h2>

<p>The following rules are defined in the &lsquo;<tt>Makefile.miniker</tt>&rsquo; file.
</p><dl compact="compact">
<dt> <code>miniker-clean</code></dt>
<dd><p>remove the fortran files generated from the mortran files. Remove 
the object files.
</p></dd>
<dt> <code>miniker-mtn-clean</code></dt>
<dd><p>remove the mortran files generated from the files with cmz directives.
</p></dd>
<dt> <code></code></dt>
<dd><p>Various rules to preprocess files with cmz directives and mortran files and
to compile fortran files.
</p></dd>
</dl>

<p>If the user needs a mortran main file, he may take advantage of the rule
used to compute the dependencies of a mortran file. If the file is called,
say, &lsquo;<tt>mtnfile.mtn</tt>&rsquo; leading to &lsquo;<tt>mtnfile.f</tt>&rsquo;, the following include
should lead to the automatic creation, updating and inclusion of a 
file describing the dependencies of &lsquo;<tt>mtnfile.mtn</tt>&rsquo; in the 
&lsquo;<tt>Makefile</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">include $(DEPDIR)/mtnfile.Pf
</pre></td></tr></table>

<hr size="6">
<a name="Linking-rule"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Rules" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Linking-rule-1"></a>
<h2 class="section">5.3 Linking rule</h2>

<p>The rule used for the linking of the model file is not in the 
&lsquo;<tt>Makefile.miniker</tt>&rsquo; file but 
should be provided in the user &lsquo;<tt>Makefile</tt>&rsquo; for more flexibility. 
The default rule 
uses the variables <code>miniker_user_objects</code> for additional object files
and <code>LDADD</code> for additionnal linking flags and files, those 
variables are there to be changed by the user.
</p>
<p>The object files required by the Miniker code are in the make variable
<code>miniker_principal_objects</code>, this variable is also used. 
The value of the variables <code>FC</code>
for the Fortran compiler, <code>FFLAGS</code> for the Fortran compiler
flags and <code>LDFLAGS</code> for the linker flags should be set to right
values; <code>LIBS</code> should also be right and hold the link flags and link
files required to compile the Miniker model. These variables are 
set by by <code>./configure</code> during configuration (see section <a href="#Configuration">Configuration</a>) 
and used in the default rule: 
</p>
<pre class="verbatim">$(model_file): $(miniker_user_objects) $(miniker_principal_objects)
	$(FC) $(FFLAGS) $(LDFLAGS) $^ $(LDADD) $(LIBS) -o $@
</pre>
<p>In case this isn&rsquo;t right it may be freely changed. You should certainly 
refer to the <a href="make.html#Top">(make)Top</a> section &lsquo;Top&rsquo; in <cite>GNU Make Manual</cite> manual to understand what
that rule exactly means and make your own.
</p>

<hr size="6">
<a name="Concepts-index"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Linking-rule" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Variables-macros-and-functions-index" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Advanced-use-of-Miniker-with-make" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Variables-macros-and-functions-index" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Concepts-index-1"></a>
<h1 class="unnumbered">Concepts index</h1>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#Concepts-index-1_cp_symbol-1" class="summary-letter"><b>$</b></a>
 &nbsp; 
<br>
<a href="#Concepts-index-1_cp_letter-A" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-B" class="summary-letter"><b>B</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-G" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-H" class="summary-letter"><b>H</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-I" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-K" class="summary-letter"><b>K</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-L" class="summary-letter"><b>L</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-R" class="summary-letter"><b>R</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-S" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-T" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-U" class="summary-letter"><b>U</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-V" class="summary-letter"><b>V</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-Z" class="summary-letter"><b>Z</b></a>
 &nbsp; 
</td></tr></table>
<table border="0" class="index-cp">
<tr><td></td><th align="left">Index Entry</th><th align="left"> Section</th></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_symbol-1">$</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0024dimetaphi">&lsquo;<tt>$dimetaphi</tt>&rsquo;</a></td><td valign="top"><a href="#Setting-up-a-model-with-cmz">2.3.1 Setup a model and compile with cmz</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_0024zinit">&lsquo;<tt>$zinit</tt>&rsquo;</a></td><td valign="top"><a href="#Setting-up-a-model-with-cmz">2.3.1 Setup a model and compile with cmz</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-adjoint">adjoint</a></td><td valign="top"><a href="#Overview-of-optimisation-with-Miniker">4.2.1 Overview of optimisation with Miniker</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-aspha_002edata">&lsquo;<tt>aspha.data</tt>&rsquo;</a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-aspha_002edata_002c-GTLS">&lsquo;<tt>aspha.data</tt>&rsquo;, GTLS</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-aspha_002edata_002c-SVD">&lsquo;<tt>aspha.data</tt>&rsquo;, SVD</a></td><td valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Borel-sweep">Borel sweep</a></td><td valign="top"><a href="#Feedback-gain">4.4 Feedback gain</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Borel-sweep-graphics">Borel sweep graphics</a></td><td valign="top"><a href="#Borel-sweep-results">4.4.2 Borel sweep results</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Borel-sweep-results">Borel sweep results</a></td><td valign="top"><a href="#Borel-sweep-results">4.4.2 Borel sweep results</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-cells">cells</a></td><td valign="top"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cernlib">cernlib</a></td><td valign="top"><a href="#Common-requisites">A.2 Common requisites</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-command-law">command law</a></td><td valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compilation">compilation</a></td><td valign="top"><a href="#Setting-up-a-model-with-make">2.3.2 Setup a model and compile with make</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-configuration-of-source">configuration of source</a></td><td valign="top"><a href="#Configuration">A.4.2 Configuration</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-controlling-the-run">controlling the run</a></td><td valign="top"><a href="#Controlling-the-run">2.4 Controlling the run</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-data_002edata">&lsquo;<tt>data.data</tt>&rsquo;</a></td><td valign="top"><a href="#Data">3.8.2 Data</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-data_002edata-1">&lsquo;<tt>data.data</tt>&rsquo;</a></td><td valign="top"><a href="#Kalman-filter-results">4.3.2.2 Kalman filter results</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dimetaphi">dimetaphi</a></td><td valign="top"><a href="#Size-sequence">3.9.1 The explicit size sequence</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dimetaphi-1">&lsquo;<tt>dimetaphi</tt>&rsquo;</a></td><td valign="top"><a href="#Size-sequence">3.9.1 The explicit size sequence</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dimetaphi_002c-Kalman-filter">&lsquo;<tt>dimetaphi</tt>&rsquo;, Kalman filter</a></td><td valign="top"><a href="#Kalman-filter-vectors-dimensions">4.3.1.1 Kalman filter vectors dimensions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-down-node">down node</a></td><td valign="top"><a href="#g_t1D-gridded-model">3.3 Describing 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dres_002edata">&lsquo;<tt>dres.data</tt>&rsquo;</a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dres_002edata-1">&lsquo;<tt>dres.data</tt>&rsquo;</a></td><td valign="top"><a href="#SEC_Foot"></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dres_002edata_002c-GTLS">&lsquo;<tt>dres.data</tt>&rsquo;, GTLS</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-equations_002c-grid">equations, grid</a></td><td valign="top"><a href="#Grid-node-equations">Grid node equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-error-vector-dimension">error vector dimension</a></td><td valign="top"><a href="#Kalman-filter-vectors-dimensions">4.3.1.1 Kalman filter vectors dimensions</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-FDL_002c-GNU-Free-Documentation-License">FDL, GNU Free Documentation License</a></td><td valign="top"><a href="#GNU-Free-Documentation-License">C.1 GNU Free Documentation License</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-feature-setting">feature setting</a></td><td valign="top"><a href="#Selecting-features">3.1 Overview of additional features setting</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Feedback-gain">Feedback gain</a></td><td valign="top"><a href="#Feedback-gain">4.4 Feedback gain</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ffl-_0028linearity-test_0029"><code>ffl</code> (linearity test)</a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-final-cost">final cost</a></td><td valign="top"><a href="#Overview-of-optimisation-with-Miniker">4.2.1 Overview of optimisation with Miniker</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-G">G</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Generalized-linear-tangent-system">Generalized linear tangent system</a></td><td valign="top"><a href="#Generalized-TLS">4.6 Generalized linear tangent system analysis</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-gradpj_002edata">&lsquo;<tt>gradpj.data</tt>&rsquo;</a></td><td valign="top"><a href="#Sensitivity-of-cost-function-to-parameters">4.2.4 Sensitivity of cost function to parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-graphics">graphics</a></td><td valign="top"><a href="#Graphics">2.3.4 Doing graphics</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-graphics-with-gnuplot">graphics with <code>gnuplot</code></a></td><td valign="top"><a href="#Graphics">2.3.4 Doing graphics</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-graphics-with-PAW">graphics with <code>PAW</code></a></td><td valign="top"><a href="#Graphics">2.3.4 Doing graphics</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-graphics_002c-Borel-sweep">graphics, Borel sweep</a></td><td valign="top"><a href="#Borel-sweep-results">4.4.2 Borel sweep results</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-GTLS">GTLS</a></td><td valign="top"><a href="#Generalized-TLS">4.6 Generalized linear tangent system analysis</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-GTLS-output">GTLS output</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-GTLS-run">GTLS run</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-H">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Heaviside-function">Heaviside function</a></td><td valign="top"><a href="#Rule-of-programming-non-continuous-models">3.6 Rule of programming non continuous models</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-initial-variance_002dcovariance-on-states">initial variance-covariance on states</a></td><td valign="top"><a href="#Initial-variance_002dcovariance-matrix-on-the-state">Initial variance-covariance matrix on the state</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-installation-with-make">installation with make</a></td><td valign="top"><a href="#Installation-with-make">A.4.3 Installation with make</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-integrand-cost">integrand cost</a></td><td valign="top"><a href="#Overview-of-optimisation-with-Miniker">4.2.1 Overview of optimisation with Miniker</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-K">K</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Kalman-filter">Kalman filter</a></td><td valign="top"><a href="#Kalman-filter">4.3 Kalman filter</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Kalman-filter-output">Kalman filter output</a></td><td valign="top"><a href="#Kalman-filter-results">4.3.2.2 Kalman filter results</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Kalman-filter-results">Kalman filter results</a></td><td valign="top"><a href="#Kalman-filter-results">4.3.2.2 Kalman filter results</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-lapack">lapack</a></td><td valign="top"><a href="#Common-requisites">A.2 Common requisites</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-limiting-conditions">limiting conditions</a></td><td valign="top"><a href="#Limiting-conditions">Limiting conditions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-linearity-test">linearity test</a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logical-flags">logical flags</a></td><td valign="top"><a href="#Selecting-features">3.1 Overview of additional features setting</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Lyapunov-exponents">Lyapunov exponents</a></td><td valign="top"><a href="#Generalized-TLS">4.6 Generalized linear tangent system analysis</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Makefile_002eminiker">&lsquo;<tt>Makefile.miniker</tt>&rsquo;</a></td><td valign="top"><a href="#Make-variables">5.1 Make variables</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Makefile_002esltc">&lsquo;<tt>Makefile.sltc</tt>&rsquo;</a></td><td valign="top"><a href="#SVD-with-make">4.5.2 Singular Value Decomposition with make</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Makefile_002esltcirc">&lsquo;<tt>Makefile.sltcirc</tt>&rsquo;</a></td><td valign="top"><a href="#GTLS-with-make">4.6.2 Generalized tangent linear system with make</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mini_005fker_002ecmz">&lsquo;<tt>mini_ker.cmz</tt>&rsquo;</a></td><td valign="top"><a href="#Miniker-with-cmz">A.3 Miniker with cmz</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mod"><code>mod</code></a></td><td valign="top"><a href="#Setting-up-a-model-with-cmz">2.3.1 Setup a model and compile with cmz</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-model-equations">model equations</a></td><td valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-model-size">model size</a></td><td valign="top"><a href="#Size-sequence">3.9.1 The explicit size sequence</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Model_002ehlp">&lsquo;<tt>Model.hlp</tt>&rsquo;</a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mortran">mortran</a></td><td valign="top"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mortran-1">mortran</a></td><td valign="top"><a href="#A-note-about-mortran-and-cmz-directives">2.2.1 All you need to know about mortran and cmz directives</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mortran_002c-with-make"><code>mortran</code>, with make</a></td><td valign="top"><a href="#Additional-requirements">A.4.1 Additional requirements for Miniker with make</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-obs_002edata">&lsquo;<tt>obs.data</tt>&rsquo;</a></td><td valign="top"><a href="#Observations">3.8.1 Observations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-observation-function">observation function</a></td><td valign="top"><a href="#Observations">3.8.1 Observations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-observations">observations</a></td><td valign="top"><a href="#Error-and-observation-matrices">4.3.1.2 Error and observation matrices</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-observations_002c-general">observations, general</a></td><td valign="top"><a href="#Kalman-filter">4.3 Kalman filter</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-optimisation">optimisation</a></td><td valign="top"><a href="#Overview-of-optimisation-with-Miniker">4.2.1 Overview of optimisation with Miniker</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output-file">output file</a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002c-GTLS">output, GTLS</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002c-Kalman-filter">output, Kalman filter</a></td><td valign="top"><a href="#Kalman-filter-results">4.3.2.2 Kalman filter results</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002c-sensitivity">output, sensitivity</a></td><td valign="top"><a href="#Sensitivities">4.1 Automatic sensitivity computation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002c-SVD">output, SVD</a></td><td valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-printing">printing</a></td><td valign="top"><a href="#Controlling-the-printout-and-data-output">2.4.2 Controlling the printout and data output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Programming-environments">Programming environments</a></td><td valign="top"><a href="#Programming-environments">A.1 Programming environments</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-propagator">propagator</a></td><td valign="top"><a href="#Generalized-TLS">4.6 Generalized linear tangent system analysis</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-requirements_002c-with-make">requirements, with make</a></td><td valign="top"><a href="#Additional-requirements">A.4.1 Additional requirements for Miniker with make</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-res_002edata">&lsquo;<tt>res.data</tt>&rsquo;</a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-results_002c-Borel-sweep">results, Borel sweep</a></td><td valign="top"><a href="#Borel-sweep-results">4.4.2 Borel sweep results</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-results_002c-Kalman-filter">results, Kalman filter</a></td><td valign="top"><a href="#Kalman-filter-results">4.3.2.2 Kalman filter results</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-run_002c-GTLS">run, GTLS</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-run_002c-SVD">run, SVD</a></td><td valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-running-model">running model</a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-select-flag">select flag</a></td><td valign="top"><a href="#Selecting-features">3.1 Overview of additional features setting</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-selseq_002ekumac">&lsquo;<tt>selseq.kumac</tt>&rsquo;</a></td><td valign="top"><a href="#Selecting-features">3.1 Overview of additional features setting</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-selseq_002ekumac-1">&lsquo;<tt>selseq.kumac</tt>&rsquo;</a></td><td valign="top"><a href="#Miniker-with-cmz">A.3 Miniker with cmz</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sens_002edata">&lsquo;<tt>sens.data</tt>&rsquo;</a></td><td valign="top"><a href="#Sensitivities">4.1 Automatic sensitivity computation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sensitivities">sensitivities</a></td><td valign="top"><a href="#Sensitivities">4.1 Automatic sensitivity computation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sensitivity_002c-output">sensitivity, output</a></td><td valign="top"><a href="#Sensitivities">4.1 Automatic sensitivity computation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sequence">sequence</a></td><td valign="top"><a href="#Structure-of-the-code">2.1 General structure of the code</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sequences">sequences</a></td><td valign="top"><a href="#A-model-with-Miniker">2. Miniker model programming</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sigma_002edata">&lsquo;<tt>sigma.data</tt>&rsquo;</a></td><td valign="top"><a href="#Sensitivities">4.1 Automatic sensitivity computation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Singular-Value-Decomposition">Singular Value Decomposition</a></td><td valign="top"><a href="#Stability-of-fastest-modes">4.5 Stability analysis of fastest modes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sltc_002eexe">&lsquo;<tt>sltc.exe</tt>&rsquo;</a></td><td valign="top"><a href="#Stability-of-fastest-modes">4.5 Stability analysis of fastest modes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sltc_002eexe-1">&lsquo;<tt>sltc.exe</tt>&rsquo;</a></td><td valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sltcirc_002eexe">&lsquo;<tt>sltcirc.exe</tt>&rsquo;</a></td><td valign="top"><a href="#Generalized-TLS">4.6 Generalized linear tangent system analysis</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sltcirc_002eexe-1">&lsquo;<tt>sltcirc.exe</tt>&rsquo;</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-smod"><code>smod</code></a></td><td valign="top"><a href="#SVD-with-cmz">4.5.1 Singular Value Decomposition with cmz</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-smod-1"><code>smod</code></a></td><td valign="top"><a href="#GTLS-with-cmz">4.6.1 Generalized tangent linear system with cmz</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-starting-point">starting point</a></td><td valign="top"><a href="#Starting-points">Starting points</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-state-matrix">state matrix</a></td><td valign="top"><a href="#Stability-of-fastest-modes">4.5 Stability analysis of fastest modes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-SVD">SVD</a></td><td valign="top"><a href="#Stability-of-fastest-modes">4.5 Stability analysis of fastest modes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-SVD-output">SVD output</a></td><td valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-SVD-run">SVD run</a></td><td valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-TEF">TEF</a></td><td valign="top"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-TEF-1">TEF</a></td><td valign="top"><a href="#A-model-description">2.2 Miniker programming illustrated</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-title-file">title file</a></td><td valign="top"><a href="#title-file">title file</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-title_002etex">&lsquo;<tt>title.tex</tt>&rsquo;</a></td><td valign="top"><a href="#title-file">title file</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-title_002etex_002c-GTLS">&lsquo;<tt>title.tex</tt>&rsquo;, GTLS</a></td><td valign="top"><a href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-title_002etex_002c-SVD">&lsquo;<tt>title.tex</tt>&rsquo;, SVD</a></td><td valign="top"><a href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tr_002edata">&lsquo;<tt>tr.data</tt>&rsquo;</a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-transfers">transfers</a></td><td valign="top"><a href="#Introduction">Introduction</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-U">U</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-up-node">up node</a></td><td valign="top"><a href="#g_t1D-gridded-model">3.3 Describing 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-uxcom_002edata">&lsquo;<tt>uxcom.data</tt>&rsquo;</a></td><td valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-uycom_002edata">&lsquo;<tt>uycom.data</tt>&rsquo;</a></td><td valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-variance_002dcovariance-error">variance-covariance error</a></td><td valign="top"><a href="#Error-variance_002dcovariance-matrices">Error variance-covariance matrices</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-variance_002dcovariance-matrices">variance-covariance matrices</a></td><td valign="top"><a href="#Error-and-observation-matrices">4.3.1.2 Error and observation matrices</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-variance_002dcovariance-matrices_002c-general">variance-covariance matrices, general</a></td><td valign="top"><a href="#Kalman-filter">4.3 Kalman filter</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-variance_002dcovariance-matrix-on-state">variance-covariance matrix on state</a></td><td valign="top"><a href="#Observations-and-error-on-state-matrix">Observations and error on state matrix</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Concepts-index-1_cp_letter-Z">Z</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-zcmd_005flaw">&lsquo;<tt>zcmd_law</tt>&rsquo;</a></td><td valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zcmd_005flaw_002einc">&lsquo;<tt>zcmd_law.inc</tt>&rsquo;</a></td><td valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zinit">&lsquo;<tt>zinit</tt>&rsquo;</a></td><td valign="top"><a href="#Model-equation-and-parameters">2.2.2 Entering model equation and parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zinit_002c-general">zinit, general</a></td><td valign="top"><a href="#Structure-of-the-code">2.1 General structure of the code</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zinit_002c-Kalman-filter">&lsquo;<tt>zinit</tt>&rsquo;, Kalman filter</a></td><td valign="top"><a href="#Error-and-observation-matrices">4.3.1.2 Error and observation matrices</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zinit_002emti">&lsquo;<tt>zinit.mti</tt>&rsquo;</a></td><td valign="top"><a href="#Setting-up-a-model-with-make">2.3.2 Setup a model and compile with make</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ZOOM">ZOOM</a></td><td valign="top"><a href="#Introduction">Introduction</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zsteer">&lsquo;<tt>zsteer</tt>&rsquo;</a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zsteer_002c-Kalman-filter">&lsquo;<tt>zsteer</tt>&rsquo;, Kalman filter</a></td><td valign="top"><a href="#Feeding-the-observations">4.3.2.1 Feeding the observations to the model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zsteer_002einc">&lsquo;<tt>zsteer.inc</tt>&rsquo;</a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#Concepts-index-1_cp_symbol-1" class="summary-letter"><b>$</b></a>
 &nbsp; 
<br>
<a href="#Concepts-index-1_cp_letter-A" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-B" class="summary-letter"><b>B</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-G" class="summary-letter"><b>G</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-H" class="summary-letter"><b>H</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-I" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-K" class="summary-letter"><b>K</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-L" class="summary-letter"><b>L</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-R" class="summary-letter"><b>R</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-S" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-T" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-U" class="summary-letter"><b>U</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-V" class="summary-letter"><b>V</b></a>
 &nbsp; 
<a href="#Concepts-index-1_cp_letter-Z" class="summary-letter"><b>Z</b></a>
 &nbsp; 
</td></tr></table>

<hr size="6">
<a name="Variables-macros-and-functions-index"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Concepts-index" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Installation" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Installation" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Variables_002c-macros-and-functions-index"></a>
<h1 class="unnumbered">Variables, macros and functions index</h1>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#Variables_002c-macros-and-functions-index_vr_letter-A" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-B" class="summary-letter"><b>B</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-H" class="summary-letter"><b>H</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-I" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-K" class="summary-letter"><b>K</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-N" class="summary-letter"><b>N</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-S" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-T" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-V" class="summary-letter"><b>V</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-Z" class="summary-letter"><b>Z</b></a>
 &nbsp; 
</td></tr></table>
<table border="0" class="index-vr">
<tr><td></td><th align="left">Index Entry</th><th align="left"> Section</th></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-aspha"><code>aspha</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Bb"><code>Bb</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Bt"><code>Bt</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-couplage_0028_002e_0029"><code>couplage(.)</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cout_005fl"><code>cout_l</code></a></td><td valign="top"><a href="#Cost-function-coding-and-adjoint-modeling">4.2.3 Cost function coding and adjoint modeling</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cout_005fPsi"><code>cout_Psi</code></a></td><td valign="top"><a href="#Cost-function-coding-and-adjoint-modeling">4.2.3 Cost function coding and adjoint modeling</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-covana_0028_002e_002c_002e_0029"><code>covana(.,.)</code></a></td><td valign="top"><a href="#Executing-code-after-the-analysis">4.3.3 Executing code after the analysis</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-coveta_0028_002e_002c_002e_0029"><code>coveta(.,.)</code></a></td><td valign="top"><a href="#Error-variance_002dcovariance-matrices">Error variance-covariance matrices</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-covfor_0028_002e_002c_002e_0029"><code>covfor(.,.)</code></a></td><td valign="top"><a href="#Initial-variance_002dcovariance-matrix-on-the-state">Initial variance-covariance matrix on the state</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-covobs_0028_002e_002c_002e_0029"><code>covobs(.,.)</code></a></td><td valign="top"><a href="#Error-variance_002dcovariance-matrices">Error variance-covariance matrices</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-D"><code>D</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dEta_0028_002e_0029"><code>dEta(.)</code></a></td><td valign="top"><a href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-deta_005ftef_0028_002e_0029"><code>deta_tef(.)</code></a></td><td valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dneta"><code>dneta</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dphi"><code>dphi</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dt"><code>dt</code></a></td><td valign="top"><a href="#Model-equation-and-parameters">2.2.2 Entering model equation and parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dt-1"><code>dt</code></a></td><td valign="top"><a href="#SEC_Foot"></a></td></tr>
<tr><td></td><td valign="top"><a href="#index-d_005fpi_005faspha_0028_002e_002c_002e_0029"><code>d_pi_aspha(.,.)</code></a></td><td valign="top"><a href="#Advance-matrix-sensitivity">4.1.2 Advance matrix sensitivity</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-eqn_003a"><code>eqn:</code></a></td><td valign="top"><a href="#Model-equations-1">Model equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eta_0028_002e_0029"><code>eta(.)</code></a></td><td valign="top"><a href="#The-cell-and-transfer-arrays">The cell and transfer arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-eta_0028_002e_0029_002c-explicit-sizes"><code>eta(.), explicit sizes</code></a></td><td valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-etafor_0028_002e_0029"><code>etafor(.)</code></a></td><td valign="top"><a href="#Executing-code-after-the-analysis">4.3.3 Executing code after the analysis</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-ff_0028_002e_0029"><code>ff(.)</code></a></td><td valign="top"><a href="#The-cell-and-transfer-arrays">The cell and transfer arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ff_0028_002e_0029_002c-explicit-sizes"><code>ff(.), explicit sizes</code></a></td><td valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ffl_0028_002e_0029"><code>ffl(.)</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Free_005fparameter"><code>Free_parameter</code></a></td><td valign="top"><a href="#Parameters">3.7 Parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-fun_003a"><code>fun:</code></a></td><td valign="top"><a href="#Model-equations-1">Model equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f_005fset"><code>f_set</code></a></td><td valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f_005fset-1"><code>f_set</code></a></td><td valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f_005fset-2"><code>f_set</code></a></td><td valign="top"><a href="#Cost-function-coding-and-adjoint-modeling">4.2.3 Cost function coding and adjoint modeling</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-f_005fset-3"><code>f_set</code></a></td><td valign="top"><a href="#Cost-function-coding-and-adjoint-modeling">4.2.3 Cost function coding and adjoint modeling</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-H">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-H"><code>H</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-index_005fff_005fgain"><code>index_ff_gain</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-innobs_0028_002e_0029"><code>innobs(.)</code></a></td><td valign="top"><a href="#Executing-code-after-the-analysis">4.3.3 Executing code after the analysis</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-istep"><code>istep</code></a></td><td valign="top"><a href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-istep_005fB_005fdeb"><code>istep_B_deb</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-istep_005fB_005ffin"><code>istep_B_fin</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-istep_005fB_005finc"><code>istep_B_inc</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-itau_005fmax"><code>itau_max</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-K">K</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-kgain_0028_002e_0029"><code>kgain(.)</code></a></td><td valign="top"><a href="#Executing-code-after-the-analysis">4.3.3 Executing code after the analysis</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-maxstep"><code>maxstep</code></a></td><td valign="top"><a href="#Size-sequence">3.9.1 The explicit size sequence</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mereta_0028_002e_002c_002e_0029"><code>mereta(.,.)</code></a></td><td valign="top"><a href="#Observations-and-error-on-state-matrix">Observations and error on state matrix</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mobs"><code>mobs</code></a></td><td valign="top"><a href="#Observations">3.8.1 Observations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-model_005ffile_005fname"><code>model_file_name</code></a></td><td valign="top"><a href="#Setting-up-a-model-with-make">2.3.2 Setup a model and compile with make</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-modzprint"><code>modzprint</code></a></td><td valign="top"><a href="#Model-equation-and-parameters">2.2.2 Entering model equation and parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-modzprint-1"><code>modzprint</code></a></td><td valign="top"><a href="#Controlling-the-printout-and-data-output">2.4.2 Controlling the printout and data output</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mp"><code>mp</code></a></td><td valign="top"><a href="#The-cell-and-transfer-arrays">The cell and transfer arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-mp-1"><code>mp</code></a></td><td valign="top"><a href="#Size-sequence">3.9.1 The explicit size sequence</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-m_005fdwn"><code>m_dwn</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-m_005fmult"><code>m_mult</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-m_005fnode"><code>m_node</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-m_005fup"><code>m_up</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-N">N</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-np"><code>np</code></a></td><td valign="top"><a href="#The-cell-and-transfer-arrays">The cell and transfer arrays</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-np-1"><code>np</code></a></td><td valign="top"><a href="#Size-sequence">3.9.1 The explicit size sequence</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-nstep"><code>nstep</code></a></td><td valign="top"><a href="#Model-equation-and-parameters">2.2.2 Entering model equation and parameters</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-n_005fdwn"><code>n_dwn</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-n_005fmult"><code>n_mult</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-n_005fnode"><code>n_node</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-n_005fup"><code>n_up</code></a></td><td valign="top"><a href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-obspha_0028_002e_002c_002e_0029"><code>obspha(.,.)</code></a></td><td valign="top"><a href="#Executing-code-after-the-analysis">4.3.3 Executing code after the analysis</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Phi_005ftef_0028_002e_0029"><code>Phi_tef(.)</code></a></td><td valign="top"><a href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-principal"><code>principal</code></a></td><td valign="top"><a href="#The-model-subroutine">3.2.2 Calling the model subroutine</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005fdwn_005feta"><code>set_dwn_eta</code></a></td><td valign="top"><a href="#Limiting-conditions">Limiting conditions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005fdwn_005fphi"><code>set_dwn_phi</code></a></td><td valign="top"><a href="#Limiting-conditions">Limiting conditions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005feta"><code>set_eta</code></a></td><td valign="top"><a href="#Model-equations-1">Model equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005fnode_005feta"><code>set_node_eta</code></a></td><td valign="top"><a href="#Grid-node-equations">Grid node equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005fnode_005fPhi"><code>set_node_Phi</code></a></td><td valign="top"><a href="#Grid-node-equations">Grid node equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005fPhi"><code>set_Phi</code></a></td><td valign="top"><a href="#Model-equations-1">Model equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005fup_005feta"><code>set_up_eta</code></a></td><td valign="top"><a href="#Limiting-conditions">Limiting conditions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-set_005fup_005fphi"><code>set_up_phi</code></a></td><td valign="top"><a href="#Limiting-conditions">Limiting conditions</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-tau_005fB_005fini"><code>tau_B_ini</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tau_005fB_005fmult"><code>tau_B_mult</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-time"><code>time</code></a></td><td valign="top"><a href="#Model-equation-and-parameters">2.2.2 Entering model equation and parameters</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-var_003a"><code>var:</code></a></td><td valign="top"><a href="#Model-equations-1">Model equations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vobs_0028_002e_0029"><code>vobs(.)</code></a></td><td valign="top"><a href="#Data">3.8.2 Data</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-vobs_0028_002e_0029-1"><code>vobs(.)</code></a></td><td valign="top"><a href="#Feeding-the-observations">4.3.2.1 Feeding the observations to the model</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
<tr><th><a name="Variables_002c-macros-and-functions-index_vr_letter-Z">Z</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-zback"><code>zback</code></a></td><td valign="top"><a href="#Cost-function-coding-and-adjoint-modeling">4.2.3 Cost function coding and adjoint modeling</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ZBorel"><code>ZBorel</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zborel-for"><code>zborel for</code></a></td><td valign="top"><a href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zcommand"><code>zcommand</code></a></td><td valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zgetobs"><code>zgetobs</code></a></td><td valign="top"><a href="#Data">3.8.2 Data</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zgetobs-1"><code>zgetobs</code></a></td><td valign="top"><a href="#Feeding-the-observations">4.3.2.1 Feeding the observations to the model</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zkalman"><code>zkalman</code></a></td><td valign="top"><a href="#Coding-the-Kalman-filter">4.3.1 Coding the Kalman filter</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zlaw"><code>zlaw</code></a></td><td valign="top"><a href="#Control-laws">4.2.2 Control laws</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-zprint"><code>zprint</code></a></td><td valign="top"><a href="#Controlling-the-printout-and-data-output">2.4.2 Controlling the printout and data output</a></td></tr>
<tr><td colspan="3"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a href="#Variables_002c-macros-and-functions-index_vr_letter-A" class="summary-letter"><b>A</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-B" class="summary-letter"><b>B</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-C" class="summary-letter"><b>C</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-D" class="summary-letter"><b>D</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-E" class="summary-letter"><b>E</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-F" class="summary-letter"><b>F</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-H" class="summary-letter"><b>H</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-I" class="summary-letter"><b>I</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-K" class="summary-letter"><b>K</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-M" class="summary-letter"><b>M</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-N" class="summary-letter"><b>N</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-O" class="summary-letter"><b>O</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-P" class="summary-letter"><b>P</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-S" class="summary-letter"><b>S</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-T" class="summary-letter"><b>T</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-V" class="summary-letter"><b>V</b></a>
 &nbsp; 
<a href="#Variables_002c-macros-and-functions-index_vr_letter-Z" class="summary-letter"><b>Z</b></a>
 &nbsp; 
</td></tr></table>

<hr size="6">
<a name="Installation"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Variables-macros-and-functions-index" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Programming-environments" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Variables-macros-and-functions-index" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Installation-1"></a>
<h1 class="appendix">A. Installation</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Programming-environments">A.1 Programming environments</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Common-requisites">A.2 Common requisites</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Miniker-with-cmz">A.3 Miniker with cmz</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Miniker-with-make">A.4 Miniker with make</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Programming-environments"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Installation" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Common-requisites" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Installation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Programming-environments-1"></a>
<h2 class="appendixsec">A.1 Programming environments</h2>
<a name="index-Programming-environments"></a>

<p>Miniker is not a traditionnal software in that it isn&rsquo;t a library
or an interpreter but rather a set of source and macro file that 
combines with the user model code and enable
to build a binary program corresponding with the model. It
requires a build environment with a preprocessor, a compiler
and facilities that automate these steps.
</p>
<p>Two different environment are proposed. One use
<code>cmz</code> (<a href="http://wwwcmz.web.cern.ch/wwwcmz/index.html">http://wwwcmz.web.cern.ch/wwwcmz/index.html</a>),
while the other is based on <code>make</code>. Other libraries
are needed, the CERN Program Library (cernlib) and lapack.
</p>
<hr size="6">
<a name="Common-requisites"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Programming-environments" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Miniker-with-cmz" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Installation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Common-requisites-1"></a>
<h2 class="appendixsec">A.2 Common requisites</h2>

<a name="index-cernlib"></a>
<a name="index-lapack"></a>

<p>Whatever method is used a fortran 77 compiler is required. The compilers
that have been used so far are g77, gfortran and the sun solaris compiler.
</p>
<p>When usng CMZ, the CERN Program Library, available at
<a href="http://wwwasd.web.cern.ch/wwwasd/cernlib/">http://wwwasd.web.cern.ch/wwwasd/cernlib/</a>, has to be installed.
With make, internal source files copied from the cernlib may be used instead
but then some examples won&rsquo;t be available, since they rely on some
mathematical functions provided by the CERN library.
On windows, in case you want to use the compiler from the GNU compiler 
collection with cygwin or MINGW/MSYS you can use the binaries provided at
<a href="http://zyao.home.cern.ch/zyao/cernlib.html">http://zyao.home.cern.ch/zyao/cernlib.html</a>.
On Mac OS X, the cernlib provided by fink (package <code>cernlib-devel</code>)
can be used.
</p>
<p>You should also have LAPACK, available at <a href="http://www.netlib.org/lapack/">http://www.netlib.org/lapack/</a>.
LAPACK can also be installed as part of the CERN Library or as part of
the <a href="ATLAS">http://math-atlas.sourceforge.net/</a> implementation.
On most linux distributions a lapack package is available.
On Mac OS X, the ATLAS implementation provided by fink or the frameworks
from Xcode can be used.
</p>

<hr size="6">
<a name="Miniker-with-cmz"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Common-requisites" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Miniker-with-make" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Installation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Miniker-with-cmz-1"></a>
<h2 class="appendixsec">A.3 Miniker with cmz</h2>

<a name="index-mini_005fker_002ecmz"></a>
<a name="index-selseq_002ekumac-1"></a>

<p>First of all you have to get the cmz file &lsquo;<tt>mini_ker.cmz</tt>&rsquo; and put it
in a directory. In that same directory you should create a directory for
each of your models. In the model directory you should copy the file 
&lsquo;<tt>selseq.kumac</tt>&rsquo; available with Miniker, and create your own cmz 
file for your model, called for example &lsquo;<tt>mymodel.cmz</tt>&rsquo;. You should also 
have installed the kumac macro files
handling mortan compilation, the associated shell scripts and the mortran
preprocessor.
</p>
<hr size="6">
<a name="Miniker-with-make"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Miniker-with-cmz" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Additional-requirements" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Installation" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Miniker-with-make-1"></a>
<h2 class="appendixsec">A.4 Miniker with make</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Additional-requirements">A.4.1 Additional requirements for Miniker with make</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Configuration">A.4.2 Configuration</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Installation-with-make">A.4.3 Installation with make</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Additional-requirements"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Miniker-with-make" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Configuration" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Miniker-with-make" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Additional-requirements-for-Miniker-with-make"></a>
<h3 class="appendixsubsec">A.4.1 Additional requirements for Miniker with make</h3>

<a name="index-mortran_002c-with-make"></a>
<a name="index-requirements_002c-with-make"></a>

<p>The package has been tested with GNU <code>make</code> and solaris
<code>make</code>. 
</p>
<p>Suitable preprocessors should also be installed. Two preprocessors are 
required, one that preprocess the cmz directives, and a mortran 
preprocessor. A cmz directives processor written in <code>perl</code>,
is distributed in the <code>car2txt</code> package available at
<a href="http://www.environnement.ens.fr/perso/dumas/mini_ker/software.html">http://www.environnement.ens.fr/perso/dumas/mini_ker/software.html</a>. A <code>mortran</code>
package with a command able to preprocess a mortran file given on
the command line with a syntax similar with the <code>cpp</code> command line 
syntax is also required.
Such a mortran is available at <a href="http://www.environnement.ens.fr/perso/dumas/mini_ker/software.html">http://www.environnement.ens.fr/perso/dumas/mini_ker/software.html</a>.
</p>


<hr size="6">
<a name="Configuration"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Additional-requirements" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Installation-with-make" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Miniker-with-make" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Configuration-1"></a>
<h3 class="appendixsubsec">A.4.2 Configuration</h3>

<a name="index-configuration-of-source"></a>

<p>The package is available at <a href="http://www.environnement.ens.fr/perso/dumas/mini_ker/software.html">http://www.environnement.ens.fr/perso/dumas/mini_ker/software.html</a>. It is 
available as a compresssed tar archive. On UNIX, with GNU <code>tar</code> it 
may be unpacked using 
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ tar xzvf mini_ker-4.2.tar.gz
</pre></td></tr></table>

<p>The detection of the compiler, the preprocessors (car2txt and mortran), 
and the libraries are performed by the configure script. This script
sets the
apropriate variables in makefiles. It can be run with:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">$ cd mini_ker-4.2
$ ./configure
</pre></td></tr></table>

<p>If the output of <code>./configure</code> doesn&rsquo;t show any error it means that
all the components are here. It is possible to give <code>./configure</code>
switches and also specify environment variables (see also 
<code>./configure --help</code>):
</p>
<dl compact="compact">
<dt> <code>--disable-cernlib</code></dt>
<dd><p>Use the internal cernlib source files, even if a cernlib is detected.
</p></dd>
<dt> <code>--with-static-cernlib</code></dt>
<dd><p>This command line switch forces a static linking with the cernlib (or a dynamic linking 
if set to no).
</p></dd>
<dt> <code>--with-cernlib</code></dt>
<dd><p>This command line switch can be used to specify the cernlib location
(if not detected or you want to use a specific cernlib).
</p></dd>
<dt> <code>--with-blas</code></dt>
<dt> <code>--with-lapack</code></dt>
<dd><p>With this command switch, you can specify the location of the blas and lapack
libraries.
</p>
<p>For example, on mac OS X this can be used to specify the blas and lapack from 
the Apple frameworks:
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">./configure \
--with-blas=/System/Library/Frameworks/vecLib.framework/versions/A/vecLib \
--with-lapack=/System/Library/Frameworks/vecLib.framework/versions/A/vecLib
</pre></td></tr></table>

</dd>
<dt> <code>F77</code></dt>
<dt> <code>FC</code></dt>
<dt> <code>FFLAGS</code></dt>
<dt> <code>LDFLAGS</code> </dt>
<dd><p>Classical compiler, compiler flags and linker flags.
</p></dd>
<dt> <code>MORTRAN</code></dt>
<dd><p>This environment variable holds the mortran preprocessor command
(default is <code>mortran</code>).
</p></dd>
<dt> <code>MTNFLAGS</code></dt>
<dd><p>This environment variable holds command line arguments for the mortran
preprocessor. It is empty in the default case.
</p></dd>
<dt> <code>MTN</code></dt>
<dd><p>This environment variable may be used to specify the mortran executable
name and/or path, it should be used by the <code>mortran</code> commmand.
(default is empty, which leads to a mortran executable called <code>mtn</code>).
</p></dd>
<dt> <code>MTNDEPEND</code></dt>
<dd><p>This environment variable may be used to specify the mortran dependencies
checker executable. It should be used by the <code>mortran</code> commmand.
(default is empty, which leads to a mortran dependencies checker 
called <code>mtndepend</code>).
</p></dd>
</dl>

<p>After a proper configuration, if <code>make</code> is run then the example 
models should be build. You have to perform the configuration only once.
</p>
<hr size="6">
<a name="Installation-with-make"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Configuration" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Miniker-with-make" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Installation-with-make-1"></a>
<h3 class="appendixsubsec">A.4.3 Installation with make</h3>
<a name="index-installation-with-make"></a>

<p>Miniker can be installed by running 
</p><table><tr><td>&nbsp;</td><td><pre class="example">make install
</pre></td></tr></table>


<p>It should copy the sources 
and the &lsquo;<tt>Makefile.miniker</tt>&rsquo; file in 
a &lsquo;<tt>mini_ker</tt>&rsquo; directory in the <code>$(includedir)</code> directory, and
copy the templates in &lsquo;<tt>$(datadir)/mini_ker</tt>&rsquo;. The default for
<code>$(includedir)</code> is &lsquo;<tt>/usr/local/include</tt>&rsquo; and the default for
<code>$(datadir)</code> is &lsquo;<tt>/usr/local/share</tt>&rsquo;, these defaults may be 
changed by <code>./configure</code> switches &lsquo;<samp>--prefix</samp>&rsquo;,
&lsquo;<samp>--includedir</samp>&rsquo;  and &lsquo;<samp>--datadir</samp>&rsquo;. See <code>./configure --help</code>
and the &lsquo;<tt>INSTALL</tt>&rsquo; file for more informations. The helper script
&lsquo;<tt>start_miniker</tt>&rsquo; should also be installed.
</p>

 
<p>The installation is not required to use comfortably Miniker. Indeed
the only thing that changes with the sources and the &lsquo;<tt>Makefile.miniker</tt>&rsquo;
directory location is the <code>miniker_dir</code> variable in a 
project <code>Makefile</code>.
</p>

<hr size="6">
<a name="Cmz-directives-reference"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Installation-with-make" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-general-syntax" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Installation" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Cmz-directives-reference-1"></a>
<h1 class="appendix">B. Cmz directives reference</h1>

<p>The cmz directives are described together with the other 
features of cmz in the cmz manual at
<a href="http://wwwcmz.web.cern.ch/wwwcmz/">http://wwwcmz.web.cern.ch/wwwcmz/</a>, the important ones are 
nevertheless recalled here,
especially for those that use make and don&rsquo;t need the whole
features of cmz.
</p>
<p>After the description of the generic features, we turn
to the cmz directive of interest.
There are three kinds of cmz directives that are of use
within Miniker: one kind
that introduce files, the other for conditionnal compilation and
the third for sequence inclusion. 
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#Cmz-directives-general-syntax">B.1 Cmz directives general syntax</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Conditional-expressions">B.2 Conditional expressions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#File-introduction-directives">B.3 File introduction directives</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#Conditional-directives">B.4 Conditional directives</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#File-inclusion-directive">B.5 File inclusion directive</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#The-self-directive">B.6 The &lsquo;<samp>self</samp>&rsquo; directive</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Cmz-directives-general-syntax"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Conditional-expressions" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Cmz-directives-general-syntax-1"></a>
<h2 class="appendixsec">B.1 Cmz directives general syntax</h2>

<p>The cmz directives always begin with a &lsquo;<samp>+</samp>&rsquo; in the first column,
optionnaly followed by any number of &lsquo;<samp>_</samp>&rsquo; that may be used for 
indentation, then the directive label, case insensitive, followed
by the directive arguments separated by &lsquo;<samp>,</samp>&rsquo;. The arguments
are also case insensitive.
Optional spaces may be around directive arguments. 
An optionnal &lsquo;<samp>.</samp>&rsquo; ends the directive
arguments and begin a comment, everything that follows that &lsquo;<samp>.</samp>&rsquo; is 
ignored.
</p>
<hr size="6">
<a name="Conditional-expressions"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Cmz-directives-general-syntax" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#File-introduction-directives" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Conditional-expressions-1"></a>
<h2 class="appendixsec">B.2 Conditional expressions</h2>

<p>A directive argument common to all the directives is the conditionnal
expression. A conditionnal expression may be true or false, it is a 
combination of select flags. the select flags are combined with 
logical operators. A
select flag itself is true if it was selected. A select flag <var>selflag</var> 
is selected by using the <code>sel <var>selflag</var></code> instruction in cmz. It is
selected by passing the <code>-D <var>selflag</var></code> command line switch to
the call of the cmz directives preprocessor when using make.
</p>

<p>A &lsquo;<samp>-</samp>&rsquo; negates
the expression that follows. Parenthesis &lsquo;<samp>(</samp>&rsquo; and &lsquo;<samp>)</samp>&rsquo; are used 
for the grouping of subexpressions. &lsquo;<samp>|</samp>&rsquo; and &lsquo;<samp>,</samp>&rsquo; are for the 
boolean or: an expression with a or is true
if the expression on the left or the expression on the right of the or
is true. 
&lsquo;<samp>&amp;</samp>&rsquo; is for the boolean and: an expression with an and is true if
the expression on the left and the expression on the right are true.
</p>
<p>The grouping is left to right when there is no parenthesis, with or and
&lsquo;<samp>&amp;</samp>&rsquo; having the same precedence. Therefore
</p>
<table><tr><td>&nbsp;</td><td><pre class="example">a&amp;b|c    &equiv;    (a&amp;b)|c
a|b&amp;c    &equiv;    (a|b)&amp;c
a|b&amp;c  is not  a|(b&amp;c)
a&amp;b|c  is not  a&amp;(b|c)
</pre></td></tr></table>


<hr size="6">
<a name="File-introduction-directives"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Conditional-expressions" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Conditional-directives" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="File-introduction-directives-1"></a>
<h2 class="appendixsec">B.3 File introduction directives</h2>

<p>A file (or sequence) introduction directive appears at the beginning
of the file. There are two different directives, one is <code>DECK</code>
for normal files, the other is <code>KEEP</code> for include files (sequences).
The first argument is the name of the file. The file name may not be larger
than 32 characters and is converted to lower case in the general case.
The optionnal following arguments may be
of 2 type (and may be mixed, separated by &lsquo;<samp>,</samp>&rsquo;):
</p>
<dl compact="compact">
<dt> conditional</dt>
<dd><p>A conditionnal is introduced by <code>IF=</code> followed by a conditionnal 
expression described in 
<a href="#Conditional-expressions">Conditional expressions</a>. The 
file is preprocessed if the conditionnal expression is true.
</p></dd>
<dt> language specification</dt>
<dd><p>A language specification is introduced by a <code>T=</code>. The most
common languages are &lsquo;<samp>mtn</samp>&rsquo; for the mortran, &lsquo;<samp>ftn</samp>&rsquo; for
fortran not preprocessed, &lsquo;<samp>f77</samp>&rsquo; for preprocessed fortran,
&lsquo;<samp>c</samp>&rsquo; for the c language and &lsquo;<samp>txt</samp>&rsquo; for text files.
In general the language of the file determines the name of files 
the preprocessed file is extracted to, the comment style and
the command for inclusions.
</p></dd>
</dl>

<p>It is a common practice to have wrong language type in <code>KEEP</code> 
as the language may be determined from the <code>DECK</code> that include
them with cmz, or from their file name with make. This is not recommended
and considered a bad practice.
</p>
<p>Such a directive will always appear in cmz, as it is built-in. It
is recommended to have one when using make too, even though it is not 
required in most cases. Indeed make uses the file name directly
and finds the language and file type by looking at the file extension.
make should then pass the language type with a 
<code>--lang <var>lang</var></code> command
line switch when calling the cmz directives preprocessor.
With make, the convention is to have &lsquo;<samp>cm</samp>&rsquo; added before the normal
file suffix and after the &lsquo;<samp>.</samp>&rsquo;. The table <a href="#tab_003acmfile_005fsuffix">tab:cmfile_suffix</a>
shows the matching between suffixes, file type and file language.
</p>
<p>For example, a file beginning with
</p>
<pre class="verbatim">+Deck, subroutine_foo, If=monitor&amp;-simple, T=f77. 
</pre>
<p>is a main preprocessed fortran file that will only be generated if
&lsquo;<samp>monitor</samp>&rsquo; is selected and &lsquo;<samp>simple</samp>&rsquo; is not selected. The 
file to be preprocessed by make should have the &lsquo;<samp>.cmF</samp>&rsquo; suffix,
and be called &lsquo;<tt>subroutine_foo.cmF</tt>&rsquo;.
</p>
<p>A file beginning with
</p>
<pre class="verbatim">+KEEP,inc_common,If=monitor|interface,T=mtn
</pre>
<p>is an mortran include file that should be processed only if &lsquo;<samp>monitor</samp>&rsquo;
or &lsquo;<samp>interface</samp>&rsquo; is selected. The file to be preprocessed by make
should have the &lsquo;<samp>cmmti</samp>&rsquo; suffix and be called &lsquo;<tt>inc_common.cmmti</tt>&rsquo;.
The resulting file when make is used will be called &lsquo;<tt>inc_common.mti</tt>&rsquo;.
</p>
<hr size="6">
<a name="Conditional-directives"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#File-introduction-directives" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#File-inclusion-directive" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Conditional-directives-1"></a>
<h2 class="appendixsec">B.4 Conditional directives</h2>

<p>Conditional directives may be used to conditionnaly skip blocks of
code. There are 4 conditional directives: <code>if</code>, <code>elseif</code>,
<code>else</code> and <code>endif</code>. <code>+if</code> begins a conditional directives
sequence, with argument a conditional expression. If the expression is
true the block of code following the <code>+if</code> is output in the
resulting file, up to another conditional directive, if it is false
the code block is skipped. If the 
expression is false and the following conditional directive is 
<code>+elseif</code>, the same procedure is followed with the argument of 
<code>+elseif</code> 
which is also a conditionnal expression. More than one <code>+elseif</code>
may follow a <code>+if</code>. If a <code>+if</code> or <code>+elseif</code> expression 
is true the following
code block is output and all
the following <code>+elseif</code> code blocks are skipped. If all the <code>+if</code>
and <code>+elseif</code> expressions are false and
the following coditionnal 
directive is <code>+else</code> then the block following the 
<code>+else</code> is output. If a previous expression was true the 
code block following the <code>+else</code> is skipped. The last code block
is closed by <code>+endif</code>.
</p>
<p>Conditionnal directives may be nested, a <code>+if</code> begins a deeper 
conditionnal sequences directives that is ended by the corresponding 
<code>+endif</code>.
</p>
<p>The simplest example is:
</p>
<pre class="verbatim">     some code;
+IF,monitor
     code output only if monitor is true;
+ENDIF
</pre>
<p>If &lsquo;<samp>monitor</samp>&rsquo; is selected, the <code>+if</code> block is output, it leads to
</p>
<pre class="verbatim">     some code;
     code output only if monitor is true;
</pre>
<p>If &lsquo;<samp>monitor</samp>&rsquo; isn&rsquo;t selected the <code>+if</code> block is skipped, it leads to
</p>
<pre class="verbatim">     some code;
</pre>
<p>An example with  <code>+else</code> may be:
</p>
<pre class="verbatim">+IF,double
 call dmysub(eta);
+ELSE
 call smysub(eta);
+ENDIF
</pre>
<p>If &lsquo;<samp>double</samp>&rsquo; is selected the code output is <code>call dmysub(eta);</code>,
if &lsquo;<samp>double</samp>&rsquo; isn&rsquo;t selected the code output is <code>call dmysub(eta);</code>.
</p>
<p>Here is a self explanatory example of use of <code>+elseif</code>:
</p>
<pre class="verbatim">+IF,monitor
  code used if monitor is selected;
+ELSEIF,kalman
  code used if kalman is selected and monitor is not;
+ELSE
  code used if kalman and monitor are not selected;
+ENDIF
</pre>
<p>And last an example of nested conditional directives:
</p>
<pre class="verbatim">+IF,monitor
  code used if monitor is selected;
+_IF,kalman. deep if
    code used if monitor and kalman are selected;
+_ELSE. deep else
    code used if monitor is selected and kalman is not;
+_ENDIF. end the deep conditionnals sequence
+ELSE
  code used if monitor is not selected;
+_IF,kalman
    code used if monitor is not selected but kalman is;
+_ELSE
    code used if monitor and kalman are not selected;
+_ENDIF
  other code used if monitor is not selected;
+ENDIF
</pre>
<hr size="6">
<a name="File-inclusion-directive"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Conditional-directives" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#The-self-directive" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="File-inclusion-directive-1"></a>
<h2 class="appendixsec">B.5 File inclusion directive</h2>

<p>The file (sequence) inclusion directive is <code>seq</code>. The argument of
<code>seq</code> is an include files &lsquo;<samp>,</samp>&rsquo; separated list. The include 
files are <code>Keep</code> in cmz. The following optional arguments may be
mixed:
</p>
<dl compact="compact">
<dt> conditional</dt>
<dd><p>A conditionnal is introduced by <code>IF=</code> followed by a conditionnal 
expression described in 
<a href="#Conditional-expressions">Conditional expressions</a>. The 
directive is ignored if the conditionnal expression is false.
</p></dd>
<dt> T=noinclude</dt>
<dd><p>When this argument is present the text of the sequence will 
always be included in the file where the <code>+seq</code> appears.
</p></dd>
</dl>

<p>When there is no <code>T=noinclude</code> argument, the <code>+seq</code> 
directive may be replaced with an inclusion command suitable 
for the language of the file being processed, if such 
command has been specified.
</p>
<p>For example if we have the following sequence
</p><pre class="verbatim">+KEEP,inc,lang=C
typedef struct incstr {char* msg};
</pre>
<p>And the following code in the file being processed:
</p>
<pre class="verbatim">+DECK,mainf,lang=C
+SEQ,inc
int main (int argc, char* argv) { exit(0); }
</pre>
<p>the processing of &lsquo;<tt>mainf</tt>&rsquo; should lead to the file 
&lsquo;<tt>mainf.c</tt>&rsquo;, containing
an include command for &lsquo;<tt>inc</tt>&rsquo;:
</p>
<pre class="verbatim">#include &quot;inc.h&quot;
int main (int argc, char* argv) { exit(0); }
</pre>
<p>In case the <code>+seq</code> has the <code>T=noinclude</code>:
</p>
<pre class="verbatim">+DECK,mainf,lang=C
+SEQ,inc,T=noinclude
int main (int argc, char* argv) { exit(0); }
</pre>
<p>The processing of &lsquo;<tt>mainf</tt>&rsquo; should lead to the file &lsquo;<tt>mainf.c</tt>&rsquo; 
containing the text of &lsquo;<tt>inc</tt>&rsquo;:
</p>
<pre class="verbatim">typedef struct incstr {char* msg};
int main (int argc, char* argv) { exit(0); }
</pre>
<hr size="6">
<a name="The-self-directive"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#File-inclusion-directive" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="The-self-directive-1"></a>
<h2 class="appendixsec">B.6 The &lsquo;<samp>self</samp>&rsquo; directive</h2>

<p>The <code>self</code> directive is an obsolete directive that may be used for
conditionnal skipping of code. For a better approach see 
<a href="#Conditional-directives">Conditional directives</a>. 
The optionnal argument of <code>+SELF</code> is <code>If=</code> followed by
a conditionnal expression. If the conditionnal expression is true the 
code following the directive is output, if it is false the code 
is skipped up to any directive (including another <code>+SELF</code>)
except <code>+seq</code>.
</p>

<hr size="6">
<a name="Copying-This-Manual"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#The-self-directive" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#GNU-Free-Documentation-License" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Cmz-directives-reference" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Top" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[ &gt;&gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Copying-This-Manual-1"></a>
<h1 class="appendix">C. Copying This Manual</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#GNU-Free-Documentation-License">C.1 GNU Free Documentation License</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">  License for copying this manual.
</td></tr>
</table>


<hr size="6">
<a name="GNU-Free-Documentation-License"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#ADDENDUM_003a-How-to-use-this-License-for-your-documents" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[ &gt;&gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="GNU-Free-Documentation-License-1"></a>
<h2 class="appendixsec">C.1 GNU Free Documentation License</h2>

<a name="index-FDL_002c-GNU-Free-Documentation-License"></a>
<p align="center"> Version 1.1, March 2000
</p>
<table><tr><td>&nbsp;</td><td><pre class="display">Copyright &copy; 2000 Free Software Foundation, Inc.
59 Temple Place, Suite 330, Boston, MA  02111-1307, USA

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
</pre></td></tr></table>

<ol>
<li>
PREAMBLE

<p>The purpose of this License is to make a manual, textbook, or other
written document <em>free</em> in the sense of freedom: to assure everyone
the effective freedom to copy and redistribute it, with or without
modifying it, either commercially or noncommercially.  Secondarily,
this License preserves for the author and publisher a way to get
credit for their work, while not being considered responsible for
modifications made by others.
</p>
<p>This License is a kind of &ldquo;copyleft&rdquo;, which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.
</p>
<p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.
</p>
</li><li>
APPLICABILITY AND DEFINITIONS

<p>This License applies to any manual or other work that contains a
notice placed by the copyright holder saying it can be distributed
under the terms of this License.  The &ldquo;Document&rdquo;, below, refers to any
such manual or work.  Any member of the public is a licensee, and is
addressed as &ldquo;you&rdquo;.
</p>
<p>A &ldquo;Modified Version&rdquo; of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.
</p>
<p>A &ldquo;Secondary Section&rdquo; is a named appendix or a front-matter section of
the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document&rsquo;s overall subject
(or to related matters) and contains nothing that could fall directly
within that overall subject.  (For example, if the Document is in part a
textbook of mathematics, a Secondary Section may not explain any
mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.
</p>
<p>The &ldquo;Invariant Sections&rdquo; are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.
</p>
<p>The &ldquo;Cover Texts&rdquo; are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.
</p>
<p>A &ldquo;Transparent&rdquo; copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, whose contents can be viewed and edited directly and
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup has been designed to thwart or discourage
subsequent modification by readers is not Transparent.  A copy that is
not &ldquo;Transparent&rdquo; is called &ldquo;Opaque&rdquo;.
</p>
<p>Examples of suitable formats for Transparent copies include plain
<small>ASCII</small> without markup, Texinfo input format, LaTeX input format,
<acronym>SGML</acronym> or <acronym>XML</acronym> using a publicly available
<acronym>DTD</acronym>, and standard-conforming simple <acronym>HTML</acronym> designed
for human modification.  Opaque formats include PostScript,
<acronym>PDF</acronym>, proprietary formats that can be read and edited only by
proprietary word processors, <acronym>SGML</acronym> or <acronym>XML</acronym> for which
the <acronym>DTD</acronym> and/or processing tools are not generally available,
and the machine-generated <acronym>HTML</acronym> produced by some word
processors for output purposes only.
</p>
<p>The &ldquo;Title Page&rdquo; means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, &ldquo;Title Page&rdquo; means
the text near the most prominent appearance of the work&rsquo;s title,
preceding the beginning of the body of the text.
</p>
</li><li>
VERBATIM COPYING

<p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.
</p>
<p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.
</p>
</li><li>
COPYING IN QUANTITY

<p>If you publish printed copies of the Document numbering more than 100,
and the Document&rsquo;s license notice requires Cover Texts, you must enclose
the copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.
</p>
<p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.
</p>
<p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a publicly-accessible computer-network location containing a complete
Transparent copy of the Document, free of added material, which the
general network-using public has access to download anonymously at no
charge using public-standard network protocols.  If you use the latter
option, you must take reasonably prudent steps, when you begin
distribution of Opaque copies in quantity, to ensure that this
Transparent copy will remain thus accessible at the stated location
until at least one year after the last time you distribute an Opaque
copy (directly or through your agents or retailers) of that edition to
the public.
</p>
<p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.
</p>
</li><li>
MODIFICATIONS

<p>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:
</p>
<ol>
<li>
Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

</li><li>
List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has less than five).

</li><li>
State on the Title page the name of the publisher of the
Modified Version, as the publisher.

</li><li>
Preserve all the copyright notices of the Document.

</li><li>
Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

</li><li>
Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

</li><li>
Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document&rsquo;s license notice.

</li><li>
Include an unaltered copy of this License.

</li><li>
Preserve the section entitled &ldquo;History&rdquo;, and its title, and add to
it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section entitled &ldquo;History&rdquo; in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

</li><li>
Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the &ldquo;History&rdquo; section.
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

</li><li>
In any section entitled &ldquo;Acknowledgments&rdquo; or &ldquo;Dedications&rdquo;,
preserve the section&rsquo;s title, and preserve in the section all the
substance and tone of each of the contributor acknowledgments
and/or dedications given therein.

</li><li>
Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

</li><li>
Delete any section entitled &ldquo;Endorsements&rdquo;.  Such a section
may not be included in the Modified Version.

</li><li>
Do not retitle any existing section as &ldquo;Endorsements&rdquo;
or to conflict in title with any Invariant Section.
</li></ol>

<p>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version&rsquo;s license notice.
These titles must be distinct from any other section titles.
</p>
<p>You may add a section entitled &ldquo;Endorsements&rdquo;, provided it contains
nothing but endorsements of your Modified Version by various
parties&mdash;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.
</p>
<p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.
</p>
<p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.
</p>
</li><li>
COMBINING DOCUMENTS

<p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice.
</p>
<p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.
</p>
<p>In the combination, you must combine any sections entitled &ldquo;History&rdquo;
in the various original documents, forming one section entitled
&ldquo;History&rdquo;; likewise combine any sections entitled &ldquo;Acknowledgments&rdquo;,
and any sections entitled &ldquo;Dedications&rdquo;.  You must delete all sections
entitled &ldquo;Endorsements.&rdquo;
</p>
</li><li>
COLLECTIONS OF DOCUMENTS

<p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.
</p>
<p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.
</p>
</li><li>
AGGREGATION WITH INDEPENDENT WORKS

<p>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, does not as a whole count as a Modified Version
of the Document, provided no compilation copyright is claimed for the
compilation.  Such a compilation is called an &ldquo;aggregate&rdquo;, and this
License does not apply to the other self-contained works thus compiled
with the Document, on account of their being thus compiled, if they
are not themselves derivative works of the Document.
</p>
<p>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one quarter
of the entire aggregate, the Document&rsquo;s Cover Texts may be placed on
covers that surround only the Document within the aggregate.
Otherwise they must appear on covers around the whole aggregate.
</p>
</li><li>
TRANSLATION

<p>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License provided that you also include the
original English version of this License.  In case of a disagreement
between the translation and the original English version of this
License, the original English version will prevail.
</p>
</li><li>
TERMINATION

<p>You may not copy, modify, sublicense, or distribute the Document except
as expressly provided for under this License.  Any other attempt to
copy, modify, sublicense or distribute the Document is void, and will
automatically terminate your rights under this License.  However,
parties who have received copies, or rights, from you under this
License will not have their licenses terminated so long as such
parties remain in full compliance.
</p>
</li><li>
FUTURE REVISIONS OF THIS LICENSE

<p>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.
</p>
<p>Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.
</p></li></ol>


<hr size="6">
<a name="ADDENDUM_003a-How-to-use-this-License-for-your-documents"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#GNU-Free-Documentation-License" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[ &gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Copying-This-Manual" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#GNU-Free-Documentation-License" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[ &gt;&gt; ]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h3 class="appendixsubsec">C.1.1 ADDENDUM: How to use this License for your documents</h3>

<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">  Copyright (C)  <var>year</var>  <var>your name</var>.
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.1
  or any later version published by the Free Software Foundation;
  with the Invariant Sections being <var>list their titles</var>, with the
  Front-Cover Texts being <var>list</var>, and with the Back-Cover Texts being <var>list</var>.
  A copy of the license is included in the section entitled ``GNU
  Free Documentation License''.
</pre></td></tr></table>

<p>If you have no Invariant Sections, write &ldquo;with no Invariant Sections&rdquo;
instead of saying which ones are invariant.  If you have no
Front-Cover Texts, write &ldquo;no Front-Cover Texts&rdquo; instead of
&ldquo;Front-Cover Texts being <var>list</var>&rdquo;; likewise for Back-Cover Texts.
</p>
<p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.
</p>


<hr size="6">
<a name="SEC_Foot"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>Footnotes</h1>
<h3><a name="FOOT1" href="#DOCF1">(1)</a></h3>
<p>In fact
the variables names are transformed into fortran array elements
by mortran generated macros, so the symbolic names defined in the
mortran blocks never appears in the generated fortran code, they are
replaced by the fortran arrays.
</p><h3><a name="FOOT2" href="#DOCF2">(2)</a></h3>
<p>&lsquo;<tt>dres.data</tt>&rsquo; has another time related variable as second column:
<a name="index-dres_002edata-1"></a>
<a name="index-dt-1"></a>
<code>dt</code>, the time step that can vary in the course of a simulation.
</p><h3><a name="FOOT3" href="#DOCF3">(3)</a></h3>
<p>This naming is a joke
for &ldquo;Inert&rdquo; Heaviside function.
</p><h3><a name="FOOT4" href="#DOCF4">(4)</a></h3>
<p><code>fun_set</code>, or equivalently <code>f_set</code>, is a 
general mortran macro associating a symbol with a fortran expression. 
Here, it is the name of the symbol (<code>eta</code>) that has a particular meaning
for the building of the model.
</p><h3><a name="FOOT5" href="#DOCF5">(5)</a></h3>
<p>For a short introduction to automatic 
sensitivity analysis, see the document:<br>
<a href="http://lmd.jussieu.fr/zoom/doc/sensibilite.ps">http://lmd.jussieu.fr/zoom/doc/sensibilite.ps</a>, in French,
or ask for the more complete research document to a member of the TEF-ZOOM
collaboration
</p><h3><a name="FOOT6" href="#DOCF6">(6)</a></h3>
<p>General Tangent Linear System, i.e. the TLS circulating along a trajectory.
See the explanation in the document
<a href="http://www.lmd.jussieu.fr/Zoom/doc/Adjoint.pdf">http://www.lmd.jussieu.fr/Zoom/doc/Adjoint.pdf</a> (in French).
</p><h3><a name="FOOT7" href="#DOCF7">(7)</a></h3>
<p>For detailed explanation of the adjoint model,
see the document in 
<a href="http://www.lmd.jussieu.fr/ZOOM/doc/Adjoint.pdf">pdf</a>
or <a href="http://www.lmd.jussieu.fr/ZOOM/doc/Adjoint.pdf">.ps.gz</a>
</p><h3><a name="FOOT8" href="#DOCF8">(8)</a></h3>

<p>More generally, the Borel sweep allows 
the numerical study of the dependency in       &#x03C4; of the Borel transform 
of various coefficients in the system coupling  matrix.
</p><h3><a name="FOOT9" href="#DOCF9">(9)</a></h3>
<p>Explanation in
the research paper about SLTC (Al1 2003) available on request.
</p><h3><a name="FOOT10" href="#DOCF10">(10)</a></h3>
<p>cf our research texts about propagator analyses in
SLTC, and &ldquo;les Gains sur champs (Al1 2003-2004)&rdquo;
</p><hr size="1">
<a name="SEC_Contents"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>Table of Contents</h1>
<div class="contents">

<ul class="toc">
  <li><a name="toc-Introduction-1" href="#Introduction">Introduction</a>
  <ul class="toc">
    <li><a name="toc-Intended-audience-1" href="#Intended-audience">Intended audience</a></li>
    <li><a name="toc-Reading-guide-1" href="#Reading-guide">Reading guide</a></li>
    <li><a name="toc-Other-Manuals-and-documentation-1" href="#Other-Manuals-and-documentation">Other Manuals and documentation</a></li>
  </ul></li>
  <li><a name="toc-An-overview-of-the-TEF-formalism" href="#TEF-overview">1. An overview of the <acronym>TEF</acronym> formalism</a>
  <ul class="toc">
    <li><a name="toc-Cell-and-Transfer-equations" href="#Cell-and-Transfer">1.1 Cell and Transfer equations</a></li>
    <li><a name="toc-Linearization-and-discretization-in-the-TEF" href="#Linearization-and-discretization">1.2 Linearization and discretization in the <acronym>TEF</acronym></a></li>
  </ul></li>
  <li><a name="toc-Miniker-model-programming" href="#A-model-with-Miniker">2. Miniker model programming</a>
  <ul class="toc">
    <li><a name="toc-General-structure-of-the-code" href="#Structure-of-the-code">2.1 General structure of the code</a></li>
    <li><a name="toc-Miniker-programming-illustrated" href="#A-model-description">2.2 Miniker programming illustrated</a>
    <ul class="toc">
      <li><a name="toc-All-you-need-to-know-about-mortran-and-cmz-directives" href="#A-note-about-mortran-and-cmz-directives">2.2.1 All you need to know about mortran and cmz directives</a></li>
      <li><a name="toc-Entering-model-equation-and-parameters" href="#Model-equation-and-parameters">2.2.2 Entering model equation and parameters</a></li>
    </ul></li>
    <li><a name="toc-Setting-and-running-a-model-1" href="#Setting-and-running-a-model">2.3 Setting and running a model</a>
    <ul class="toc">
      <li><a name="toc-Setup-a-model-and-compile-with-cmz" href="#Setting-up-a-model-with-cmz">2.3.1 Setup a model and compile with cmz</a></li>
      <li><a name="toc-Setup-a-model-and-compile-with-make" href="#Setting-up-a-model-with-make">2.3.2 Setup a model and compile with make</a></li>
      <li><a name="toc-Running-a-simulation-and-using-the-output" href="#Simulation-and-output">2.3.3 Running a simulation and using the output</a></li>
      <li><a name="toc-Doing-graphics" href="#Graphics">2.3.4 Doing graphics</a></li>
    </ul></li>
    <li><a name="toc-Controlling-the-run-1" href="#Controlling-the-run">2.4 Controlling the run</a>
    <ul class="toc">
      <li><a name="toc-Executing-code-at-the-end-of-each-time-step" href="#End-of-time-step">2.4.1 Executing code at the end of each time step</a></li>
      <li><a name="toc-Controlling-the-printout-and-data-output-1" href="#Controlling-the-printout-and-data-output">2.4.2 Controlling the printout and data output</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Advanced-Miniker-programming" href="#Advanced-programming">3. Advanced Miniker programming</a>
  <ul class="toc">
    <li><a name="toc-Overview-of-additional-features-setting" href="#Selecting-features">3.1 Overview of additional features setting</a></li>
    <li><a name="toc-Calling-the-model-code-1" href="#Calling-the-model-code">3.2 Calling the model code</a>
    <ul class="toc">
      <li><a name="toc-Turning-the-model-into-a-subroutine-1" href="#Turning-the-model-into-a-subroutine">3.2.1 Turning the model into a subroutine</a></li>
      <li><a name="toc-Calling-the-model-subroutine" href="#The-model-subroutine">3.2.2 Calling the model subroutine</a></li>
    </ul></li>
    <li><a name="toc-Describing-1D-gridded-model" href="#g_t1D-gridded-model">3.3 Describing 1D gridded model</a>
    <ul class="toc">
      <li><a name="toc-Setting-dimensions-for-1D-gridded-model" href="#g_t1D-gridded-Model-size">3.3.1 Setting dimensions for 1D gridded model</a></li>
      <li><a name="toc-1D-gridded-Model-coding" href="#g_t1D-gridded-model-code">3.3.2 1D gridded Model coding</a></li>
    </ul></li>
    <li><a name="toc-Double-precision-1" href="#Double-precision">3.4 Double precision</a></li>
    <li><a name="toc-Partial-Derivatives-1" href="#Partial-Derivatives">3.5 Partial Derivatives</a>
    <ul class="toc">
      <li><a name="toc-Derivating-a-power-function-1" href="#Derivating-a-power-function">3.5.1 Derivating a power function</a></li>
    </ul></li>
    <li><a name="toc-Rule-of-programming-non-continuous-models-1" href="#Rule-of-programming-non-continuous-models">3.6 Rule of programming non continuous models</a></li>
    <li><a name="toc-Parameters-1" href="#Parameters">3.7 Parameters</a></li>
    <li><a name="toc-Observations-and-data-1" href="#Observations-and-data">3.8 Observations and data</a>
    <ul class="toc">
      <li><a name="toc-Observations-1" href="#Observations">3.8.1 Observations</a></li>
      <li><a name="toc-Data-1" href="#Data">3.8.2 Data</a></li>
    </ul></li>
    <li><a name="toc-Entering-model-size-explicitely" href="#Explicit-model-size">3.9 Entering model size explicitely</a>
    <ul class="toc">
      <li><a name="toc-The-explicit-size-sequence" href="#Size-sequence">3.9.1 The explicit size sequence</a></li>
      <li><a name="toc-Entering-the-model-equations_002c-with-explicit-sizes" href="#Model-with-explicit-size">3.9.2 Entering the model equations, with explicit sizes</a></li>
    </ul></li>
    <li><a name="toc-Programming-with-cmz-directives-1" href="#Programming-with-cmz-directives">3.10 Programming with cmz directives</a>
    <ul class="toc">
      <li><a name="toc-Cmz-directives-used-with-Miniker-1" href="#Cmz-directives-used-with-Miniker">3.10.1 Cmz directives used with Miniker</a></li>
      <li><a name="toc-Using-cmz-directives-in-Miniker-1" href="#Using-cmz-directives-in-Miniker">3.10.2 Using cmz directives in Miniker</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Dynamic-analysis-of-systems-in-Miniker" href="#Dynamic-system-analysis">4. Dynamic analysis of systems in Miniker</a>
  <ul class="toc">
    <li><a name="toc-Automatic-sensitivity-computation" href="#Sensitivities">4.1 Automatic sensitivity computation</a>
    <ul class="toc">
      <li><a name="toc-Sensitivity-to-a-parameter-1" href="#Sensitivity-to-a-parameter">4.1.1 Sensitivity to a parameter</a></li>
      <li><a name="toc-Advance-matrix-sensitivity-1" href="#Advance-matrix-sensitivity">4.1.2 Advance matrix sensitivity</a></li>
    </ul></li>
    <li><a name="toc-Adjoint-model-and-optimisation-with-Miniker" href="#Adjoint-model-and-optimisation">4.2 Adjoint model and optimisation with Miniker</a>
    <ul class="toc">
      <li><a name="toc-Overview-of-optimisation-with-Miniker-1" href="#Overview-of-optimisation-with-Miniker">4.2.1 Overview of optimisation with Miniker</a></li>
      <li><a name="toc-Control-laws-1" href="#Control-laws">4.2.2 Control laws</a></li>
      <li><a name="toc-Cost-function-coding-and-adjoint-modeling-1" href="#Cost-function-coding-and-adjoint-modeling">4.2.3 Cost function coding and adjoint modeling</a></li>
      <li><a name="toc-Sensitivity-of-cost-function-to-parameters-1" href="#Sensitivity-of-cost-function-to-parameters">4.2.4 Sensitivity of cost function to parameters</a></li>
    </ul></li>
    <li><a name="toc-Kalman-filter-1" href="#Kalman-filter">4.3 Kalman filter</a>
    <ul class="toc">
      <li><a name="toc-Coding-the-Kalman-filter-1" href="#Coding-the-Kalman-filter">4.3.1 Coding the Kalman filter</a>
      <ul class="toc">
        <li><a name="toc-Kalman-filter-vectors-dimensions-1" href="#Kalman-filter-vectors-dimensions">4.3.1.1 Kalman filter vectors dimensions</a></li>
        <li><a name="toc-Error-and-observation-matrices-1" href="#Error-and-observation-matrices">4.3.1.2 Error and observation matrices</a></li>
      </ul></li>
      <li><a name="toc-Kalman-filter-run-and-output-1" href="#Kalman-filter-run-and-output">4.3.2 Kalman filter run and output</a>
      <ul class="toc">
        <li><a name="toc-Feeding-the-observations-to-the-model" href="#Feeding-the-observations">4.3.2.1 Feeding the observations to the model</a></li>
        <li><a name="toc-Kalman-filter-results-1" href="#Kalman-filter-results">4.3.2.2 Kalman filter results</a></li>
      </ul></li>
      <li><a name="toc-Executing-code-after-the-analysis-1" href="#Executing-code-after-the-analysis">4.3.3 Executing code after the analysis</a></li>
    </ul></li>
    <li><a name="toc-Feedback-gain-1" href="#Feedback-gain">4.4 Feedback gain</a>
    <ul class="toc">
      <li><a name="toc-Specifying-the-Borel-sweep-1" href="#Specifying-the-Borel-sweep">4.4.1 Specifying the Borel sweep</a></li>
      <li><a name="toc-Borel-sweep-results-1" href="#Borel-sweep-results">4.4.2 Borel sweep results</a></li>
    </ul></li>
    <li><a name="toc-Stability-analysis-of-fastest-modes" href="#Stability-of-fastest-modes">4.5 Stability analysis of fastest modes</a>
    <ul class="toc">
      <li><a name="toc-Singular-Value-Decomposition-with-cmz" href="#SVD-with-cmz">4.5.1 Singular Value Decomposition with cmz</a></li>
      <li><a name="toc-Singular-Value-Decomposition-with-make" href="#SVD-with-make">4.5.2 Singular Value Decomposition with make</a></li>
      <li><a name="toc-Singular-Value-Decomposition-run-and-output" href="#SVD-run-and-output">4.5.3 Singular Value Decomposition run and output</a></li>
    </ul></li>
    <li><a name="toc-Generalized-linear-tangent-system-analysis" href="#Generalized-TLS">4.6 Generalized linear tangent system analysis</a>
    <ul class="toc">
      <li><a name="toc-Generalized-tangent-linear-system-with-cmz" href="#GTLS-with-cmz">4.6.1 Generalized tangent linear system with cmz</a></li>
      <li><a name="toc-Generalized-tangent-linear-system-with-make" href="#GTLS-with-make">4.6.2 Generalized tangent linear system with make</a></li>
      <li><a name="toc-Generalized-tangent-linear-system-analysis-run-and-output" href="#GTLS-run-and-output">4.6.3 Generalized tangent linear system analysis run and output</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Advanced-use-of-Miniker-with-make-1" href="#Advanced-use-of-Miniker-with-make">5. Advanced use of Miniker with make</a>
  <ul class="toc">
    <li><a name="toc-Make-variables-1" href="#Make-variables">5.1 Make variables</a></li>
    <li><a name="toc-Rules-1" href="#Rules">5.2 Rules</a></li>
    <li><a name="toc-Linking-rule-1" href="#Linking-rule">5.3 Linking rule</a></li>
  </ul></li>
  <li><a name="toc-Concepts-index-1" href="#Concepts-index">Concepts index</a></li>
  <li><a name="toc-Variables_002c-macros-and-functions-index" href="#Variables-macros-and-functions-index">Variables, macros and functions index</a></li>
  <li><a name="toc-Installation-1" href="#Installation">A. Installation</a>
  <ul class="toc">
    <li><a name="toc-Programming-environments-1" href="#Programming-environments">A.1 Programming environments</a></li>
    <li><a name="toc-Common-requisites-1" href="#Common-requisites">A.2 Common requisites</a></li>
    <li><a name="toc-Miniker-with-cmz-1" href="#Miniker-with-cmz">A.3 Miniker with cmz</a></li>
    <li><a name="toc-Miniker-with-make-1" href="#Miniker-with-make">A.4 Miniker with make</a>
    <ul class="toc">
      <li><a name="toc-Additional-requirements-for-Miniker-with-make" href="#Additional-requirements">A.4.1 Additional requirements for Miniker with make</a></li>
      <li><a name="toc-Configuration-1" href="#Configuration">A.4.2 Configuration</a></li>
      <li><a name="toc-Installation-with-make-1" href="#Installation-with-make">A.4.3 Installation with make</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Cmz-directives-reference-1" href="#Cmz-directives-reference">B. Cmz directives reference</a>
  <ul class="toc">
    <li><a name="toc-Cmz-directives-general-syntax-1" href="#Cmz-directives-general-syntax">B.1 Cmz directives general syntax</a></li>
    <li><a name="toc-Conditional-expressions-1" href="#Conditional-expressions">B.2 Conditional expressions</a></li>
    <li><a name="toc-File-introduction-directives-1" href="#File-introduction-directives">B.3 File introduction directives</a></li>
    <li><a name="toc-Conditional-directives-1" href="#Conditional-directives">B.4 Conditional directives</a></li>
    <li><a name="toc-File-inclusion-directive-1" href="#File-inclusion-directive">B.5 File inclusion directive</a></li>
    <li><a name="toc-The-self-directive-1" href="#The-self-directive">B.6 The &lsquo;<samp>self</samp>&rsquo; directive</a></li>
  </ul></li>
  <li><a name="toc-Copying-This-Manual-1" href="#Copying-This-Manual">C. Copying This Manual</a>
  <ul class="toc">
    <li><a name="toc-GNU-Free-Documentation-License-1" href="#GNU-Free-Documentation-License">C.1 GNU Free Documentation License</a>
    <ul class="toc">
      <li><a name="toc-ADDENDUM_003a-How-to-use-this-License-for-your-documents" href="#ADDENDUM_003a-How-to-use-this-License-for-your-documents">C.1.1 ADDENDUM: How to use this License for your documents</a></li>
    </ul>
</li>
  </ul>
</li>
</ul>
</div>
<hr size="1">
<a name="SEC_About"></a>
<table cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#Top" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="#Concepts-index" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<h1>About This Document</h1>
<p>
  This document was generated by <em>a tester</em> on <em>a sunny day</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html</em></a>.
</p>
<p>
  The buttons in the navigation panels have the following meaning:
</p>
<table border="1">
  <tr>
    <th> Button </th>
    <th> Name </th>
    <th> Go to </th>
    <th> From 1.2.3 go to</th>
  </tr>
  <tr>
    <td align="center"> [ &lt; ] </td>
    <td align="center">Back</td>
    <td>Previous section in reading order</td>
    <td>1.2.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt; ] </td>
    <td align="center">Forward</td>
    <td>Next section in reading order</td>
    <td>1.2.4</td>
  </tr>
  <tr>
    <td align="center"> [ &lt;&lt; ] </td>
    <td align="center">FastBack</td>
    <td>Beginning of this chapter or previous chapter</td>
    <td>1</td>
  </tr>
  <tr>
    <td align="center"> [ Up ] </td>
    <td align="center">Up</td>
    <td>Up section</td>
    <td>1.2</td>
  </tr>
  <tr>
    <td align="center"> [ &gt;&gt; ] </td>
    <td align="center">FastForward</td>
    <td>Next chapter</td>
    <td>2</td>
  </tr>
  <tr>
    <td align="center"> [Top] </td>
    <td align="center">Top</td>
    <td>Cover (top) of document</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Contents] </td>
    <td align="center">Contents</td>
    <td>Table of contents</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Index] </td>
    <td align="center">Index</td>
    <td>Index</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [ ? ] </td>
    <td align="center">About</td>
    <td>About (help)</td>
    <td> &nbsp; </td>
  </tr>
</table>

<p>
  where the <strong> Example </strong> assumes that the current position is at <strong> Subsubsection One-Two-Three </strong> of a document of the following structure:
</p>

<ul>
  <li> 1. Section One
    <ul>
      <li>1.1 Subsection One-One
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.2 Subsection One-Two
        <ul>
          <li>1.2.1 Subsubsection One-Two-One</li>
          <li>1.2.2 Subsubsection One-Two-Two</li>
          <li>1.2.3 Subsubsection One-Two-Three &nbsp; &nbsp;
            <strong>&lt;== Current Position </strong></li>
          <li>1.2.4 Subsubsection One-Two-Four</li>
        </ul>
      </li>
      <li>1.3 Subsection One-Three
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.4 Subsection One-Four</li>
    </ul>
  </li>
</ul>

<hr size="1">
<p>
 <font size="-1">
  This document was generated by <em>a tester</em> on <em>a sunny day</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html</em></a>.
 </font>
 <br>

</p>
</body>
</html>
