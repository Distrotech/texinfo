In a first step, close when the the command to be closed is at the 
top of the tree, not when it should be closed theoretically.
Then it could be possible to come back to the place where the command
should be closed and give an error message.
This is certainly only an issue for @footnote and similar not a general issue.

There is no forward looking code anymore, so maybe a lex/yacc parser
could be used for the main loop.  More simply, a binary tokenizer, at 
least, could make for a notable speedup.

Following should be an error:
@example
@heading A heading
@end example

test empty line in block or brace command in menu description.

in hyphenation: only text and accent commands, and should
only appear in toplevel

dotless:
"%c%s expects `i' or `j' as argument, not `%s'"

no warning in 
t/25regions.t double_copying

no warning in
t/57invalid_nestings.t recursive_copying

no warning in
t/19def.t empty_def_arguments

Also normalize internal nodes as first argument of ref
at_commands_in_refs some_at_commands_in_ref_nodes

Texinfo::Convert::Text
@c in menu lines (and maybe at other places) should be replaced by 
\n and not eat the end of line.

use definfoenclose information in Convert::Text?

tests in test/macros, not incorporated
glossary.texi
bib-example.texi (big test)
macro-at.texi (the macro part is already done)
double_setfilename.texi
bad_setfilename.texi

from test_paths.texi:
@image{formatting/f--ile}

@@image dot.
@image{./formatting/f--ile}

@@image dot parent.
@image{../test/formatting/f--ile}

@verbatiminclude formatting/simplest.texi

@@verbatiminclude dot.
@verbatiminclude ./formatting/simplest.texi

tests in test/invalid, not incorporated
author_outside_titlepage_quotation.texi
bad_documentencoding.texi
direntry_dircategory_after_first_node.texi
double_top_section.texi
error_in_footnote_caption.texi
tex_in_copying.texi               (this is not invalid)

partly done:
indices/recursive_synindex.texi (only done: @synindex aaa bbb
                                            @synindex bbb aaa)

done:
formatting/def_end_of_line.texi
formatting/def_end_of_line_footnote.texi
formatting/empty_deftype.texi
formatting/def_cmds.texi (but printindex not tested)
formatting/paragraph_in_samp.texi

sectioning/other_at_comands_in_nodes_refs.texi
sectioning/at_commands_in_refs.texi
sectioning/test_refs.texi
sectioning/nodename_parentheses.texi
sectioning/double_node_anchor_float.texi
sectioning/double_top.texi   (but not @ref)
sectioning/nodes_test.texi   (done: unknown entry in menu and * (info)::
                              and errors.  Not sure the remaining is 
                              interesting)
sectioning/rec_nodes.texi
sectioning/semi_auto.texi
sectioning/novalidate.texi    (only errors that aren't flagged by novalidate
                               done)
sectioning/test_two_include.texi (not done at all, but it tests 
          -I .@PATH_SEPARATOR@../manuals@PATH_SEPARATOR@../macros)
sectioning/node-whitespace.tex   (but not @ref)
sectioning/loop_nodes.texi
sectioning/sectioning.texi
sectioning/text_before_line_command.texi
sectioning/empty_nodes.texi  (but not the @ref)

indices/unknown_index_entry.texi
indices/more_unknown_index_entry.texi (but without the document structure)

invalid/at_after_accent_command.texi
invalid/bad_nesting.texi
invalid/bad_style_nesting.texi
invalid/bad_tab_nesting.texi
invalid/brace_not_closed.texi
invalid/caption_not_closed.texi
invalid/code_not_closed_no_newline.texi
invalid/code_not_closed.texi 
invalid/commands_not_closed.texi (but maybe still things to test)
invalid/command_without_open_brace.texi
invalid/copying_not_closed.texi
invalid/def_bad_defx_command.texi
invalid/def_braces_and_empty.texi
invalid/def_cmd_dble.texi
invalid/empty_ifclear.texi
invalid/footnote_not_closed.texi
invalid/formats_not_closed.texi
invalid/html_not_closed.texi
invalid/ignored_not_closed.texi
invalid/invalid_command_in_table.texi
invalid/itemx_in_itemize.texi
invalid/macro_call_not_closed.texi
invalid/macro_def_not_closed.texi
invalid/math_not_closed.texi
invalid/multitable_begin_with_tab.texi
invalid/multitable_too_much_col.texi
invalid/node_in_copying.texi
invalid/node_too_much_arguments.texi
invalid/not_closed_in_menu.texi
invalid/recursive_copying.texi             (but not the expansion)
invalid/style_not_closed_in_cartouche.texi
invalid/style_not_closed_in_table_line.texi
invalid/tab_in_index.texi                  (but not the printindex)
invalid/tex_not_closed.texi
invalid/titlepage_not_closed.texi
invalid/unclosed_verb_line_commands.texi   (but the result is different since
                                            ignored until end of file).
invalid/unknown_command_with_braces.texi
invalid/verb_and_char_end_of_line.texi
invalid/verb_end_of_line.texi
invalid/verb_not_closed.texi
invalid/verbatim_not_closed.texi
