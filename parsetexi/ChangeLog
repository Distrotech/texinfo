2015-01-18  Gavin Smith  <gavinsmith0123@gmail.com>

	* tree_types.h (INDEX_ENTRY_REF): New type.
	* indices.c (enter_index_entry): Create an INDEX_ENTRY_REF 
	object and store it instead of a pointer to an INDEX_ENTRY, 
	because the latter could be become invalid when the containing 
	array was reallocated.
	* extra.c (add_extra_key_index_entry): Take an INDEX_ENTRY_REF 
	argument.
	* indices.c (enter_index_entry): Call to 
	add_extra_key_index_entry updated.
	* dump_perl.c (dump_extra) <index entry>: Get stored value as an
	INDEX_ENTRY_REF.

	* parser.c (parse_texi): Always return the root of the tree.

2015-01-14  Gavin Smith  <gavinsmith0123@gmail.com>

	First support of outputting an index.

	* extra.c (add_extra_key_misc_args, add_extra_key_index_entry): 
	New functions.
	* tree_types.h (INDEX, INDEX_ENTRY): New types.
	* commands.h (CF_index_entry_command): New flag.

	* indices.c (associate_command_to_index, index_of_command): New
	functions.
	(init_index_commands): Call associate_command_to_index for each 
	index command.
	(enter_index_entry): New function.

	* end_line.c (trim_spaces_comment_from_content): New function.
	(end_line): Call it in two places.
	(end_line) <misc args>: Add "misc_args" extra key, and call 
	enter_index_entry for index commands.

	* dump_perl.c (dump_indices_information): New function.
	(dump_route_to_element): Take extra argument saying which text
	buffer to write to.
	(dump_extra): Handle two extra types of extra key, 
	extra_index_entry and extra_misc_args.  For extra_index_entry, 
	dump to tree_to_indices_dump variable.
	(dump_tree_to_perl): Call dump_indices_information, and output
	tree_to_indices_dump afterwards.

	* Parsetexi/lib/Parsetexi.pm (parse_texi_file): Set 
	'index_names' from output of parsetexi.

	* test-files/index.texi: New test file.

2015-01-12  Gavin Smith  <gavinsmith0123@gmail.com>

	All files: Add copyright and licensing notices.

2014-12-20  Gavin Smith  <gavinsmith0123@gmail.com>

	* labels.c: New file.

	* end_line.c (end_line) <@node>: Call register_label.
	* dump_perl.c (dump_tree_to_perl): Dump information about 
	labels.
	* Parsetexi/lib/Parsetexi.pm: Set 'labels_information' from 
	dump.

	* convert.c (convert_to_normalized): Stub added.

2014-12-19  Gavin Smith  <gavinsmith0123@gmail.com>

	* element_types.txt: Add menu_entry and menu_star types.
	* menus.c: New file.
	(handle_menu, enter_menu_entry_node): Add functions.
	* parser.c (big_loop): Call handle_menu in menus.c.

	* handle_commands.c (handle_block_command) <menu commands>: 
	Outline of menu handling.
	* separator.c (handle_separator): Handle separators inside a 
	menu entry.
	* end_line.c (end_line): Start processing a menu at end of 
	"@menu" line.  Handle end of a line inside a menu.

	* Parsetexi/lib/Parsetexi.pm: Complete 'menus' arrays for each 
	node element, and 'menu_entry' 'extra' keys on menu entries.

	* parser.c (isolate_last_space): Take an extra argument giving 
	type of whitespace element.
	* tree.c (destroy_element): Free the contents and args arrays.
	(pop_element_from_args): New function.

2014-12-17  Gavin Smith  <gavinsmith0123@gmail.com>

	* tree_types.h (LINE_NR): Fields added to struct.
	* input.c (line_nr): New variable.
	(next_text, input_push_text, input_push_file): Update line_nr.
	* handle_commands.c (handle_misc_command): Record current line 
	number.
	* dump_perl.c (dump_element): Dump line number if one was 
	recorded.  This allows error messages to be printed when 
	makeinfo is run.

2014-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* Parsetexi/lib/Parsetexi.pm: Put Texinfo::Report in @ISA.
	(parser): Set 'gettext' on parser object.

	* tree_types.h (enum route_element_type): New value 
	route_not_in_tree.
	* dump_perl.c (dump_extra): If extra key marked as not in tree, 
	dump it in the main tree output.
	* end_line.c (@node): Create a new element with some whitespace 
	elements removed from its contents, and save this as 
	"node_content".

2014-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* parser.c (current_node, current_section): New variables.
	* end_line.c (end_line) <@node>: Set current_node.
	<root commands>: Set 'associated_node' and 'associated_section' 
	keys, and set current_section.

	* extra.c (lookup_extra_key): New function.

2014-12-14  Gavin Smith  <gavinsmith0123@gmail.com>

	* tree_types.h (ELEMENT): Add fields to save information about 
	'extra' keys on an element.
	* extra.c: New file.
	* dump_perl.c (dump_tree_to_perl): Dump lines filling in 'extra' 
	keys at the end.
	* tree_types.h (ELEMENT): Extra fields added to aid dumping.

	* end_line.c <@node>: Call 'add_extra_key_contents' to set 
	"node_content" key.
	* Parsetexi/lib/Parsetexi.pm (_complete_node_list): Comment out 
	code setting "node_content" keys on node elements.

	* text.c (text_printf): New function.

2014-12-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* Parsetexi/lib/Parsetexi.pm (parse_texi_file): Set 
	'node_content' extra key on each node element as well as in the 
	elements in the 'node_manuals' array.  This means that node 
	names appear in the node information line in the Info output.

2014-12-12  Gavin Smith  <gavinsmith0123@gmail.com>

	* Parsetexi/lib/Parsetexi.pm (parse_texi_file): Set 
	'input_file_name' in document information.  This allows running 
	"./makeinfo test-files/hello.texi", and getting an output file 
	"hello.info".
